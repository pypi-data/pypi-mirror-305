/*! For license information please see 44.e6779da7c5f66a99775a.js.LICENSE.txt */
"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[44],{44:(t,e,s)=>{s.r(e),s.d(e,{Aliases:()=>n,BufferedOutput:()=>M,CommandRegistry:()=>R,ConsoleOutput:()=>P,Context:()=>B,ExitCode:()=>i,FileInput:()=>W,FileOutput:()=>F,InputAll:()=>D,Pipe:()=>Q,PipeInput:()=>L,RedirectOutput:()=>U,Shell:()=>bt,TerminalInput:()=>I,TerminalOutput:()=>j,parse:()=>K,tokenize:()=>$});var r={};s.r(r),s.d(r,{AliasCommand:()=>_,BuiltinCommand:()=>l,CdCommand:()=>m,ClearCommand:()=>x,CockleConfigCommand:()=>k,ExportCommand:()=>N,HistoryCommand:()=>T});class n extends Map{constructor(){super(),this.set("dir","dir --color=auto"),this.set("grep","grep --color=auto"),this.set("ls","ls --color=auto"),this.set("ll","ls -lF"),this.set("vdir","vdir --color=auto")}getRecursive(t){let e=this.get(t);for(;void 0!==e;){const s=e.split(" ")[0];if(s===t)break;const r=this.get(s);e=void 0===r?r:r+e.slice(s.length),t=s}return e}match(t){return[...this.keys()].filter((e=>e.startsWith(t)))}}const i={SUCCESS:0,GENERAL_ERROR:1,IMPROPER_USE:2,CANNOT_RUN_COMMAND:126,CANNOT_FIND_COMMAND:127};class a extends Error{exitCode;constructor(t,e){super(e),this.exitCode=t}}class o extends a{constructor(t){super(i.CANNOT_FIND_COMMAND,`'${t}': command not found`)}}class h extends a{constructor(t){super(i.GENERAL_ERROR,t)}}class l{names(){return[this.name]}run(t,e){if(t!==this.name)throw new o(t);return this._run(e)}}class u{shortName;longName;description;constructor(t,e,s){this.shortName=t,this.longName=e,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}set(){this._isSet=!0}_isSet=!1}class c extends u{constructor(t,e,s){super(t,e,s)}}class d extends u{minCount;constructor(t=1){if(super("","",""),this.minCount=t,t<0)throw new h("Negative minCount in TrailingStringsOption.constructor")}add(t){this._strings.push(t),this._isSet=!0}get length(){return this._strings.length}get strings(){return this._strings}_strings=[]}class f{static fromArgs(t,e){const s=new e,r=s._getStrings();let n=!1;for(const e of t)if(e.startsWith("-")&&e.length>1){if(n)throw new h("Cannot have named option after parsing a trailing path");if(e.startsWith("--")){const t=e.slice(2);s._findByLongName(t).set()}else{const t=e.slice(1);s._findByShortName(t).set()}}else{if(null===r)throw new h(`Unrecognised option: ${e}`);r.add(e),n=!0}if(r&&r.length<r.minCount)throw new h("Insufficient trailing strings options specified");return s}writeHelp(t){for(const e of this._help())t.write(`${e}\n`)}_findByLongName(t){let e;for(e of Object.values(this))if(e.longName===t)return e;throw new h(`No such longName option '${t}'`)}_findByShortName(t){let e;for(e of Object.values(this))if(e.shortName===t)return e;throw new h(`No such shortName option '${t}'`)}_getStrings(){return"trailingStrings"in this?this.trailingStrings:null}_help(){return[...Object.values(this)].sort(((t,e)=>t.name>e.name?1:-1)).map((t=>{const e=t.prefixedName,s=Math.max(1,12-e.length);return`    ${e}${" ".repeat(s)}${t.description}`}))}}class p extends f{trailingStrings=new d(0)}class _ extends l{get name(){return"alias"}async _run(t){const{aliases:e,args:s,stdout:r}=t,n=f.fromArgs(s,p);if(n.trailingStrings.isSet)for(const t of n.trailingStrings.strings){const s=t.indexOf("=");-1===s?r.write(`${t}='${e.get(t)}'\n`):e.set(t.slice(0,s),t.slice(s+1))}else for(const[t,s]of e.entries())r.write(`${t}='${s}'\n`);return i.SUCCESS}}class g extends f{trailingStrings=new d(0)}class m extends l{get name(){return"cd"}async _run(t){const{args:e}=t,s=f.fromArgs(e,g).trailingStrings.strings;if(s.length<1)return i.SUCCESS;if(s.length>1)throw new h("cd: too many arguments");let r=s[0];if("-"===r){const e=t.environment.get("OLDPWD");if(void 0===e)throw new h("cd: OLDPWD not set");r=e,t.stdout.write(`${r}\n`)}const{FS:n}=t.fileSystem,a=n.cwd();return n.chdir(r),t.environment.set("OLDPWD",a),t.environment.set("PWD",n.cwd()),i.SUCCESS}}const y="[H",w="[2J",C="[3J",S="[1;0m",b="[0;94m",v="[0;95m",A="[0;32m";class x extends l{get name(){return"clear"}async _run(t){const{stdout:e}=t;return e.supportsAnsiEscapes()&&e.write(w+C+y),i.SUCCESS}}class k extends l{get name(){return"cockle-config"}async _run(t){const{stdout:e}=t;return e.write("cockle 0.0.10\n"),this._writePackageConfig(t),i.SUCCESS}_writePackageConfig(t){const{commandRegistry:e,stdout:s}=t,r=e.wasmPackageMap,n=[["package","version","build string","channel"]];for(const t of r.values())n.push([t.name,t.version,t.build_string,t.channel]);let i=null;s.supportsAnsiEscapes()&&(i=new Map,i.set(1,b),i.set(2,v),i.set(3,A));for(const t of function*(t,e,s=!1,r=null){const n=t.length,i=t[0].length,a=t.map((t=>t.map((t=>t.length)))),o=Array(i).fill(0);for(let t=0;t<n;t++)for(let e=0;e<i;e++)o[e]=Math.max(o[e],a[t][e]);function h(t){let e="â•­â”œâ•°"[t];for(let s=0;s<i;s++)e+="â”€".repeat(o[s]+2),e+=s<i-1?"â”¬â”¼â”´"[t]:"â•®â”¤â•¯"[t];return e}s||(yield h(0));for(let a=0;a<n;a++){const l=t[a];let u=s?"":"â”‚ ";for(let t=0;t<i;t++){const e=r?.get(t)||null;u+=e?e+l[t]+S:l[t],u+=" ".repeat(o[t]-l[t].length),u+=s?"  ":" â”‚ "}if(yield u,a===e-1)if(s){let t="";for(let e=0;e<i;e++)t+="â”€".repeat(o[e])+"  ";yield t}else a!==n-1&&(yield h(1))}s||(yield h(2))}(n,1,!1,i))s.write(t+"\n")}}class E extends f{trailingStrings=new d(0)}class N extends l{get name(){return"export"}async _run(t){const{args:e,environment:s}=t,r=f.fromArgs(e,E);if(r.trailingStrings.isSet)for(const t of r.trailingStrings.strings){const e=t.indexOf("=");if(e>0){const r=t.slice(0,e),n=t.slice(e+1);s.set(r,n)}}return i.SUCCESS}}class O extends f{clear=new c("c","","clear the history by deleting all of the entries");help=new c("","help","display this help and exit")}class T extends l{get name(){return"history"}async _run(t){const{args:e,history:s,stdout:r}=t,n=f.fromArgs(e,O);return n.help.isSet?n.writeHelp(r):n.clear.isSet?s.clear():s.write(r),i.SUCCESS}}class R{constructor(t){this.registerBuiltinCommands(r)}get(t){return this._map.get(t)??null}match(t){return[...this._map.keys()].filter((e=>e.startsWith(t))).sort()}registerBuiltinCommands(t){for(const[e,s]of Object.entries(t))if(e.endsWith("Command")&&!e.startsWith("Builtin"))try{const t=new s;t instanceof l&&this._register(t)}catch{}}registerWasmCommandPackage(t){this.wasmPackageMap.set(t.name,t);for(const e of t.modules)this._register(e)}_register(t){for(const e of t.names())this._map.set(e,t)}_map=new Map;wasmPackageMap=new Map}class B{args;fileSystem;mountpoint;aliases;commandRegistry;environment;history;stdin;stdout;stderr;constructor(t,e,s,r,n,i,a,o,h,l){this.args=t,this.fileSystem=e,this.mountpoint=s,this.aliases=r,this.commandRegistry=n,this.environment=i,this.history=a,this.stdin=o,this.stdout=h,this.stderr=l}async flush(){await this.stderr.flush(),await this.stdout.flush()}}class M{get allContent(){return this.data.join("")}clear(){this.data=[]}supportsAnsiEscapes(){return!1}write(t){this.data.push(t)}data=[]}class P{async flush(){}supportsAnsiEscapes(){return!1}write(t){console.log(t)}}class D{isTerminal(){return!1}readChar(){if(void 0===this._buffer&&(this._buffer=this.readAll(),this._index=0),this._index<this._buffer.length){const t=this._buffer[this._index++],e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}return[4]}_buffer;_index=0}class W extends D{fileSystem;path;constructor(t,e){super(),this.fileSystem=t,this.path=e}readAll(){const{FS:t}=this.fileSystem;return t.readFile(this.path,{encoding:"utf8"})}}class F extends M{fileSystem;path;append;constructor(t,e,s){super(),this.fileSystem=t,this.path=e,this.append=s}async flush(){const{FS:t}=this.fileSystem;let e=this.allContent;if(this.append)try{e=t.readFile(this.path,{encoding:"utf8"})+e}catch(t){}t.writeFile(this.path,e,{mode:436}),this.clear()}}class L extends D{pipe;constructor(t){super(),this.pipe=t}readAll(){const t=this.pipe.allContent;return this.pipe.clear(),t}}class Q extends M{async flush(){}get input(){return new L(this)}}class U extends M{constructor(t){super(),this.target=t}async flush(){this.data.forEach((async t=>this.target.write(t))),this.clear(),await this.target.flush()}target}class I{stdinCallback;constructor(t){this.stdinCallback=t}isTerminal(){return!0}readChar(){if(this._finished||void 0===this.stdinCallback)return[4];{const t=this.stdinCallback();if(4===t[0])this._finished=!0;else if(13===t[0])return[10];return t}}_finished=!1}class j extends M{outputCallback;prefix;suffix;constructor(t,e=null,s=null){super(),this.outputCallback=t,this.prefix=e,this.suffix=s}async flush(){this.data.forEach((async t=>await this.outputCallback(t))),this.clear()}supportsAnsiEscapes(){return!0}write(t){null!==this.prefix&&(t=this.prefix+t),null!==this.suffix&&(t+=this.suffix),super.write(t)}}function $(t,e=!0,s){const r=new H(t,e,s);return r.run(),r.tokens}var z;!function(t){t[t.None=0]="None",t[t.Delimiter=1]="Delimiter",t[t.DoubleQuote=2]="DoubleQuote",t[t.SingleQuote=3]="SingleQuote",t[t.Whitespace=4]="Whitespace",t[t.Other=5]="Other"}(z||(z={}));class H{throwErrors;aliases;constructor(t,e,s){this.throwErrors=e,this.aliases=s,this._source=t,this._tokens=[]}run(){for(;this._index<=this._source.length;)this._next();if(this.throwErrors&&""!==this._endQuote)throw new h("Tokenize error, expected end quote "+this._endQuote)}get tokens(){return this._tokens}_addToken(){const t=this._offset,e=this._value;if(void 0!==this.aliases&&t!==this._aliasOffset&&(0===this._tokens.length||";&|".includes(this._tokens.at(-1).value.at(-1)))){const s=this.aliases.getRecursive(e);if(void 0!==s){const r=e.length;return this._offset=-1,this._index=t-1,this._aliasOffset=t,this._source=this._source.slice(0,t)+s+this._source.slice(t+r),this._prevChar="",this._prevCharType=z.None,this._value="",this._endQuote="",!1}}return this._tokens.push({offset:t,value:e}),this._endQuote="",!0}_getCharType(t){return" ".includes(t)?z.Whitespace:";&|><".includes(t)?z.Delimiter:"'"===t?z.SingleQuote:'"'===t?z.DoubleQuote:z.Other}_endQuoteFromCharType(t){return t===z.DoubleQuote?'"':t===z.SingleQuote?"'":""}_next(){const t=++this._index,e=t<this._source.length?this._source[t]:" ";let s=this._getCharType(e);const r=this._endQuoteFromCharType(s);this._offset>=0?this._endQuote?e!==this._endQuote?this._value+=e:(this._endQuote="",s=z.Other):r?this._endQuote=r:s===z.Whitespace?this._addToken()&&(this._offset=-1):s!==this._prevCharType||s===z.Delimiter&&e!==this._prevChar?this._addToken()&&(this._offset=t,this._value=e):this._value+=e:s!==z.Whitespace&&(this._offset=t,this._endQuote=this._endQuoteFromCharType(s),this._value=""===this._endQuote?e:""),this._prevChar=e,this._prevCharType=s}_source;_tokens;_prevChar="";_prevCharType=z.None;_index=-1;_offset=-1;_aliasOffset=-1;_value="";_endQuote=""}const G=";&";class Y{}class J extends Y{name;suffix;redirects;constructor(t,e,s){super(),this.name=t,this.suffix=e,this.redirects=s}lastToken(){return this.redirects&&this.redirects.length>0?this.redirects[this.redirects.length-1].lastToken():this.suffix.length>0?[this.suffix[this.suffix.length-1],!1]:[this.name,!0]}}class q extends Y{commands;constructor(t){super(),this.commands=t}lastToken(){return this.commands.length>0?this.commands[this.commands.length-1].lastToken():[null,!1]}}class X extends Y{token;target;constructor(t,e){super(),this.token=t,this.target=e}lastToken(){return[this.target,!1]}}function K(t,e=!0,s){const r=$(t,e,s),n=[],i=[];let a=-1;const o=r.length;function h(){1===i.length?n.push(i[0]):i.length>1&&n.push(new q([...i])),i.length=0}for(let t=0;t<o;t++){const e=r[t];a>=0?G.includes(e.value)?(i.push(V(r.slice(a,t))),h(),a=-1):"|"===e.value&&(i.push(V(r.slice(a,t))),a=-1):G.includes(e.value)||(a=t)}return a>=0&&i.push(V(r.slice(a,o))),h(),n}function V(t){let e=t.slice(1);const s=e.findIndex((t=>{return(e=t.value).startsWith(">")||e.startsWith("<");var e}));if(s>=0){if(e.length!==s+2)throw new h("Redirect should be followed by file to redirect to");const r=new X(e[s],e[s+1]);return e=e.slice(0,s),new J(t[0],e,[r])}return new J(t[0],e)}const Z=Symbol("Comlink.proxy"),tt=Symbol("Comlink.endpoint"),et=Symbol("Comlink.releaseProxy"),st=Symbol("Comlink.finalizer"),rt=Symbol("Comlink.thrown"),nt=t=>"object"==typeof t&&null!==t||"function"==typeof t,it=new Map([["proxy",{canHandle:t=>nt(t)&&t[Z],serialize(t){const{port1:e,port2:s}=new MessageChannel;return at(t,e),[s,[s]]},deserialize:t=>(t.start(),ht(t))}],["throw",{canHandle:t=>nt(t)&&rt in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function at(t,e=globalThis,s=["*"]){e.addEventListener("message",(function r(n){if(!n||!n.data)return;if(!function(t,e){for(const s of t){if(e===s||"*"===s)return!0;if(s instanceof RegExp&&s.test(e))return!0}return!1}(s,n.origin))return void console.warn(`Invalid origin '${n.origin}' for comlink proxy`);const{id:i,type:a,path:o}=Object.assign({path:[]},n.data),h=(n.data.argumentList||[]).map(yt);let l;try{const e=o.slice(0,-1).reduce(((t,e)=>t[e]),t),s=o.reduce(((t,e)=>t[e]),t);switch(a){case"GET":l=s;break;case"SET":e[o.slice(-1)[0]]=yt(n.data.value),l=!0;break;case"APPLY":l=s.apply(e,h);break;case"CONSTRUCT":l=gt(new s(...h));break;case"ENDPOINT":{const{port1:e,port2:s}=new MessageChannel;at(t,s),l=function(t,e){return _t.set(t,e),t}(e,[e])}break;case"RELEASE":l=void 0;break;default:return}}catch(t){l={value:t,[rt]:0}}Promise.resolve(l).catch((t=>({value:t,[rt]:0}))).then((s=>{const[n,o]=mt(s);e.postMessage(Object.assign(Object.assign({},n),{id:i}),o),"RELEASE"===a&&(e.removeEventListener("message",r),ot(e),st in t&&"function"==typeof t[st]&&t[st]())})).catch((t=>{const[s,r]=mt({value:new TypeError("Unserializable return value"),[rt]:0});e.postMessage(Object.assign(Object.assign({},s),{id:i}),r)}))})),e.start&&e.start()}function ot(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function ht(t,e){return ft(t,[],e)}function lt(t){if(t)throw new Error("Proxy has been released and is not useable")}function ut(t){return wt(t,{type:"RELEASE"}).then((()=>{ot(t)}))}const ct=new WeakMap,dt="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(ct.get(t)||0)-1;ct.set(t,e),0===e&&ut(t)}));function ft(t,e=[],s=function(){}){let r=!1;const n=new Proxy(s,{get(s,i){if(lt(r),i===et)return()=>{!function(t){dt&&dt.unregister(t)}(n),ut(t),r=!0};if("then"===i){if(0===e.length)return{then:()=>n};const s=wt(t,{type:"GET",path:e.map((t=>t.toString()))}).then(yt);return s.then.bind(s)}return ft(t,[...e,i])},set(s,n,i){lt(r);const[a,o]=mt(i);return wt(t,{type:"SET",path:[...e,n].map((t=>t.toString())),value:a},o).then(yt)},apply(s,n,i){lt(r);const a=e[e.length-1];if(a===tt)return wt(t,{type:"ENDPOINT"}).then(yt);if("bind"===a)return ft(t,e.slice(0,-1));const[o,h]=pt(i);return wt(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:o},h).then(yt)},construct(s,n){lt(r);const[i,a]=pt(n);return wt(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:i},a).then(yt)}});return function(t,e){const s=(ct.get(e)||0)+1;ct.set(e,s),dt&&dt.register(t,e,t)}(n,t),n}function pt(t){const e=t.map(mt);return[e.map((t=>t[0])),(s=e.map((t=>t[1])),Array.prototype.concat.apply([],s))];var s}const _t=new WeakMap;function gt(t){return Object.assign(t,{[Z]:!0})}function mt(t){for(const[e,s]of it)if(s.canHandle(t)){const[r,n]=s.serialize(t);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:t},_t.get(t)||[]]}function yt(t){switch(t.type){case"HANDLER":return it.get(t.name).deserialize(t.value);case"RAW":return t.value}}function wt(t,e,s){return new Promise((r=>{const n=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(s){s.data&&s.data.id&&s.data.id===n&&(t.removeEventListener("message",e),r(s.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),s)}))}class Ct{constructor(t){if(void 0===t){const t=(this._maxChars+3)*Int32Array.BYTES_PER_ELEMENT;this._sharedArrayBuffer=new SharedArrayBuffer(t)}else this._sharedArrayBuffer=t;this._intArray=new Int32Array(this._sharedArrayBuffer),void 0===t&&(this._intArray[0]=0,this._intArray[1]=0)}async disable(){this._enabled=!1,this._clear()}async enable(){this._enabled=!0}get enabled(){return this._enabled}_clear(){this._intArray[0]=0,this._intArray[1]=0,this._readCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._intArray,2),e=[];for(let s=0;s<t;s++)e.push(Atomics.load(this._intArray,3+s));return e}_enabled=!1;_maxChars=8;_sharedArrayBuffer;_intArray;_readCount=0}class St extends Ct{constructor(){super()}async disable(){if(this._disabling=!0,this._storedCount!==this._readCount){const t=this._loadFromSharedArrayBuffer();let e="";for(const s of t)e+=String.fromCharCode(s);await this._sendStdinNow(e)}for(;this._buffer.length>0;)await this._sendStdinNow(this._buffer.shift());this._disabling=!1,super.disable()}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(t){this._buffer.push(t),this._bufferCount++,t.length>this._maxChars&&console.log(`String '${t}' is too long to buffer`),this._disabling||this._readCount!==this._storedCount||this._storeInSharedArrayBuffer()}registerSendStdinNow(t){this._sendStdinNow=t}_afterRead(){if(this._readCount=Atomics.load(this._intArray,1),this._readCount!==this._storedCount)throw new Error("Should not happen");this._bufferCount>this._storedCount&&this._storeInSharedArrayBuffer()}_clear(){super._clear(),this._buffer=[],this._bufferCount=0,this._storedCount=0}_storeInSharedArrayBuffer(){const t=this._buffer.shift();this._storedCount++;const e=t.length;Atomics.store(this._intArray,2,e);for(let s=0;s<e;s++)Atomics.store(this._intArray,3+s,t.charCodeAt(s));Atomics.store(this._intArray,0,this._storedCount),Atomics.notify(this._intArray,0,1);const{async:s,value:r}=Atomics.waitAsync(this._intArray,1,this._readCount);s&&r.then((()=>this._afterRead()))}_buffer=[];_bufferCount=0;_disabling=!1;_storedCount=0;_sendStdinNow}class bt{options;constructor(t){this.options=t,this._bufferedStdin=new St,this._initWorker(t)}async _initWorker(t){this._worker=new Worker(new URL(s.p+s.u(817),s.b),{type:void 0}),this._remote=ht(this._worker);const{color:e,mountpoint:r,wasmBaseUrl:n,driveFsBaseUrl:i,initialDirectories:a,initialFiles:o}=t,{sharedArrayBuffer:h}=this._bufferedStdin;await this._remote.initialize({color:e,mountpoint:r,wasmBaseUrl:n,driveFsBaseUrl:i,sharedArrayBuffer:h,initialDirectories:a,initialFiles:o},gt(t.outputCallback),gt(this.enableBufferedStdinCallback.bind(this))),this._bufferedStdin.registerSendStdinNow(this._remote.input)}async enableBufferedStdinCallback(t){t?await this._bufferedStdin.enable():await this._bufferedStdin.disable()}async input(t){this._bufferedStdin.enabled?await this._bufferedStdin.push(t):await this._remote.input(t)}async setSize(t,e){await this._remote.setSize(t,e)}async start(){await this._remote.start()}_worker;_remote;_bufferedStdin}}}]);