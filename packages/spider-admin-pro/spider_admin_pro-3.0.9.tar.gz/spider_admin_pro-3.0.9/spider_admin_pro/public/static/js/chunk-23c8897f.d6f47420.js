(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-23c8897f"],{"1c5f":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-select",e._g(e._b({attrs:{placeholder:"选择项目"},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.list,(function(e){return r("el-option",{attrs:{label:e.project,value:e.project}})})),1)},s=[],a=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{scrapydServerId:{type:String},value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{resetData:function(){this.getData()},getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.scrapydServerId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$Http.scrapydListProjects({scrapydServerId:this.scrapydServerId});case 4:t=e.sent,this.list=t.data,this.$emit("on-init",t.data);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,s,!1,null,"5bef0aae",null);t["a"]=l.exports},3629:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-autocomplete",e._g(e._b({attrs:{"fetch-suggestions":e.querySearch,placeholder:"搜索Spider名",clearable:""},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.item;return[r("span",[e._v(e._s(n.spider))])]}}]),model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-autocomplete",e.$attrs,!1),e.$listeners))},s=[],a=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{value:{type:String},project:{type:String},scrapydServerId:{type:String}},components:{},data:function(){return{list:[]}},watch:{project:{handler:function(e){e?this.getData():this.list=[]},immediate:!0}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{resetData:function(){this.list=[],this.getData()},querySearch:function(e,t){var r=e?this.filterItem(e):this.list;t(r)},filterItem:function(e){return this.list.filter((function(t){return 0==t.spider.toLowerCase().indexOf(e.toLowerCase())}))},handleSelect:function(e){this._value=e.spider,this.$emit("change",e.spider)},getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.scrapydServerId||!this.project){e.next=3;break}e.next=4;break;case 3:return e.abrupt("return");case 4:return e.next=6,this.$Http.scrapydlistSpiders({scrapydServerId:this.scrapydServerId,project:this.project});case 6:t=e.sent,this.list=t.data,this.$emit("on-init",t.data);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,s,!1,null,"7f67d261",null);t["a"]=l.exports},"61e0":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-select",e._g(e._b({attrs:{placeholder:"选择服务"},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.list,(function(e){return r("el-option",{attrs:{label:e.label,value:e.value}})})),1)},s=[],a=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t,r;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.getScrapydServerPage();case 2:t=e.sent,r=t.data.list.map((function(e){return{label:e.server_name,value:e.id+""}})),this.list=r,this.$emit("on-init",{list:r});case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,s,!1,null,"a9e36160",null);t["a"]=l.exports},9220:function(e,t,r){},cfd7:function(e,t,r){"use strict";r("9220")},d995:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("ScheduleLogTool",{attrs:{status:e.status,project:e.project,spider:e.spider,scrapydServerId:e.scrapydServerId,schedule_job_id:e.schedule_job_id,statusInfo:e.statusInfo},on:{"update:status":function(t){e.status=t},"update:project":function(t){e.project=t},"update:spider":function(t){e.spider=t},"update:scrapydServerId":function(t){e.scrapydServerId=t},"update:scrapyd-server-id":function(t){e.scrapydServerId=t},"status-change":e.handleStatusChange,"project-change":e.handleProjectChange,"spider-change":e.handleSpiderChange,success:e.handleSuccess}}),e._v(" "),r("div",{staticStyle:{height:"20px"}}),e._v(" "),r("ScheduleLogTable",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{data:e.list}}),e._v(" "),r("mo-pagination",{attrs:{"current-page":e.page,"page-size":e.size,total:e.count},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},change:e.getData}})],1)},s=[],a=r("6194"),c=(r("5dce"),r("29ca")),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("mo-table",e._g(e._b({},"mo-table",e.$attrs,!1),e.$listeners),[r("el-table-column",{attrs:{align:"center",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.$index+1)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"项目名",align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.project)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"Spider",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.spider)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"调度模式",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.schedule_mode)+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"调度状态",align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("mo-status",{attrs:{value:e.row.status}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"错误消息",align:"center",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(e){return[r("mo-text",{attrs:{text:e.row.message}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"运行状态",align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.run_status||"-")+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"item",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.item_count||"-")+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"error",align:"center",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.log_error_count||"-")+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"持续时间",align:"right",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.duration_str||"-")+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"运行日志",align:"center",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.spider_job_id?r("router-link",{attrs:{to:{name:"logs-project-spider-job",query:{scrapydServerId:t.row.scrapyd_server_id,project:t.row.project,spider:t.row.spider,job:t.row.spider_job_id}},target:"_blank"}},[r("i",{staticClass:"el-icon-document"}),e._v(" 日志")]):r("span",[e._v("-")])]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"调度时间",align:"center",width:"170px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.create_time)+"\n      ")]}}])})],1)],1)},o=[],u={name:""},l=u,d=r("c9cd"),p=Object(d["a"])(l,i,o,!1,null,"552f1c5d",null),h=p.exports,f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{},[r("el-radio-group",{attrs:{size:"small"},model:{value:e._status,callback:function(t){e._status=t},expression:"_status"}},[r("el-radio-button",{attrs:{label:"total"}},[e._v("全部 "+e._s(e.statusInfo.total))]),e._v(" "),r("el-radio-button",{attrs:{label:"success"}},[e._v("成功 "+e._s(e.statusInfo.success))]),e._v(" "),r("el-radio-button",{attrs:{label:"error"}},[e._v("失败 "+e._s(e.statusInfo.error))])],1),e._v(" "),r("SelectScrapydServer",{staticClass:"ml-md",attrs:{value:e._scrapydServerId,clearable:""},on:{"on-init":e.handleSelectScrapydServerInit,change:e.handleScrapydServerChange}}),e._v(" "),e.scrapydServerId?r("ProjectSelect",{key:e.scrapydServerId,ref:"ProjectSelect",staticClass:"ml-sm",attrs:{size:"small",scrapydServerId:e.scrapydServerId,value:e._project,clearable:!0,filterable:!0,"allow-create":!0},on:{"update:value":function(t){e._project=t}}}):e._e(),e._v(" "),r("SpiderSearch",{staticClass:"ml-sm",attrs:{size:"small",scrapydServerId:e.scrapydServerId,project:e._project,value:e._spider,clearable:!0},on:{"update:value":function(t){e._spider=t},change:e.handleSpiderChange}}),e._v(" "),r("ScheduleLogRemove",{staticClass:"ml-md",attrs:{status:e.status,project:e.project,spider:e.spider,schedule_job_id:e.schedule_job_id,scrapydServerId:e.scrapydServerId},on:{success:function(t){return e.$emit("success")}}}),e._v(" "),r("AutoRefresh",{staticClass:"ml-sm",attrs:{frequency:5e3},on:{refresh:function(t){return e.$emit("success")}}})],1)},v=[],_=r("1c5f"),m=r("3629"),g=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-popconfirm",{attrs:{title:"确定删除？"},on:{confirm:e.handleDelete}},[r("el-button",e._b({attrs:{slot:"reference",size:"small",icon:"el-icon-delete"},slot:"reference"},"el-button",e.$attrs,!1),[e._v("删除列表")])],1)},b=[],S={name:"",props:{status:{type:String},project:{type:String,default:""},spider:{type:String,default:""},schedule_job_id:{type:String,default:""},scrapydServerId:{type:String,default:""}},components:{},data:function(){return{}},computed:{},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),handleDelete:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scheduleRemoveScheduleLogs({status:this.status,project:this.project,spider:this.spider,schedule_job_id:this.schedule_job_id,scrapydServerId:this.scrapydServerId});case 2:t=e.sent,0==t.code?(this.$message.success("删除成功"),this.$emit("success")):this.$message.error(t.msg);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},y=S,j=Object(d["a"])(y,g,b,!1,null,"5b7e6988",null),w=j.exports,I=r("ef1e"),$=r("61e0"),x={name:"",props:{status:{type:String},project:{type:String,default:""},spider:{type:String,default:""},scrapydServerId:{type:String,default:""},schedule_job_id:{type:String,default:""},statusInfo:{type:Object,default:function(){return{}}}},components:{ProjectSelect:_["a"],SpiderSearch:m["a"],ScheduleLogRemove:w,AutoRefresh:I["a"],SelectScrapydServer:$["a"]},data:function(){return{hasScrapydServerIdInit:!1}},computed:{_status:{get:function(){return this.status},set:function(e){this.$emit("update:status",e),this.$emit("status-change",e)}},_project:{get:function(){return this.project},set:function(e){this.$emit("update:project",e),this.$emit("project-change",e)}},_spider:{get:function(){return this.spider},set:function(e){this.$emit("update:spider",e)}},_scrapydServerId:{get:function(){return this.scrapydServerId},set:function(e){this.$emit("update:scrapydServerId",e)}}},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}(),handleSpiderChange:function(e){this.$emit("spider-change",e)},handleSelectScrapydServerInit:function(e){},handleScrapydServerChange:function(e){console.log(e),this._scrapydServerId=e,this._project=null}},created:function(){this.getData()}},D=x,k=Object(d["a"])(D,f,v,!1,null,"e2e018c6",null),O=k.exports,C={name:"",props:[],components:{ScheduleLogTable:h,ScheduleLogTool:O},data:function(){return{list:[],total:0,page:1,size:20,listLoading:!1,status:"total",project:"",spider:"",schedule_job_id:"",scrapydServerId:"",statusInfo:{}}},computed:{count:function(){return this.statusInfo[this.status]}},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.listLoading=!0,e.next=3,this.$Http.scheduleScheduleLogs({page:this.page,size:this.size,status:this.status,project:this.project,spider:this.spider,schedule_job_id:this.schedule_job_id,scrapydServerId:this.scrapydServerId});case 3:t=e.sent,0==t.code&&(this.list=t.data.list,this.total=t.data.total,this.statusInfo={total:t.data.total,success:t.data.success,error:t.data.error}),this.listLoading=!1;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleStatusChange:function(){this.page=1,this.getData()},handleProjectChange:function(){this.page=1,this.getData()},handleSpiderChange:function(){this.page=1,this.getData()},handleSuccess:function(){this.page=1,this.getData()}},created:function(){this.scrapydServerId=this.$route.query.scrapydServerId,this.schedule_job_id=this.$route.query.job,this.project=this.$route.query.project,this.spider=this.$route.query.spider,this.getData()}},R=C,L=Object(d["a"])(R,n,s,!1,null,"9163b62e",null);t["default"]=L.exports},ef1e:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",[r("el-button",{attrs:{size:"small"},on:{click:e.changeAutoRefresh}},[e._v(e._s(e.autoRefreshText))]),e._v(" "),r("span",{staticClass:"tips"},[e._v(e._s(e.countDownText))])],1)},s=[],a=(r("0ef1"),{name:"",props:{frequency:{type:Number,default:3e3}},components:{},data:function(){return{timer:null,countDown:0}},computed:{autoRefreshText:function(){return null==this.timer?"开启自动刷新":"关闭自动刷新"},countDownText:function(){return null==this.timer?"":(console.log(this.countDown),this.countDown+" 秒后自动刷新")}},methods:{autoRefresh:function(){console.log("refresh"),this.$emit("refresh"),this.resetCountDown()},countDownReduce:function(){this.countDown--},resetCountDown:function(){this.countDown=Math.ceil(.001*this.frequency)},openAutoRefresh:function(){var e=this;this.resetCountDown(),this.countDownTimer=setInterval((function(){e.countDownReduce()}),1e3),this.timer=setInterval((function(){e.autoRefresh()}),this.frequency),console.log("启动自动刷新")},closeAutoRefresh:function(){clearInterval(this.timer),clearInterval(this.countDownTimer),console.log("关闭自动刷新"),this.timer=null,this.countDownTimer=null},changeAutoRefresh:function(){this.timer?this.closeAutoRefresh():this.openAutoRefresh()}},beforeDestroy:function(){this.closeAutoRefresh()},created:function(){}}),c=a,i=(r("cfd7"),r("c9cd")),o=Object(i["a"])(c,n,s,!1,null,"3b21a7d2",null);t["a"]=o.exports}}]);