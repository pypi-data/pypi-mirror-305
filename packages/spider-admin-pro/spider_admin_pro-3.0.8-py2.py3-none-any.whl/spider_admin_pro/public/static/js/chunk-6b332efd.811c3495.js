(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6b332efd"],{"1c5f":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-select",t._g(t._b({attrs:{placeholder:"选择项目"},model:{value:t._value,callback:function(e){t._value=e},expression:"_value"}},"el-select",t.$attrs,!1),t.$listeners),t._l(t.list,(function(t){return n("el-option",{attrs:{label:t.project,value:t.project}})})),1)},s=[],a=n("6194"),c=(n("5dce"),n("29ca")),o={name:"",props:{scrapydServerId:{type:String},value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(t){this.$emit("update:value",t)}}},methods:{resetData:function(){this.getData()},getData:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){var e;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.scrapydServerId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.$Http.scrapydListProjects({scrapydServerId:this.scrapydServerId});case 4:e=t.sent,this.list=e.data,this.$emit("on-init",e.data);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},i=o,u=n("c9cd"),l=Object(u["a"])(i,r,s,!1,null,"5bef0aae",null);e["a"]=l.exports},"61e0":function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-select",t._g(t._b({attrs:{placeholder:"选择服务"},model:{value:t._value,callback:function(e){t._value=e},expression:"_value"}},"el-select",t.$attrs,!1),t.$listeners),t._l(t.list,(function(t){return n("el-option",{attrs:{label:t.label,value:t.value}})})),1)},s=[],a=n("6194"),c=(n("5dce"),n("29ca")),o={name:"",props:{value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(t){this.$emit("update:value",t)}}},methods:{getData:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){var e,n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$Http.getScrapydServerPage();case 2:e=t.sent,n=e.data.list.map((function(t){return{label:t.server_name,value:t.id+""}})),this.list=n,this.$emit("on-init",{list:n});case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},i=o,u=n("c9cd"),l=Object(u["a"])(i,r,s,!1,null,"a9e36160",null);e["a"]=l.exports},9220:function(t,e,n){},"93b4":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("JobTool",{attrs:{statusInfo:t.statusInfo,status:t.status,scrapydServerId:t.scrapydServerId,project:t.project},on:{"update:status":function(e){t.status=e},"update:scrapydServerId":function(e){t.scrapydServerId=e},"update:scrapyd-server-id":function(e){t.scrapydServerId=e},"update:project":function(e){t.project=e},"status-change":t.handleStatusChange,"project-change":t.handleProjcetChange,success:t.getData,"on-init":t.handleSpiderToolInit}}),t._v(" "),n("div",{staticStyle:{height:"20px"}}),t._v(" "),n("JobTable",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list,scrapydServerId:t.scrapydServerId,project:t.project},on:{success:t.getData}})],1)},s=[],a=n("6194"),c=(n("5dce"),n("29ca")),o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("mo-table",t._g(t._b({},"mo-table",t.$attrs,!1),t.$listeners),[n("el-table-column",{attrs:{align:"center",label:"序号",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n      "+t._s(e.$index+1)+"\n    ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"Spider",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n      "+t._s(e.row.spider)+"\n    ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"状态",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n      "+t._s(e.row.status)+"\n    ")]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"持续时间",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("mo-text",{attrs:{text:t.row.duration_str}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"开始时间",align:"center",width:"170px"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("mo-text",{attrs:{text:t.row.start_time}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"结束时间",align:"center",width:"170px"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("mo-text",{attrs:{text:t.row.end_time}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"PID",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(t){return[n("mo-text",{attrs:{text:t.row.pid+""}})]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"查看日志",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("router-link",{attrs:{to:{name:"logs-project-spider-job",query:{scrapydServerId:t.scrapydServerId,project:t.project,spider:e.row.spider,job:e.row.id}},target:"_blank"}},[n("i",{staticClass:"el-icon-document"}),t._v(" 查看")])]}}])}),t._v(" "),n("el-table-column",{attrs:{label:"取消运行",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("JobCancel",{attrs:{job:e.row.id,project:t.project,scrapydServerId:t.scrapydServerId,disabled:"finished"==e.row.status},on:{success:function(e){return t.$emit("success")}}})]}}])})],1)},i=[],u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[n("el-button",t._b({attrs:{size:"mini"},on:{click:t.handleCancel}},"el-button",t.$attrs,!1),[t._v("取消")])],1)},l=[],d={name:"",props:{job:{type:String},project:{type:String},scrapydServerId:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleCancel:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){var e;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$Http.scrapydCancel({project:this.project,job:this.job,scrapydServerId:this.scrapydServerId});case 2:e=t.sent,0==e.code?(this.$message.success("取消成功"),this.$emit("success")):this.$message.error(e.msg);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){}},p=d,h=n("c9cd"),f=Object(h["a"])(p,u,l,!1,null,"7f3ff5e3",null),v=f.exports,m={name:"",props:{scrapydServerId:{type:String,default:""},project:{type:String,default:""}},components:{JobCancel:v},data:function(){return{}},computed:{},methods:{getData:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},b=m,_=Object(h["a"])(b,o,i,!1,null,"0669d288",null),g=_.exports,S=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{},[n("el-radio-group",{attrs:{size:"small"},model:{value:t._status,callback:function(e){t._status=e},expression:"_status"}},[n("el-radio-button",{attrs:{label:""}},[t._v("全部 "+t._s(t.statusInfo.total))]),t._v(" "),n("el-radio-button",{attrs:{label:"pending"}},[t._v("等待中 "+t._s(t.statusInfo.pending))]),t._v(" "),n("el-radio-button",{attrs:{label:"running"}},[t._v("运行中 "+t._s(t.statusInfo.running))]),t._v(" "),n("el-radio-button",{attrs:{label:"finished"}},[t._v("已结束 "+t._s(t.statusInfo.finished))])],1),t._v(" "),n("SelectScrapydServer",{staticClass:"ml-sm",attrs:{value:t._scrapydServerId},on:{"update:value":function(e){t._scrapydServerId=e},"on-init":t.handleSelectScrapydServerInit,change:t.handleScrapydServerChange}}),t._v(" "),n("ProjectSelect",{ref:"ProjectSelect",staticClass:"ml-sm",attrs:{size:"small",scrapydServerId:t.scrapydServerId,value:t._project},on:{"update:value":function(e){t._project=e},"on-init":t.handleProjectSelectInit}}),t._v(" "),n("JobCancelAll",{staticClass:"ml-sm",attrs:{scrapydServerId:t.scrapydServerId,project:t.project,size:"small"}}),t._v(" "),n("AutoRefresh",{staticClass:"ml-sm",on:{refresh:function(e){return t.$emit("success")}}})],1)},y=[],j=n("ef1e"),I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-button",t._b({on:{click:t.handleCancel}},"el-button",t.$attrs,!1),[t._v("取消所有任务")])},w=[],$={name:"",props:{project:{type:String},scrapydServerId:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleCancel:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){var e;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$Http.scrapydCancelAllJob({project:this.project,scrapydServerId:this.scrapydServerId});case 2:e=t.sent,0==e.code?this.$message.success("取消成功"):this.$message.error(e.msg);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){}},x=$,D=Object(h["a"])(x,I,w,!1,null,"2cd747f0",null),k=D.exports,O=n("1c5f"),C=n("61e0"),T={name:"",components:{AutoRefresh:j["a"],JobCancelAll:k,SelectScrapydServer:C["a"],ProjectSelect:O["a"]},props:{status:{type:String},scrapydServerId:{type:String,default:""},project:{type:String,default:""},statusInfo:{type:Object,default:function(){return{}}}},data:function(){return{}},computed:{_status:{get:function(){return this.status},set:function(t){this.$emit("update:status",t),this.$emit("status-change",t)}},_project:{get:function(){return this.project},set:function(t){this.$emit("update:project",t),this.$emit("project-change",t)}},_scrapydServerId:{get:function(){return this.scrapydServerId},set:function(t){this.$emit("update:scrapydServerId",t),this.$emit("scrapydServerId-change",t)}}},methods:{handleProjectSelectInit:function(t){this.$emit("on-init",t)},handleScrapydServerChange:function(){var t=this;this.$nextTick((function(){t.$refs.ProjectSelect.resetData()}))},handleSelectScrapydServerInit:function(t){var e=this;this._scrapydServerId||t.list&&t.list.length>0&&(this._scrapydServerId=t.list[0].value,this.$nextTick((function(){e.$refs.ProjectSelect.resetData()})))}},created:function(){}},R=T,A=Object(h["a"])(R,S,y,!1,null,"6bf99af1",null),J=A.exports,P={name:"",props:[],components:{JobTable:g,JobTool:J},data:function(){return{status:"",project:"",list:[],listLoading:!0,scrapydServerId:"",statusInfo:{total:0,finished:0,pending:0,running:0}}},computed:{},methods:{getData:function(){var t=Object(c["a"])(Object(a["a"])().mark((function t(){var e;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.scrapydServerId||!this.project){t.next=3;break}t.next=4;break;case 3:return t.abrupt("return");case 4:return this.listLoading=!0,t.next=7,this.$Http.scrapydlistJobsMerge({project:this.project,status:this.status,scrapydServerId:this.scrapydServerId});case 7:e=t.sent,0==e.code?(this.list=e.data.list,this.statusInfo.total=e.data.total,this.statusInfo.pending=e.data.pending,this.statusInfo.running=e.data.running,this.statusInfo.finished=e.data.finished):this.$message.error(e.msg),this.listLoading=!1;case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleStatusChange:function(){this.getData()},handleProjcetChange:function(t){t&&(this.project=t,localStorage.setItem("project",t),this.getData())},handleSpiderToolInit:function(t){console.log("handleSpiderToolInit",t),t&&t.length>0&&(this.project=t[0].project),this.project&&this.getData()}},created:function(){this.scrapydServerId=this.$route.query.scrapydServerId,this.project=this.$route.query.project,this.$route.query.status&&(this.status=this.$route.query.status)}},q=P,E=Object(h["a"])(q,r,s,!1,null,"6d392a63",null);e["default"]=E.exports},cfd7:function(t,e,n){"use strict";n("9220")},ef1e:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",[n("el-button",{attrs:{size:"small"},on:{click:t.changeAutoRefresh}},[t._v(t._s(t.autoRefreshText))]),t._v(" "),n("span",{staticClass:"tips"},[t._v(t._s(t.countDownText))])],1)},s=[],a=(n("0ef1"),{name:"",props:{frequency:{type:Number,default:3e3}},components:{},data:function(){return{timer:null,countDown:0}},computed:{autoRefreshText:function(){return null==this.timer?"开启自动刷新":"关闭自动刷新"},countDownText:function(){return null==this.timer?"":(console.log(this.countDown),this.countDown+" 秒后自动刷新")}},methods:{autoRefresh:function(){console.log("refresh"),this.$emit("refresh"),this.resetCountDown()},countDownReduce:function(){this.countDown--},resetCountDown:function(){this.countDown=Math.ceil(.001*this.frequency)},openAutoRefresh:function(){var t=this;this.resetCountDown(),this.countDownTimer=setInterval((function(){t.countDownReduce()}),1e3),this.timer=setInterval((function(){t.autoRefresh()}),this.frequency),console.log("启动自动刷新")},closeAutoRefresh:function(){clearInterval(this.timer),clearInterval(this.countDownTimer),console.log("关闭自动刷新"),this.timer=null,this.countDownTimer=null},changeAutoRefresh:function(){this.timer?this.closeAutoRefresh():this.openAutoRefresh()}},beforeDestroy:function(){this.closeAutoRefresh()},created:function(){}}),c=a,o=(n("cfd7"),n("c9cd")),i=Object(o["a"])(c,r,s,!1,null,"3b21a7d2",null);e["a"]=i.exports}}]);