(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d8f8b15"],{1905:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"app-container"},[r("StatsTool",{attrs:{scrapydServerId:t.scrapydServerId,project:t.project,spider:t.spider},on:{"update:scrapydServerId":function(e){t.scrapydServerId=e},"update:scrapyd-server-id":function(e){t.scrapydServerId=e},"update:project":function(e){t.project=e},"update:spider":function(e){t.spider=e},"project-change":t.handleProjectChange,"spider-change":t.handleSpiderChange,success:t.handleSuccess}}),t._v(" "),r("div",{staticStyle:{height:"20px"}}),t._v(" "),r("StatsTable",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list},on:{"sort-change":t.handleSortChange}}),t._v(" "),r("mo-pagination",{attrs:{"current-page":t.page,"page-size":t.size,total:t.total},on:{"update:currentPage":function(e){t.page=e},"update:current-page":function(e){t.page=e},change:t.getData}})],1)},a=[],s=r("6194"),c=(r("5dce"),r("29ca")),i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{},[r("mo-table",t._g(t._b({},"mo-table",t.$attrs,!1),t.$listeners),[r("el-table-column",{attrs:{align:"center",label:"序号",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.$index+1)+"\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"项目名",align:"center",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n        "+t._s(e.row.project||"-")+"\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"Spider",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\n        "+t._s(e.row.spider)+"\n\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"收集数量",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("mo-text",{attrs:{text:t.row.item_scraped_count+""}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"丢弃数量",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("mo-text",{attrs:{text:t.row.item_dropped_count+""}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"错误日志",align:"center",width:"110px",prop:"log_error_count",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("mo-text",{attrs:{text:t.row.log_error_count+""}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"持续时间",align:"right",width:"110px",prop:"duration",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("mo-text",{attrs:{text:t.row.duration_str}})]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"开始时间",align:"center",width:"170px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\n        "+t._s(e.row.start_time)+"\n\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"结束时间",align:"center",width:"170px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n\n        "+t._s(e.row.finish_time)+"\n\n      ")]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"运行日志",align:"center",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("router-link",{attrs:{to:{name:"logs-project-spider-job",params:{project:e.row.project,spider:e.row.spider,job:e.row.spider_job_id}},target:"_blank"}},[r("i",{staticClass:"el-icon-document"}),t._v(" 日志")])]}}])})],1)],1)},o=[],u={name:""},l=u,p=r("c9cd"),d=Object(p["a"])(l,i,o,!1,null,"b8960dec",null),h=d.exports,f=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{},[r("SelectScrapydServer",{attrs:{value:t._scrapydServerId},on:{"update:value":function(e){t._scrapydServerId=e},"on-init":t.handleSelectScrapydServerInit,change:t.handleScrapydServerChange}}),t._v(" "),t.scrapydServerId?r("ProjectSelect",{key:t.scrapydServerId,staticClass:"ml-sm",attrs:{value:t._project,clearable:!0,filterable:!0,"allow-create":!0},on:{"update:value":function(e){t._project=e}}}):t._e(),t._v(" "),r("SpiderSearch",{staticClass:"ml-sm",attrs:{size:"small",project:t._project,value:t._spider,clearable:!0},on:{"update:value":function(e){t._spider=e},change:t.handleSpiderChange}}),t._v(" "),r("StatsRemove",{staticStyle:{"margin-left":"20px"},attrs:{status:t.status,project:t.project,spider:t.spider,schedule_job_id:t.schedule_job_id},on:{success:function(e){return t.$emit("success")}}}),t._v(" "),r("AutoRefresh",{staticClass:"ml-sm",attrs:{frequency:5e3},on:{refresh:function(e){return t.$emit("success")}}}),t._v(" "),r("el-tooltip",{attrs:{effect:"dark",content:"",placement:"top-start"}},[r("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n      使用\n      "),r("a",{attrs:{href:"https://github.com/mouday/scrapy-util",target:"_blank"}},[t._v("scrapy-util")]),t._v("\n      收集运行日志\n    ")]),t._v(" "),r("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#808080"}})])],1)},v=[],m=r("1c5f"),_=r("3629"),g=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-popconfirm",{attrs:{title:"确定删除？"},on:{confirm:t.handleDelete}},[r("el-button",t._b({attrs:{slot:"reference",size:"small",icon:"el-icon-delete"},slot:"reference"},"el-button",t.$attrs,!1),[t._v("删除列表")])],1)},b=[],S={name:"",props:{project:{type:String,default:""},spider:{type:String,default:""}},components:{},data:function(){return{}},computed:{},methods:{getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),handleDelete:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){var e;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$Http.statsCollectionDelete({project:this.project,spider:this.spider});case 2:e=t.sent,0==e.code?(this.$message.success("删除成功"),this.$emit("success")):this.$message.error(e.msg);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},y=S,j=Object(p["a"])(y,g,b,!1,null,"052c5be0",null),w=j.exports,x=r("ef1e"),$=r("61e0"),D={name:"",props:{status:{type:String},project:{type:String,default:""},spider:{type:String,default:""},schedule_job_id:{type:String,default:""},scrapydServerId:{type:String,default:""},statusInfo:{type:Object,default:function(){return{}}}},components:{SelectScrapydServer:$["a"],ProjectSelect:m["a"],SpiderSearch:_["a"],StatsRemove:w,AutoRefresh:x["a"]},data:function(){return{}},computed:{_scrapydServerId:{get:function(){return this.scrapydServerId},set:function(t){this.$emit("update:scrapydServerId",t)}},_status:{get:function(){return this.status},set:function(t){this.$emit("update:status",t),this.$emit("status-change",t)}},_project:{get:function(){return this.project},set:function(t){this.$emit("update:project",t),this.$emit("project-change",t)}},_spider:{get:function(){return this.spider},set:function(t){this.$emit("update:spider",t)}}},methods:{getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}(),handleSpiderChange:function(t){this.$emit("spider-change",t)},handleSelectScrapydServerInit:function(t){},handleScrapydServerChange:function(t){console.log(t),this._scrapydServerId=t,this._project=null}},created:function(){this.getData()}},I=D,k=Object(p["a"])(I,f,v,!1,null,"0e2deb34",null),O=k.exports,C={name:"",props:[],components:{StatsTable:h,StatsTool:O},data:function(){return{list:[],total:0,page:1,size:20,listLoading:!1,project:"",spider:"",orderProp:"",orderType:"",scrapydServerId:""}},computed:{},methods:{getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){var e;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.listLoading=!0,t.next=3,this.$Http.statsCollectionListItem({page:this.page,size:this.size,scrapydServerId:this.scrapydServerId,project:this.project,spider:this.spider,order_prop:this.orderProp,order_type:this.orderType});case 3:e=t.sent,0==e.code&&(this.list=e.data.list,this.total=e.data.total),this.listLoading=!1;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),handleProjectChange:function(){this.page=1,this.getData()},handleSpiderChange:function(){this.page=1,this.getData()},handleSuccess:function(){this.page=1,this.getData()},handleSortChange:function(t){var e=t.column,r=t.prop,n=t.order;console.log(e,r,n),this.orderType=n,this.orderType?this.orderProp=r:this.orderProp=null,this.page=1,this.getData()}},created:function(){this.scrapydServerId=this.$route.query.scrapydServerId,this.project=this.$route.query.project,this.spider=this.$route.query.spider,this.getData()}},R=C,T=Object(p["a"])(R,n,a,!1,null,"bfa3ef92",null);e["default"]=T.exports},"1c5f":function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-select",t._g(t._b({attrs:{placeholder:"选择项目"},model:{value:t._value,callback:function(e){t._value=e},expression:"_value"}},"el-select",t.$attrs,!1),t.$listeners),t._l(t.list,(function(t){return r("el-option",{attrs:{label:t.project,value:t.project}})})),1)},a=[],s=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{scrapydServerId:{type:String},value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(t){this.$emit("update:value",t)}}},methods:{resetData:function(){this.getData()},getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){var e;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.scrapydServerId){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.$Http.scrapydListProjects({scrapydServerId:this.scrapydServerId});case 4:e=t.sent,this.list=e.data,this.$emit("on-init",e.data);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,a,!1,null,"5bef0aae",null);e["a"]=l.exports},3629:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-autocomplete",t._g(t._b({attrs:{"fetch-suggestions":t.querySearch,placeholder:"搜索Spider名",clearable:""},on:{select:t.handleSelect},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.item;return[r("span",[t._v(t._s(n.spider))])]}}]),model:{value:t._value,callback:function(e){t._value=e},expression:"_value"}},"el-autocomplete",t.$attrs,!1),t.$listeners))},a=[],s=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{value:{type:String},project:{type:String},scrapydServerId:{type:String}},components:{},data:function(){return{list:[]}},watch:{project:{handler:function(t){t?this.getData():this.list=[]},immediate:!0}},computed:{_value:{get:function(){return this.value},set:function(t){this.$emit("update:value",t)}}},methods:{resetData:function(){this.list=[],this.getData()},querySearch:function(t,e){var r=t?this.filterItem(t):this.list;e(r)},filterItem:function(t){return this.list.filter((function(e){return 0==e.spider.toLowerCase().indexOf(t.toLowerCase())}))},handleSelect:function(t){this._value=t.spider,this.$emit("change",t.spider)},getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){var e;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.scrapydServerId||!this.project){t.next=3;break}t.next=4;break;case 3:return t.abrupt("return");case 4:return t.next=6,this.$Http.scrapydlistSpiders({scrapydServerId:this.scrapydServerId,project:this.project});case 6:e=t.sent,this.list=e.data,this.$emit("on-init",e.data);case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,a,!1,null,"7f67d261",null);e["a"]=l.exports},"61e0":function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-select",t._g(t._b({attrs:{placeholder:"选择服务"},model:{value:t._value,callback:function(e){t._value=e},expression:"_value"}},"el-select",t.$attrs,!1),t.$listeners),t._l(t.list,(function(t){return r("el-option",{attrs:{label:t.label,value:t.value}})})),1)},a=[],s=r("6194"),c=(r("5dce"),r("29ca")),i={name:"",props:{value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(t){this.$emit("update:value",t)}}},methods:{getData:function(){var t=Object(c["a"])(Object(s["a"])().mark((function t(){var e,r;return Object(s["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$Http.getScrapydServerPage();case 2:e=t.sent,r=e.data.list.map((function(t){return{label:t.server_name,value:t.id+""}})),this.list=r,this.$emit("on-init",{list:r});case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},created:function(){this.getData()}},o=i,u=r("c9cd"),l=Object(u["a"])(o,n,a,!1,null,"a9e36160",null);e["a"]=l.exports},9220:function(t,e,r){},cfd7:function(t,e,r){"use strict";r("9220")},ef1e:function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",[r("el-button",{attrs:{size:"small"},on:{click:t.changeAutoRefresh}},[t._v(t._s(t.autoRefreshText))]),t._v(" "),r("span",{staticClass:"tips"},[t._v(t._s(t.countDownText))])],1)},a=[],s=(r("0ef1"),{name:"",props:{frequency:{type:Number,default:3e3}},components:{},data:function(){return{timer:null,countDown:0}},computed:{autoRefreshText:function(){return null==this.timer?"开启自动刷新":"关闭自动刷新"},countDownText:function(){return null==this.timer?"":(console.log(this.countDown),this.countDown+" 秒后自动刷新")}},methods:{autoRefresh:function(){console.log("refresh"),this.$emit("refresh"),this.resetCountDown()},countDownReduce:function(){this.countDown--},resetCountDown:function(){this.countDown=Math.ceil(.001*this.frequency)},openAutoRefresh:function(){var t=this;this.resetCountDown(),this.countDownTimer=setInterval((function(){t.countDownReduce()}),1e3),this.timer=setInterval((function(){t.autoRefresh()}),this.frequency),console.log("启动自动刷新")},closeAutoRefresh:function(){clearInterval(this.timer),clearInterval(this.countDownTimer),console.log("关闭自动刷新"),this.timer=null,this.countDownTimer=null},changeAutoRefresh:function(){this.timer?this.closeAutoRefresh():this.openAutoRefresh()}},beforeDestroy:function(){this.closeAutoRefresh()},created:function(){}}),c=s,i=(r("cfd7"),r("c9cd")),o=Object(i["a"])(c,n,a,!1,null,"3b21a7d2",null);e["a"]=o.exports}}]);