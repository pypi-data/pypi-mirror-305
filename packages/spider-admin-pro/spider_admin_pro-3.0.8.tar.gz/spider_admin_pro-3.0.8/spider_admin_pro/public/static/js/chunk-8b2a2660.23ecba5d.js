(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8b2a2660"],{"699f":function(e,t,n){"use strict";var s=n("3c43"),r=n("277e")(5),a="find",c=!0;a in[]&&Array(1)[a]((function(){c=!1})),s(s.P+s.F*c,"Array",{find:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),n("7dbf")(a)},"776f":function(e,t,n){"use strict";n("dbc1")},dbc1:function(e,t,n){},e6b7:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app-container"},[n("ScheduleTool",{on:{success:e.getData}}),e._v(" "),n("div",{staticStyle:{height:"20px"}}),e._v(" "),n("ScheduleTable",{attrs:{data:e.list},on:{success:e.getData,"sort-change":e.handleSortChange}})],1)},r=[],a=n("6194"),c=(n("699f"),n("5dce"),n("29ca")),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{display:"flex"}},[n("ScheduleAdd",{on:{"on-success":e.handleSuccess}}),e._v(" "),n("ScheduleRemoveAllJob",{staticStyle:{"margin-left":"20px"},on:{success:e.handleSuccess}}),e._v(" "),n("ScheduleState",{staticStyle:{"margin-left":"20px"},on:{success:e.handleSuccess}})],1)},o=[],i=n("63d3"),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"schedule-state"},[n("span",{staticStyle:{"font-size":"14px",color:"#303133"}},[e._v("调度器控制：")]),e._v(" "),n("StartShutdown",{on:{success:e.handleSuccess},model:{value:e.startShutdownState,callback:function(t){e.startShutdownState=t},expression:"startShutdownState"}}),e._v(" "),n("PauseResume",{staticStyle:{"margin-left":"20px"},attrs:{disabled:"stopped"==e.startShutdownState},on:{success:e.handleSuccess},model:{value:e.pauseResumeState,callback:function(t){e.pauseResumeState=t},expression:"pauseResumeState"}})],1)},d=[],p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("mo-switch",e._g(e._b({attrs:{"active-value":"running","active-text":"继续","inactive-text":"暂停","inactive-value":"paused"},on:{change:e.handleChange}},"mo-switch",e.$attrs,!1),e.$listeners))},h=[],f={name:"",props:{},components:{},data:function(){return{state:""}},computed:{},methods:{handleChange:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(t){var n;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("paused"!=t){e.next=6;break}return e.next=3,this.$Http.schedulePause();case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,this.$Http.scheduleResume();case 8:n=e.sent;case 9:0==n.code?(this.$msg.success("操作成功"),this.$emit("success")):this.$msg.error(n.msg);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},created:function(){}},m=f,b=n("c9cd"),v=Object(b["a"])(m,p,h,!1,null,"02806c0f",null),_=v.exports,w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("mo-switch",e._g(e._b({attrs:{"active-value":"running","active-text":"开启","inactive-text":"停止","inactive-value":"stopped"},on:{change:e.handleChange}},"mo-switch",e.$attrs,!1),e.$listeners))},g=[],S={name:"",props:{},components:{},data:function(){return{state:""}},computed:{},methods:{handleChange:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(t){var n;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("stopped"!=t){e.next=6;break}return e.next=3,this.$Http.scheduleShutdown();case 3:n=e.sent,e.next=9;break;case 6:return e.next=8,this.$Http.scheduleStart();case 8:n=e.sent;case 9:0==n.code?(this.$msg.success("操作成功"),this.$emit("success")):this.$msg.error(n.msg);case 10:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},created:function(){}},x=S,y=Object(b["a"])(x,w,g,!1,null,"e4d9b0c6",null),j=y.exports,k="stopped",$="running",O="paused",R={name:"",props:{},components:{PauseResume:_,StartShutdown:j},data:function(){return{state:"",startShutdownState:"stopped",pauseResumeState:"paused"}},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scheduleState();case 2:t=e.sent,t.data.state==k?(this.startShutdownState=k,this.pauseResumeState=O):t.data.state==$?(this.startShutdownState=$,this.pauseResumeState=$):t.data.state==O&&(this.startShutdownState=$,this.pauseResumeState=O);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleSuccess:function(){this.getData(),this.$emit("success")}},created:function(){this.getData()}},E=R,C=(n("776f"),Object(b["a"])(E,l,d,!1,null,"63358618",null)),J=C.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popconfirm",{attrs:{title:"确定移除所有任务？"},on:{confirm:e.handleRemove}},[n("el-button",e._b({attrs:{slot:"reference",icon:"el-icon-delete",size:"mini"},slot:"reference"},"el-button",e.$attrs,!1),[e._v("移除所有任务")])],1)},P=[],A={name:"",props:{job_id:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleRemove:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scheduleRemoveAllJobs();case 2:t=e.sent,0==t.code?(this.$message.success("操作成功"),this.$emit("success")):this.$message.error(t.msg);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){}},D=A,T=Object(b["a"])(D,H,P,!1,null,"4eb6e001",null),I=T.exports,q={name:"",props:[],components:{ScheduleAdd:i["a"],ScheduleState:J,ScheduleRemoveAllJob:I},data:function(){return{}},computed:{},methods:{handleSuccess:function(){this.$emit("success")}},created:function(){}},z=q,N=Object(b["a"])(z,u,o,!1,null,"13b797c0",null),V=N.exports,F=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{},[n("mo-table",e._g(e._b({},"mo-table",e.$attrs,!1),e.$listeners),[n("el-table-column",{attrs:{align:"center",label:"序号",width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.$index+1)+"\n      ")]}}])}),e._v(" "),e._e(),e._v(" "),n("el-table-column",{attrs:{label:"项目名","header-align":"center",align:"left",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.kwargs.project)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Spider","header-align":"center",align:"left",prop:"spider","min-width":"100px",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.kwargs.spider)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"Cron",align:"center",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.kwargs.cron)+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"调度方式",align:"center",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{class:{"font-medium":t.row.kwargs.schedule_type==e.ScheduleTypeEnum.RANDOM_SERVER}},[e._v(e._s(t.row.schedule_type_label||"-"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"下次执行时间",align:"center",width:"170px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.next_run_time||"-")+"\n      ")]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"日志",align:"center",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("router-link",{attrs:{to:{name:"schedule-log-list",query:{project:t.row.kwargs.project,spider:t.row.kwargs.spider,scrapydServerId:t.row.kwargs.scrapyd_server_id,job:t.row.id}},target:"_blank"}},[e._v("调度")]),e._v(" "),n("router-link",{attrs:{to:{name:"logs-project-spider",query:{project:t.row.kwargs.project,spider:t.row.kwargs.spider,scrapydServerId:t.row.kwargs.scrapyd_server_id}},target:"_blank"}},[e._v("运行")]),e._v(" "),n("router-link",{attrs:{to:{name:"stats-list",query:{project:t.row.kwargs.project,spider:t.row.kwargs.spider,scrapydServerId:t.row.kwargs.scrapyd_server_id}},target:"_blank"}},[e._v("统计")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"状态",align:"center",width:"65"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("ScheduleJobStatus",{attrs:{job_id:t.row.id},model:{value:t.row.status,callback:function(n){e.$set(t.row,"status",n)},expression:"scope.row.status"}})]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("SpiderSchedule",{attrs:{project:t.row.kwargs.project,spider:t.row.kwargs.spider,scrapydServerId:t.row.kwargs.scrapyd_server_id,options:t.row.kwargs.options}}),e._v(" "),n("ScheduleAdd",{staticClass:"ml-sm",attrs:{job_id:t.row.id},on:{"on-success":function(t){return e.$emit("success")}}}),e._v(" "),n("ScheduleRemoveJob",{staticClass:"ml-sm",attrs:{job_id:t.row.id},on:{success:function(t){return e.$emit("success")}}})]}}])})],1)],1)},G=[],L=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-switch",e._g(e._b({attrs:{"active-value":"running","inactive-value":"paused"},on:{change:e.handleChange}},"el-switch",e.$attrs,!1),e.$listeners))},M=[],Y={name:"",props:{job_id:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleChange:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(t){var n,s;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n={job_id:this.job_id},"running"!=t){e.next=7;break}return e.next=4,this.$Http.scheduleResumeJob(n);case 4:s=e.sent,e.next=14;break;case 7:if("paused"!=t){e.next=13;break}return e.next=10,this.$Http.schedulePauseJob(n);case 10:s=e.sent,e.next=14;break;case 13:throw Error("value is invalid");case 14:0==s.code?this.$msg.success("操作成功"):this.$msg.error(s.msg);case 15:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},created:function(){}},B=Y,K=Object(b["a"])(B,L,M,!1,null,"e322d636",null),Q=K.exports,U=n("479c"),W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popconfirm",{attrs:{title:"确定删除？"},on:{confirm:e.handleRemove}},[n("el-button",e._b({staticClass:"color--danger",attrs:{slot:"reference",icon:"el-icon-delete",size:"mini",type:"text"},slot:"reference"},"el-button",e.$attrs,!1))],1)},X=[],Z={name:"",props:{job_id:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleRemove:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scheduleRemoveJob({job_id:this.job_id});case 2:t=e.sent,0==t.code?(this.$message.success("操作成功"),this.$emit("success")):this.$message.error(t.msg);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){}},ee=Z,te=Object(b["a"])(ee,W,X,!1,null,"66a46d5d",null),ne=te.exports,se=n("c05f"),re={name:"",props:[],components:{ScheduleAdd:i["a"],ScheduleJobStatus:Q,SpiderSchedule:U["a"],ScheduleRemoveJob:ne},data:function(){return{ScheduleTypeEnum:se["a"]}},computed:{},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},ae=re,ce=Object(b["a"])(ae,F,G,!1,null,"43d54212",null),ue=ce.exports,oe={name:"",props:[],components:{ScheduleTool:V,ScheduleTable:ue},data:function(){return{list:[],orderProp:"",orderType:""}},computed:{},methods:{getData:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t,n;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getScrapydServerPage();case 2:return t=e.sent,e.next=5,this.$Http.scheduleGetJobs();case 5:n=e.sent,0==n.code&&(this.list=n.data.map((function(e){var n=t.find((function(t){return t.vlaue==e.scrapyd_server_id}));if(e.scrapyd_server_label=n?n.label:"",e.kwargs.schedule_type==se["a"].ONLY_ONE_SERVER)e.schedule_type_label=e.scrapyd_server_label;else{var s=se["b"].find((function(t){return e.kwargs.schedule_type==t.value}));e.schedule_type_label=s?s.label:""}return e})));case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleSortChange:function(e){var t=e.column,n=e.prop,s=e.order;console.log(t,n,s),this.orderType=s,this.orderType?this.orderProp=n:this.orderProp=null},getScrapydServerPage:function(){var e=Object(c["a"])(Object(a["a"])().mark((function e(){var t,n;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.getScrapydServerPage();case 2:return t=e.sent,n=t.data.list.map((function(e){return{label:e.server_name,value:e.id+""}})),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},ie=oe,le=Object(b["a"])(ie,s,r,!1,null,"1a9e41f2",null);t["default"]=le.exports}}]);