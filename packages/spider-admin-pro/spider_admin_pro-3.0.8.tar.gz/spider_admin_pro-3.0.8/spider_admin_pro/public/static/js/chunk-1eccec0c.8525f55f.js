(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1eccec0c"],{"1c5f":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-select",e._g(e._b({attrs:{placeholder:"选择项目"},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.list,(function(e){return r("el-option",{attrs:{label:e.project,value:e.project}})})),1)},i=[],a=r("6194"),s=(r("5dce"),r("29ca")),c={name:"",props:{scrapydServerId:{type:String},value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{resetData:function(){this.getData()},getData:function(){var e=Object(s["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.scrapydServerId){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$Http.scrapydListProjects({scrapydServerId:this.scrapydServerId});case 4:t=e.sent,this.list=t.data,this.$emit("on-init",t.data);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},o=c,l=r("c9cd"),u=Object(l["a"])(o,n,i,!1,null,"5bef0aae",null);t["a"]=u.exports},"277e":function(e,t,r){var n=r("5bf0"),i=r("0d31"),a=r("4149"),s=r("d63b"),c=r("729c");e.exports=function(e,t){var r=1==e,o=2==e,l=3==e,u=4==e,d=6==e,p=5==e||d,f=t||c;return function(t,c,h){for(var v,m,b=a(t),S=i(b),y=n(c,h,3),_=s(S.length),g=0,j=r?f(t,_):o?f(t,0):void 0;_>g;g++)if((p||g in S)&&(v=S[g],m=y(v,g,b),e))if(r)j[g]=m;else if(m)switch(e){case 3:return!0;case 5:return v;case 6:return g;case 2:j.push(v)}else if(u)return!1;return d?-1:l||u?u:j}}},3629:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-autocomplete",e._g(e._b({attrs:{"fetch-suggestions":e.querySearch,placeholder:"搜索Spider名",clearable:""},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.item;return[r("span",[e._v(e._s(n.spider))])]}}]),model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-autocomplete",e.$attrs,!1),e.$listeners))},i=[],a=r("6194"),s=(r("5dce"),r("29ca")),c={name:"",props:{value:{type:String},project:{type:String},scrapydServerId:{type:String}},components:{},data:function(){return{list:[]}},watch:{project:{handler:function(e){e?this.getData():this.list=[]},immediate:!0}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{resetData:function(){this.list=[],this.getData()},querySearch:function(e,t){var r=e?this.filterItem(e):this.list;t(r)},filterItem:function(e){return this.list.filter((function(t){return 0==t.spider.toLowerCase().indexOf(e.toLowerCase())}))},handleSelect:function(e){this._value=e.spider,this.$emit("change",e.spider)},getData:function(){var e=Object(s["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.scrapydServerId||!this.project){e.next=3;break}e.next=4;break;case 3:return e.abrupt("return");case 4:return e.next=6,this.$Http.scrapydlistSpiders({scrapydServerId:this.scrapydServerId,project:this.project});case 6:t=e.sent,this.list=t.data,this.$emit("on-init",t.data);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){}},o=c,l=r("c9cd"),u=Object(l["a"])(o,n,i,!1,null,"7f67d261",null);t["a"]=u.exports},"479c":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-button",e._b({attrs:{type:"text",size:"mini",icon:"el-icon-video-play"},on:{click:e.handleSchedule}},"el-button",e.$attrs,!1))},i=[],a=r("6194"),s=(r("5dce"),r("29ca")),c={name:"",props:{spider:{type:String},project:{type:String},scrapydServerId:{type:String},options:{type:String}},components:{},data:function(){return{}},computed:{},methods:{handleSchedule:function(){var e=Object(s["a"])(Object(a["a"])().mark((function e(){var t;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scrapydSchedule({scrapydServerId:this.scrapydServerId,project:this.project,spider:this.spider,options:this.options});case 2:t=e.sent,0==t.code?this.$message.success("运行成功"):this.$message.error(t.msg);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){}},o=c,l=r("c9cd"),u=Object(l["a"])(o,n,i,!1,null,"1ed83d5a",null);t["a"]=u.exports},"61e0":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-select",e._g(e._b({attrs:{placeholder:"选择服务"},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"el-select",e.$attrs,!1),e.$listeners),e._l(e.list,(function(e){return r("el-option",{attrs:{label:e.label,value:e.value}})})),1)},i=[],a=r("6194"),s=(r("5dce"),r("29ca")),c={name:"",props:{value:{type:String}},components:{},data:function(){return{list:[]}},computed:{_value:{get:function(){return this.value},set:function(e){this.$emit("update:value",e)}}},methods:{getData:function(){var e=Object(s["a"])(Object(a["a"])().mark((function e(){var t,r;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.getScrapydServerPage();case 2:t=e.sent,r=t.data.list.map((function(e){return{label:e.server_name,value:e.id+""}})),this.list=r,this.$emit("on-init",{list:r});case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.getData()}},o=c,l=r("c9cd"),u=Object(l["a"])(o,n,i,!1,null,"a9e36160",null);t["a"]=u.exports},"63d3":function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("span",{},[e.job_id?r("el-button",e._b({attrs:{size:"mini",icon:"el-icon-edit-outline",type:"text"},on:{click:e.handleDialogVisibleClick}},"el-button",e.$attrs,!1)):"table-add"==e.type?r("el-button",e._b({attrs:{size:"mini",type:"text",icon:"el-icon-document-add"},on:{click:e.handleDialogVisibleClick}},"el-button",e.$attrs,!1),[e._v("添加")]):r("el-button",e._b({attrs:{size:"mini",type:"primary",icon:"el-icon-document-add"},on:{click:e.handleDialogVisibleClick}},"el-button",e.$attrs,!1),[e._v("添加")]),e._v(" "),r("el-dialog",{attrs:{title:e.btnText+"任务",visible:e.dialogVisible,width:"500px",center:""},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.dialogVisible?r("ScheduleForm",{attrs:{scrapydServerId:e.scrapydServerId,job_id:e.job_id,project:e.project,spider:e.spider},on:{"on-success":e.handleFormSuccess,"on-cancel":e.handleDialogClose}}):e._e()],1)],1)},i=[],a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-form",{ref:"form",attrs:{model:e.form,"status-icon":"","label-width":"100px",size:"small",rules:e.rules}},[r("el-form-item",{attrs:{label:"服务名称",prop:"scrapyd_server_id",width:"300px"}},[r("SelectScrapydServer",{ref:"SelectScrapydServer",staticStyle:{width:"300px"},attrs:{value:e.form.scrapyd_server_id,disabled:null!=e.scrapydServerId||null!=e.job_id},on:{"update:value":function(t){return e.$set(e.form,"scrapyd_server_id",t)},"on-init":e.handleSelectScrapydServerInit,change:e.handleSelectScrapydServerChange}})],1),e._v(" "),r("el-form-item",{attrs:{label:"项目名称",prop:"project",width:"300px"}},[r("ProjectSelect",{ref:"ProjectSelect",staticStyle:{width:"300px"},attrs:{scrapydServerId:e.form.scrapyd_server_id,value:e.form.project,disabled:null!=e.project||null!=e.job_id},on:{"update:value":function(t){return e.$set(e.form,"project",t)},"on-init":e.handleProjectSelectInit}})],1),e._v(" "),r("el-form-item",{attrs:{label:"Spider名称",prop:"spider",width:"300px"}},[r("SpiderSearch",{ref:"SpiderSearch",staticStyle:{width:"300px"},attrs:{scrapydServerId:e.form.scrapyd_server_id,project:e.form.project,value:e.form.spider,disabled:null!=e.spider||null!=e.job_id},on:{"update:value":function(t){return e.$set(e.form,"spider",t)},"on-init":e.handleSpiderSearchInit}})],1),e._v(" "),r("el-form-item",{attrs:{label:"cron表达式",prop:"cron"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{type:"text",placeholder:"分 时 日 月 周"},model:{value:e.form.cron,callback:function(t){e.$set(e.form,"cron",t)},expression:"form.cron"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"调度方式",prop:"schedule_type"}},[r("el-select",{attrs:{placeholder:"选择调度方式"},model:{value:e.form.schedule_type,callback:function(t){e.$set(e.form,"schedule_type",t)},expression:"form.schedule_type"}},e._l(e.ScheduleTypeOptions,(function(e){return r("el-option",{attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"其他参数",prop:"options"}},[r("el-input",{staticStyle:{width:"300px"},attrs:{type:"textarea",rows:"3",placeholder:'any parameter is passed as spider args eg:{"setting": "DOWNLOAD_DELAY=2"}'},model:{value:e.form.options,callback:function(t){e.$set(e.form,"options",t)},expression:"form.options"}})],1),e._v(" "),r("el-form-item",{attrs:{label:""}},[r("el-button",{attrs:{size:"small"},on:{click:e.handleCancel}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.submit}},[e._v("确 定")])],1)],1)},s=[],c=(r("63ff"),r("d1c7")),o=r("6194"),l=(r("5dce"),r("29ca")),u=(r("436f1"),r("1c5f")),d=r("3629"),p=r("61e0"),f=r("c05f"),h={name:"",props:{scrapydServerId:{type:String,default:null},job_id:{type:String,default:null},project:{type:String,default:null},spider:{type:String,default:null}},components:{ProjectSelect:u["a"],SelectScrapydServer:p["a"],SpiderSearch:d["a"]},data:function(){var e=function(e,t,r){if(!t)return r(new Error("cron表达式不能为空"));var n=t.split(" ").filter((function(e){return""!=e.trim()}));if(5!=n.length)return r(new Error("cron表达式不正确"));r()},t=function(e,t,r){if(t)try{JSON.parse(t)}catch(n){return r(new Error("参数不是json字符串"))}r()};return{ScheduleTypeOptions:f["b"],dialogVisible:!1,form:{scrapyd_server_id:"",schedule_type:f["a"].ONLY_ONE_SERVER,project:"",spider:"",cron:"* * * * *",options:""},rules:{scrapyd_server_id:{required:!0,message:"服务器必须填写",trigger:"blur"},project:{required:!0,message:"项目名称必须填写",trigger:"blur"},spider:{required:!0,message:"Spider名称必须填写",trigger:"change"},cron:{required:!0,validator:e,trigger:"blur"},options:{required:!1,validator:t,trigger:"blur"}}}},computed:{btnText:function(){return this.job_id?"修改":"添加"},icon:function(){return this.job_id?"el-icon-edit-outline":"el-icon-document-add"}},watch:{dialogVisible:function(e){}},methods:{handleCancel:function(){this.$emit("on-cancel")},getData:function(){var e=Object(l["a"])(Object(o["a"])().mark((function e(){var t;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.job_id){e.next=7;break}return e.next=3,this.$Http.scheduleJobDetail({job_id:this.job_id});case 3:t=e.sent,this.form=t.data.kwargs,e.next=10;break;case 7:this.form.scrapyd_server_id=this.scrapydServerId,this.form.project=this.project,this.form.spider=this.spider;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),submit:function(){var e=this;this.$refs.form.validate((function(t){t&&e.addVersion()}))},addVersion:function(){var e=Object(l["a"])(Object(o["a"])().mark((function e(){var t;return Object(o["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$Http.scheduleAddJob(Object(c["a"])({job_id:this.job_id},this.form));case 2:t=e.sent,0==t.code&&(this.$message.success("添加成功"),this.$emit("on-success"));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleSelectScrapydServerChange:function(){var e=this;this.$nextTick((function(){e.$refs.ProjectSelect.resetData()}))},handleSelectScrapydServerInit:function(e){var t=this;console.log("handleSelectScrapydServerInit",e),e.list&&e.list.length>0&&(this.form.scrapyd_server_id||(this.form.scrapyd_server_id=e.list[0].value)),this.$nextTick((function(){t.handleSelectScrapydServerChange()}))},handleProjectSelectInit:function(e){var t=this;console.log("handleProjectSelectInit",e),e&&e.length>0?-1==e.findIndex((function(e){return e.project==t.form.project}))&&(this.form.project=e[0].project):this.form.project="",this.$nextTick((function(){t.$refs.SpiderSearch.resetData()}))},handleSpiderSearchInit:function(e){var t=this;this.form.spider?-1==e.findIndex((function(e){return e.spider==t.form.spider}))&&(this.form.spider=""):e&&e.length>0&&(this.form.spider=e[0].spider)}},created:function(){this.getData()}},v=h,m=r("c9cd"),b=Object(m["a"])(v,a,s,!1,null,"c8e54a20",null),S=b.exports,y={name:"",props:{job_id:{type:String,default:null},scrapydServerId:{type:String,default:null},project:{type:String,default:null},spider:{type:String,default:null},type:{type:String,default:null}},components:{ScheduleForm:S},data:function(){return{dialogVisible:!1}},computed:{btnText:function(){return this.job_id?"修改":"添加"}},watch:{dialogVisible:function(e){}},methods:{handleDialogVisibleClick:function(){this.dialogVisible=!0},handleDialogClose:function(){this.dialogVisible=!1},handleFormSuccess:function(){this.dialogVisible=!1,this.$emit("on-success")}},created:function(){}},_=y,g=Object(m["a"])(_,n,i,!1,null,"533521ae",null);t["a"]=g.exports},"63ff":function(e,t,r){"use strict";var n=r("3c43"),i=r("277e")(6),a="findIndex",s=!0;a in[]&&Array(1)[a]((function(){s=!1})),n(n.P+n.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),r("7dbf")(a)},"729c":function(e,t,r){var n=r("a62a");e.exports=function(e,t){return new(n(e))(t)}},"952a":function(e,t,r){var n=r("aa18");e.exports=Array.isArray||function(e){return"Array"==n(e)}},a62a:function(e,t,r){var n=r("e330"),i=r("952a"),a=r("cbc6")("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&(t=t[a],null===t&&(t=void 0))),void 0===t?Array:t}},c05f:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));var n={ONLY_ONE_SERVER:"0",RANDOM_SERVER:"1"},i=[{value:n.ONLY_ONE_SERVER,label:"当前服务器"},{value:n.RANDOM_SERVER,label:"服务器轮询"}]}}]);