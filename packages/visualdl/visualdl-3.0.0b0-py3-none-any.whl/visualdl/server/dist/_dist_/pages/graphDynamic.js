import y,{AsideSection as a}from"../components/Aside.js";import Se from"../components/GraphPage/GraphDynamic.js";import e,{useCallback as c,useEffect as X,useMemo as F,useRef as Y,useState as r}from"../../__snowpack__/pkg/react.js";import Ce from"../components/Select.js";import{actions as ke,selectors as we}from"../store/index.js";import{rem as S}from"../utils/style.js";import{useDispatch as je,useSelector as De}from"../../__snowpack__/pkg/react-redux.js";import xe from"../components/Check.js";import N from"../components/Button.js";import C from"../components/Checkbox.js";import be from"../components/Content.js";import i from"../components/Field.js";import ve from"../components/GraphPage/ModelPropertiesDialog.js";import Ge from"../components/GraphPage/NodeDocumentationSidebar.js";import _e from"../components/GraphPage/NodePropertiesSidebar.js";import Z from"../components/RadioButton.js";import ye from"../components/RadioGroup.js";import Fe from"../components/GraphPage/Search.js";import Ne from"../components/Title.js";import Pe from"../components/GraphPage/Uploader.js";import k from"../../__snowpack__/pkg/styled-components.js";import{fetcher as ee}from"../utils/fetch.js";import{useTranslation as Re}from"../../__snowpack__/pkg/react-i18next.js";const te=k(N)`
    width: 100%;
`,Me=k(Ce)`
    width: 100%;
`,Ie=k.div`
    display: flex;
    justify-content: space-between;

    > * {
        flex: 1 1 auto;

        &:not(:last-child) {
            margin-right: ${S(20)};
        }
    }
`,ze=k(a)`
    max-height: calc(100% - ${S(40)});
    display: flex;
    flex-direction: column;

    &:not(:last-child) {
        padding-bottom: 0;
    }
`,Ae=()=>{const{t:n}=Re(["graph","common"]),P=je(),oe=De(we.graph.model),l=Y(null),m=Y(null),[R,ne]=r(oe),[w,M]=r(0),[p,re]=r(),[j,I]=r(""),[z,le]=r(!1),A=c(t=>{P(ke.graph.setModel(t)),ne(t)},[P]),d=c(()=>{m.current&&(m.current.value="",m.current.click())},[]),ae=t=>{const o=t.target,s=o.files;if(s[0].name.split(".")[1]!=="pdmodel"&&s[0].name.split(".")[1]!=="json"){alert("\u8BE5\u9875\u9762\u53EA\u80FD\u89E3\u6790paddle\u7684\u6A21\u578B,\u5982\u9700\u89E3\u6790\u8BF7\u8DF3\u8F6C\u7F51\u7EDC\u7ED3\u6784\u9759\u6001\u56FE\u9875\u9762");return}o&&o.files&&o.files.length&&se(o.files)},se=t=>{const o=new FormData;o.append("file",t[0]),o.append("filename",t[0].name),ee("/graph/upload",{method:"POST",body:o}).then(s=>{console.log("res",s);const _=w+1;M(_)},s=>{console.log("errres",s);const _=w+1;M(_)})},[D,ce]=r([]),[B,T]=r(""),ie=c(t=>{ce(t.graphs),T(t.selected||"")},[]),U=c(t=>{var o;T(t),(o=l.current)==null||o.changeGraph(t)},[]),[O,x]=r(""),[h,W]=r(!1),[K,$]=r({text:"",result:[]}),H=c(t=>{var o;x(t),(o=l.current)==null||o.search(t)},[]),q=c(t=>{var o;x(t.name),(o=l.current)==null||o.select(t)},[]),[u,me]=r(!1),[g,pe]=r(!0),[f,de]=r(!1),[b,he]=r(!1),[ue,J]=r(null),[E,L]=r(null),[v,G]=r(null);X(()=>{ee("/graph_runs").then(t=>{const o=t;re(o),I(o[0])})},[w]),X(()=>{x(""),$({text:"",result:[]})},[R,u,g,f]);const Q=F(()=>h?null:e.createElement(te,{type:"primary",rounded:!0,onClick:d},n("graph:change-model")),[n,d,h]),[V,ge]=r(!1),fe=F(()=>V?v?e.createElement(y,{width:S(360)},e.createElement(Ge,{data:v,onClose:()=>G(null)})):E?e.createElement(y,{width:S(360)},e.createElement(_e,{data:E,onClose:()=>L(null),showNodeDocumentation:()=>{var t;return(t=l.current)==null?void 0:t.showNodeDocumentation(E)}})):e.createElement(y,{bottom:Q},e.createElement(ze,null,e.createElement(Fe,{text:O,data:K,onChange:H,onSelect:q,onActive:()=>W(!0),onDeactive:()=>W(!1)})),!h&&e.createElement(e.Fragment,null,e.createElement(a,null,e.createElement(te,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.showModelProperties()}},n("graph:model-properties"))),D.length>1&&e.createElement(a,null,e.createElement(i,{label:n("graph:subgraph")},e.createElement(Me,{list:D,value:B,onChange:U}))),e.createElement(a,null,e.createElement(i,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(C,{checked:u,onChange:me},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(C,{checked:g,onChange:pe},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(C,{checked:f,onChange:de},n("graph:show-node-names"))),e.createElement("div",null,e.createElement(C,{checked:z,onChange:le},n("graph:keep-expanded"))))),e.createElement(a,null,e.createElement(i,{label:n("graph:direction")},e.createElement(ye,{value:b,onChange:he},e.createElement(Z,{value:!1},n("graph:vertical")),e.createElement(Z,{value:!0},n("graph:horizontal"))))),e.createElement(a,null,e.createElement(i,{label:n("graph:export-file")},e.createElement(Ie,null,e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("png")}},n("graph:export-png")),e.createElement(N,{onClick:()=>{var t;return(t=l.current)==null?void 0:t.export("svg")}},n("graph:export-svg"))))),e.createElement(a,null,e.createElement(i,{label:n("graph:Choose-model")},e.createElement("div",{className:"run-list"},p&&p.map((t,o)=>e.createElement("div",{key:o},e.createElement(xe,{checked:j===t,value:t,title:t,onChange:()=>{I(t)}},e.createElement("span",{className:"run-item"},t.split("/")[t.split("/").length-1]))))))))):null,[n,Q,O,p,h,K,j,D,B,U,H,q,u,g,f,b,V,E,v]),Ee=F(()=>e.createElement(Pe,{onClickUpload:d,onDropFiles:A}),[d,A]);return e.createElement(e.Fragment,null,e.createElement(Ne,null,n("common:graph")),e.createElement(ve,{data:ue,onClose:()=>J(null)}),e.createElement(be,{aside:fe},e.createElement(Se,{ref:l,files:R,uploader:Ee,showAttributes:u,showInitializers:g,showNames:f,isKeepData:z,horizontal:b,selectedRuns:j,onRendered:()=>ge(!0),onOpened:ie,onSearch:t=>$(t),onShowModelProperties:t=>J(t),runs:p,onShowNodeProperties:t=>{L(t),G(null)},onShowNodeDocumentation:t=>G(t)}),e.createElement("input",{ref:m,type:"file",multiple:!1,onChange:ae,style:{display:"none"}})))};export default Ae;
