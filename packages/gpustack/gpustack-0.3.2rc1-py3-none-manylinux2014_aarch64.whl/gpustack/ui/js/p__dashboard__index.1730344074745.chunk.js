(self.webpackChunk=self.webpackChunk||[]).push([[931],{33883:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var n=r(26068),a=r.n(n),i=r(48305),o=r.n(i),s=r(67825),l=r.n(s),u=r(45348),c=r(92866),d=r(32699),h=r(50959),m=r(571),f=r(11527),x=function(e){var t=e.isOverflowing,r=e.showTitle,n=e.title,a=e.children,i=(0,m.Z)().initialize,o=h.useRef(null);return h.useEffect((function(){o.current&&i(o.current)}),[i,o.current]),(0,f.jsx)("div",{style:{maxHeight:200,overflowY:"auto"},ref:o,children:(0,f.jsx)("div",{style:{width:"max-content",maxWidth:250,paddingInline:10},children:t||r?n||a:""})})},v=h.memo(x),p=["children","maxWidth","minWidth","ghost","title","showTitle","tooltipProps"],g=function(e){var t=e.children,r=e.maxWidth,n=void 0===r?"100%":r,i=e.minWidth,s=e.ghost,m=void 0!==s&&s,x=e.title,g=e.showTitle,y=void 0!==g&&g,b=e.tooltipProps,w=l()(e,p),j=(0,h.useRef)(null),k=(0,h.useState)(!1),D=o()(k,2),S=D[0],M=D[1],A=((0,h.useRef)(),(0,h.useCallback)((function(){if(j.current){var e=j.current,t=e.scrollWidth,r=e.clientWidth;M(t>r)}}),[j.current]));(0,h.useEffect)((function(){var e=(0,d.throttle)(A,200);return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e),e.cancel()}}),[A]),(0,h.useEffect)((function(){A()}),[t,A]);var Z=(0,h.useMemo)((function(){return a()({maxWidth:n,minWidth:i,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},w.style)}),[n,w.style]);return(0,f.jsx)(u.Z,a()(a()({overlayInnerStyle:{paddingInline:0},destroyTooltipOnHide:!1,title:S||y?(0,f.jsx)(v,{isOverflowing:S,title:x,showTitle:y,children:t}):""},b),{},{children:m?(0,f.jsx)("div",{ref:j,style:Z,children:t}):(0,f.jsx)(c.Z,a()(a()({},w),{},{ref:j,style:Z,children:t}))}))},y=h.memo(g)},40198:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(50959),a=r(11527),i=function(e){var t=e.left,r=e.right,i=e.marginBottom,o=void 0===i?0:i,s=e.marginTop,l=void 0===s?30:s,u=e.style,c=(0,n.useMemo)((function(){var e={};return e.marginBottom="".concat(o,"px"),e.marginTop="".concat(l,"px"),u&&Object.assign(e,u),e}),[o,l,u]);return(0,a.jsxs)("div",{className:"page-tools",style:c,children:[(0,a.jsx)("div",{className:"left",children:t}),(0,a.jsx)("div",{className:"right",children:r})]})}},35445:function(e,t){"use strict";t.Z={xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1600}},571:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(48305),a=r.n(n),i=r(32699),o=r(92605),s=r(50959);function l(e){var t,r=s.useRef(null),n=s.useRef(null),l=s.useRef(!1),u=(0,o.A)({options:{update:{debounce:0},overflow:{x:"hidden"},scrollbars:{theme:(null==e?void 0:e.theme)||"os-theme-dark",autoHide:"scroll",autoHideDelay:600,clickScroll:"instant"}},defer:!0}),c=a()(u,2),d=c[0],h=c[1];n.current=null==h?void 0:h(),r.current=null===(t=n.current)||void 0===t||null===(t=t.elements())||void 0===t?void 0:t.scrollEventElement;var m=s.useCallback((0,i.throttle)((function(){var e,t,a,i;null===(e=r.current)||void 0===e||null===(t=e.scrollTo)||void 0===t||t.call(e,{top:r.current.scrollHeight,behavior:"smooth"}),null===(a=n.current)||void 0===a||null===(i=a.update)||void 0===i||i.call(a)}),100),[(r.current,n.current)]),f=s.useCallback((function(){var e,t,a,i;null===(e=r.current)||void 0===e||null===(t=e.scrollTo)||void 0===t||t.call(e,{top:r.current.scrollHeight,behavior:"auto"}),null===(a=n.current)||void 0===a||null===(i=a.update)||void 0===i||i.call(a)}),[r.current,n.current]),x=s.useCallback((function(e){0===e?f():m()}),[m,f]);return{initialize:s.useCallback((function(e){var t;n.current||e&&(d(e),l.current=!0,n.current=null==h?void 0:h(),r.current=null===(t=n.current)||void 0===t||null===(t=t.elements())||void 0===t?void 0:t.scrollEventElement)}),[d,h]),instance:n.current,scrollEventElement:r.current,initialized:l.current,generateInstance:function(){var e;n.current=null==h?void 0:h(),r.current=null===(e=n.current)||void 0===e||null===(e=e.elements())||void 0===e?void 0:e.scrollEventElement},updateScrollerPosition:x}}},55592:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var n=r(48305),a=r.n(n),i=r(35445),o=r(32699),s=r.n(o),l=r(50959);function u(){var e=(0,l.useState)({width:window.innerWidth,height:window.innerHeight}),t=a()(e,2),r=t[0],n=t[1],o=(0,l.useState)(!1),u=a()(o,2),c=u[0],d=u[1],h=(0,l.useState)(!1),m=a()(h,2),f=m[0],x=m[1],v=(0,l.useState)(!1),p=a()(v,2),g=p[0],y=p[1],b=(0,l.useState)(""),w=a()(b,2),j=w[0],k=w[1],D=(0,l.useCallback)((function(e){return e<i.Z.sm?(d(!0),x(!1),y(!1),void k("sm")):e<i.Z.md?(d(!1),x(!0),y(!1),void k("md")):e<i.Z.lg?(d(!1),x(!1),y(!0),void k("lg")):(d(!1),x(!1),y(!0),void k("xl"))}),[]),S=(0,l.useCallback)(s().throttle((function(){n({width:window.innerWidth,height:window.innerHeight})}),200),[]);return(0,l.useEffect)((function(){return window.addEventListener("resize",S),function(){window.removeEventListener("resize",S)}}),[S]),(0,l.useEffect)((function(){D(r.width)}),[r.width,D]),{size:r,isMobile:c,isTablet:f,isDesktop:g,currentPoint:j}}},69440:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Be}});var n=r(48305),a=r.n(n),i=r(54562),o=r(38242),s=r(50959),l=r(26068),u=r.n(l),c=r(90228),d=r.n(c),h=r(87999),m=r.n(h),f=r(99178),x="/dashboard";function v(){return p.apply(this,arguments)}function p(){return(p=m()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.request)(x));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=(0,s.createContext)({}),y=g,b=r(33883),w=r(40198),j=r(71239),k=r(37943),D=r(48749),S=r(44901),M=r(11527),A=function(){var e=(0,f.useIntl)(),t=(0,s.useContext)(g).active_models||[],r=[{title:e.formatMessage({id:"common.table.name"}),dataIndex:"name",key:"name",ellipsis:!0,render:function(e,t){return(0,M.jsx)(b.Z,{ghost:!0,children:(0,M.jsx)("span",{children:e})})}},{title:e.formatMessage({id:"dashboard.allocatevram"}),dataIndex:"resource_claim.memory",key:"vram",ellipsis:!0,render:function(e,t){var r,n;return(0,M.jsxs)(b.Z,{ghost:!0,children:[(0,j.hy)((null===(r=t.resource_claim)||void 0===r?void 0:r.vram)||0)," /"," ",(0,j.hy)((null===(n=t.resource_claim)||void 0===n?void 0:n.ram)||0)]})}},{title:e.formatMessage({id:"models.form.replicas"}),dataIndex:"instance_count",key:"instance_count"},{title:e.formatMessage({id:"dashboard.tokens"}),dataIndex:"token_count",key:"token_count",ellipsis:!0,render:function(e,t){return(0,M.jsx)(b.Z,{ghost:!0,children:(0,M.jsx)("span",{children:e})})}}];return(0,M.jsx)(k.Z,{gutter:[20,0],children:(0,M.jsxs)(D.Z,{xs:24,sm:24,md:24,lg:24,xl:24,children:[(0,M.jsx)(w.Z,{style:{margin:"26px 0px"},left:(0,M.jsx)("span",{style:{padding:"9px 0"},children:e.formatMessage({id:"dashboard.activeModels"})}),right:!1}),(0,M.jsx)("div",{children:(0,M.jsx)(S.Z,{columns:r,dataSource:t,pagination:!1,rowKey:"id"})})]})})},Z=(0,s.memo)(A),_=r(46593),N=r(30720),L=r(32699),C=r.n(L),E=[{key:"worker_count",label:"dashboard.workers",backgroundColor:"var(--color-white-1)"},{key:"gpu_count",label:"dashboard.totalgpus",backgroundColor:"var(--color-white-1)"},{key:"model_count",label:"dashboard.models",backgroundColor:"var(--color-white-1)"},{key:"model_instance_count",label:"models.form.replicas",backgroundColor:"var(--color-white-1)"}],z="card-body___by6gK",Y="row___aaW9s",T="content___L6aNm",F=function(e){var t=e.label,r=e.value,n=e.bgColor;return(0,M.jsx)(_.Z,{bordered:!1,style:{background:n},className:z,children:(0,M.jsxs)("div",{className:T,children:[(0,M.jsx)("div",{className:"label",children:t}),(0,M.jsx)("div",{className:"value",children:r})]})})},R=function(){var e=(0,f.useIntl)(),t=(0,s.useContext)(g).resource_counts||{};return(0,M.jsx)("div",{children:(0,M.jsx)(k.Z,{gutter:[24,20],className:Y,children:E.map((function(r,n){return(0,M.jsx)(D.Z,{xs:{flex:"100%"},sm:{flex:"50%"},md:{flex:"50%"},lg:{flex:"25%"},xl:{flex:"25%"},children:F({label:e.formatMessage({id:r.label}),value:(a=C().get(t,r.key,0),"number"==typeof a?a:(0,M.jsxs)(N.Z,{className:"value-box",size:20,children:[(0,M.jsx)("span",{className:"value-healthy",children:a.healthy}),(0,M.jsx)("span",{className:"value-warning",children:a.warning}),(0,M.jsx)("span",{className:"value-error",children:a.error})]})),bgColor:r.backgroundColor})},r.key);var a}))})})},W=s.memo(R),P="cardWrapper___Q41EU",I=function(e){var t=e.children,r=e.style;return(0,M.jsx)("div",{className:P,style:u()({},r),children:t})},H=r(16222),U=r(20502),O=r(953),q=r(4853),B=r(22241),G=r(99182),V=r(53183),K=r(19090),J=r(8725),Q=r(56031),X=r(7119),$=r(56262),ee=r(83616),te=r(19175);Q.D([q.N,B.N,G.N,V.N,K.N,J.N,H.N,U.N,O.N,$.T,ee.z,te.N]);var re=X,ne=function(e){var t=e.options,r=e.width,n=e.height,a=(0,s.useRef)(null),i=(0,s.useRef)(),o=(0,s.useRef)(!1),l=(0,s.useRef)(),u=(0,s.useCallback)((function(){var e;a.current&&(null===(e=i.current)||void 0===e||e.clear(),i.current=re.init(a.current))}),[]),c=(0,s.useCallback)((function(){var e;null===(e=i.current)||void 0===e||e.resize()}),[]),d=(0,s.useCallback)((function(e){var t,r;null===(t=i.current)||void 0===t||t.clear(),null===(r=i.current)||void 0===r||r.setOption(e,{notMerge:!0,lazyUpdate:!0})}),[]);return(0,s.useEffect)((function(){return a.current&&u(),function(){var e;null===(e=i.current)||void 0===e||e.dispose()}}),[u]),(0,s.useEffect)((function(){o.current=!1,c(),d(t)}),[t]),(0,s.useEffect)((function(){var e;return e=setTimeout((function(){o.current=!0}),300),function(){clearTimeout(e)}}),[]),(0,s.useEffect)((function(){var e=(0,L.throttle)((function(){var e;o.current&&(null===(e=i.current)||void 0===e||e.resize())}),100);return a.current&&(l.current=new ResizeObserver(e),l.current.observe(a.current)),function(){var e;a.current&&(null===(e=l.current)||void 0===e||e.unobserve(a.current))}}),[]),(0,M.jsx)("div",{ref:a,style:{width:r,height:n}})},ae="rgba(0, 0, 0, 0.4)",ie={trigger:"axis",formatter:function(e,t){var r='<span class="tooltip-x-name">'.concat(e[0].axisValue,"</span>");return e.forEach((function(e){var n=(0,L.isFunction)(t)?null==t?void 0:t(e.data.value):e.data.value;r+='<span class="tooltip-item">\n     <span class="tooltip-item-name">\n       <span style="display:inline-block;margin-right:5px;border-radius:8px;width:8px;height:8px;background-color:'.concat(e.color,';"></span>\n       <span class="tooltip-title">').concat(e.seriesName,'</span>:\n     </span>\n      <span class="tooltip-value">').concat(n,"</span>\n      </span>")})),'<div class="tooltip-wrapper">'.concat(r,"</div>")}},oe={left:0,right:20,bottom:20,containLabel:!0},se={itemWidth:8,itemHeight:8},le={type:"category",axisTick:{show:!0,lineStyle:{color:"rgba(217,217,217,0.5)"}},axisLabel:{color:ae,fontSize:12},axisLine:{show:!1}},ue={nameTextStyle:{padding:[0,0,0,-20]},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisLabel:{color:ae,fontSize:12},axisTick:{show:!1},type:"value"},ce={show:!0,left:"center",textStyle:{fontSize:12,color:"#000"},text:""},de={type:"bar",barMaxWidth:20,barMinWidth:8,barGap:"30%",barCategoryGap:"50%"},he={type:"line",smooth:!0,showSymbol:!1,itemStyle:{},lineStyle:{width:1.5,opacity:.7}},me={type:"gauge",radius:"88%",center:["50%","65%"],startAngle:190,endAngle:-10,min:0,max:100,splitNumber:5,progress:{show:!0,roundCap:!1,width:12},pointer:{length:"80%",width:4,itemStyle:{color:"auto"}},axisLine:{roundCap:!1,lineStyle:{width:12,color:[[.5,"rgba(84, 204, 152, 80%)"],[.8,"rgba(250, 173, 20, 80%)"],[1,"rgba(255, 77, 79, 80%)"]]}},axisTick:{distance:-12,length:6,splitNumber:5,lineStyle:{width:1.5,color:"rgba(255, 255, 255, 1)"}},splitLine:{distance:-12,length:12,lineStyle:{width:1.5,color:"rgba(255, 255, 255, 1)"}},axisLabel:{distance:14,color:"rgba(0, 0, 0, .5)",fontSize:12},detail:{lineHeight:40,height:40,offsetCenter:[5,30],valueAnimation:!1,fontSize:20,color:"rgba(0, 0, 0, 0.88)",formatter:function(e){return"{value|"+e+"}{unit|%}"},rich:{value:{fontSize:16,fontWeight:"500",color:"rgba(0, 0, 0, 0.88)"},unit:{fontSize:14,color:"rgba(0, 0, 0, 0.88)",fontWeight:"500",padding:[0,0,0,2]}}}},fe=r(35052),xe=function(e){var t=e.height,r=e.title;return(0,M.jsxs)("div",{style:{width:"100%",height:t||"100%"},className:"flex-center  flex-column ",children:[r&&(0,M.jsx)("h3",{className:"justify-center font-size-12",style:{padding:"4px 0",marginBottom:0},children:r}),(0,M.jsx)("div",{className:"flex-center justify-center flex-column",style:{height:"100%"},children:(0,M.jsx)(fe.Z,{image:fe.Z.PRESENTED_IMAGE_SIMPLE})})]})},ve=function(e){var t=e.value,r=e.height,n=e.width,a=e.labelFormatter,i=e.title,o=e.color;if(!t&&0!==t)return(0,M.jsx)(xe,{height:r,title:i});var s={title:u()(u()({},ce),{},{text:i,top:"0",left:"center"}),series:[u()(u()({},me),{},{axisLine:u()(u()({},me.axisLine),{},{lineStyle:u()(u()({},me.axisLine.lineStyle),{},{color:[[t/100,o],[1,"rgba(221, 221, 221, 0.5)"]]})}),itemStyle:{color:"transparent"},detail:u()(u()({},me.detail),{},{formatter:a||me.detail.formatter}),data:[{value:t}]})]};return(0,M.jsx)(ne,{height:r,options:s,width:n||"100%"})},pe=(0,s.memo)(ve),ge=r(35445),ye=r(55592),be=function(e){var t=e.seriesData,r=e.xAxisData,n=e.yAxisName,a=e.height,i=e.width,o=e.labelFormatter,s=e.tooltipValueFormatter,l=void 0===s?null:s,c=e.legendData,d=void 0===c?[]:c,h=e.smooth,m=e.title;if(!t.length)return(0,M.jsx)(xe,{height:a,title:m});var f,x={title:{text:""},grid:oe,tooltip:u()(u()({},ie),{},{formatter:function(e){return l?ie.formatter(e,l):ie.formatter(e)}}),xAxis:u()(u()({},le),{},{axisLabel:u()(u()({},le.axisLabel),{},{formatter:o})}),yAxis:ue,legend:u()(u()({},se),{},{data:d}),series:[]},v=(f=C().map(t,(function(e){return u()(u()(u()({},e),he),{},{smooth:h,itemStyle:u()(u()({},he.itemStyle),{},{color:e.color}),lineStyle:u()(u()({},he.lineStyle),{},{color:e.color})})})),u()(u()({},x),{},{animation:!1,title:u()(u()({},ce),{},{text:m}),yAxis:u()(u()({},x.yAxis),{},{name:n}),xAxis:u()(u()({},x.xAxis),{},{data:r}),series:f}));return(0,M.jsx)(ne,{height:a,options:v,width:i||"100%"})},we=(0,s.memo)(be),je=r(7672),ke=r.n(je),De={cpu:{label:"CPU",type:"CPU",intl:!1,color:"rgba(250, 173, 20,.8)"},ram:{label:"dashboard.memory",type:"Memory",intl:!0,color:"rgba(114, 46, 209,.8)"},gpu:{label:"GPU",type:"GPU",intl:!1,color:"rgba(84, 204, 152,.8)"},vram:{label:"dashboard.vram",type:"VRAM",intl:!0,color:"rgba(255, 107, 179, 80%)"}},Se=function(){var e,t=(0,f.useIntl)(),r=(null===(e=(0,s.useContext)(g))||void 0===e||null===(e=e.system_load)||void 0===e?void 0:e.history)||{},n=["gpu","cpu","ram","vram"],a=(0,s.useMemo)((function(){var e=[],a=[];return{seriesData:C().map(n,(function(n){var i=C().get(De,n,{}),o=i.intl?t.formatMessage({id:i.label}):i.label;e.push(o);var s=C().get(r,n,[]);return{name:o,color:i.color,data:C().map(s,(function(e){return a.push(ke()(1e3*e.timestamp).format("HH:mm:ss")),{time:ke()(1e3*e.timestamp).format("HH:mm:ss"),value:C().round(C().get(e,"value",0),1)}}))}})),legendData:e,xAxisData:C().uniq(a)}}),[r,t]);return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(we,{height:390,seriesData:a.seriesData,legendData:a.legendData,xAxisData:a.xAxisData,tooltipValueFormatter:function(e){return e?"".concat(e,"%"):e},smooth:!0,width:"100%",yAxisName:"(%)"})})},Me=(0,s.memo)(Se),Ae=function(e){return e<=50?"rgb(84, 204, 152, 80%)":e<=80?"rgba(250, 173, 20, 80%)":" rgba(255, 77, 79, 80%)"},Ze=function(){var e,t=(0,f.useIntl)(),r=(null===(e=(0,s.useContext)(g))||void 0===e||null===(e=e.system_load)||void 0===e?void 0:e.current)||{},n=(0,ye.Z)().size,i=(0,s.useState)("20px"),o=a()(i,2),l=o[0],u=o[1],c=(0,s.useState)(190),d=a()(c,2),h=d[0],m=(d[1],(0,s.useState)(400)),x=a()(m,2),v=x[0],p=(x[1],(0,s.useMemo)((function(){return{gpu:{data:C().round(r.gpu||0,1),color:Ae(r.gpu)},vram:{data:C().round(r.vram||0,1),color:Ae(r.vram)},cpu:{data:C().round(r.cpu||0,1),color:Ae(r.cpu)},ram:{data:C().round(r.ram||0,1),color:Ae(r.ram)}}}),[r]));return(0,s.useEffect)((function(){n.width<ge.Z.xl?u("0"):u("20px")}),[n.width]),(0,M.jsx)("div",{children:(0,M.jsxs)("div",{className:"system-load",children:[(0,M.jsx)(w.Z,{style:{margin:"26px 0px"},left:(0,M.jsx)("span",{children:t.formatMessage({id:"dashboard.systemload"})})}),(0,M.jsxs)(k.Z,{style:{width:"100%"},gutter:[0,20],children:[(0,M.jsx)(D.Z,{xs:24,sm:24,md:24,lg:24,xl:16,style:{paddingRight:l},children:(0,M.jsx)(I,{style:{height:400,width:"100%"},children:(0,M.jsx)(Me,{})})}),(0,M.jsx)(D.Z,{xs:24,sm:24,md:24,lg:24,xl:8,children:(0,M.jsx)(I,{style:{height:v,width:"100%"},children:(0,M.jsxs)(k.Z,{style:{height:v,width:"100%"},children:[(0,M.jsx)(D.Z,{span:12,style:{height:h},children:(0,M.jsx)(pe,{height:h,value:p.gpu.data,color:p.gpu.color,title:t.formatMessage({id:"dashboard.gpuutilization"})})}),(0,M.jsx)(D.Z,{span:12,style:{height:h},children:(0,M.jsx)(pe,{title:t.formatMessage({id:"dashboard.vramutilization"}),height:h,color:p.vram.color,value:p.vram.data})}),(0,M.jsx)(D.Z,{span:12,style:{height:h},children:(0,M.jsx)(pe,{title:t.formatMessage({id:"dashboard.cpuutilization"}),height:h,color:p.cpu.color,value:p.cpu.data})}),(0,M.jsx)(D.Z,{span:12,style:{height:h},children:(0,M.jsx)(pe,{title:t.formatMessage({id:"dashboard.memoryutilization"}),height:h,color:p.ram.color,value:p.ram.data})})]})})})]})]})})},_e=(0,s.memo)(Ze),Ne=function(e){var t=e.seriesData,r=e.xAxisData,n=e.height,a=e.width,i=e.labelFormatter,o=(e.legendData,e.title);if(!t.length)return(0,M.jsx)(xe,{height:n,title:o});var s,l={title:{text:""},grid:oe,tooltip:u()({},ie),xAxis:u()(u()({},le),{},{axisLabel:u()(u()({},le.axisLabel),{},{formatter:i}),data:[]}),yAxis:ue,legend:u()(u()({},se),{},{data:[]}),series:[]},c=(s=C().map(t,(function(e){return u()(u()(u()({},e),de),{},{stack:"total",itemStyle:{color:e.color}})})),u()(u()({},l),{},{animation:!1,title:u()(u()({},ce),{},{text:o}),yAxis:u()({},l.yAxis),xAxis:u()(u()({},l.xAxis),{},{data:r}),series:s}));return(0,M.jsx)(ne,{height:n,options:c,width:a||"100%"})},Le=(0,s.memo)(Ne),Ce=function(e){var t=e.requestData,r=e.tokenData,n=e.xAxisData,a=(0,f.useIntl)(),i=function(e){return ke()(e).format("MM-DD")};return(0,M.jsx)(I,{style:{width:"100%"},children:(0,M.jsxs)(k.Z,{style:{width:"100%"},children:[(0,M.jsx)(D.Z,{span:12,children:(0,M.jsx)(we,{title:a.formatMessage({id:"dashboard.apirequest"}),seriesData:t,xAxisData:n,height:360,labelFormatter:i})}),(0,M.jsx)(D.Z,{span:12,children:(0,M.jsx)(Le,{title:a.formatMessage({id:"dashboard.tokens"}),seriesData:r,xAxisData:n,height:360,labelFormatter:i})})]})})},Ee=s.memo(Ce),ze=function(e){var t=e.seriesData,r=e.xAxisData,n=e.height,a=e.width,i=e.labelFormatter,o=(e.legendData,e.title);if(!t.length)return(0,M.jsx)(xe,{height:n,title:o});var s,l={title:ce,grid:oe,tooltip:u()({},ie),xAxis:u()(u()({},le),{},{axisLabel:u()(u()({},le.axisLabel),{},{formatter:i})}),yAxis:ue,legend:u()(u()({},se),{},{data:[]}),series:[]},c=(s=C().map(t,(function(e){return u()(u()({},e),{},{type:"bar",barWidth:20,stack:"Ad",barGap:"30%",label:{show:!1},itemStyle:{color:e.color}})})),u()(u()({},l),{},{animation:!1,title:u()(u()({},l.title),{},{left:"start",text:o}),yAxis:u()(u()({},l.yAxis),{},{inverse:!0,type:"category",splitLine:{show:!1},data:r,axisLine:{show:!1},axisTick:{show:!1}}),xAxis:u()(u()({},l.xAxis),{},{type:"value",splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1}}),series:s}));return(0,M.jsx)(ne,{height:n,options:c,width:a||"100%"})},Ye=(0,s.memo)(ze),Te=function(e){var t=e.userData,r=e.topUserList,n=(0,f.useIntl)();return(0,M.jsx)(I,{children:(0,M.jsx)(Ye,{title:n.formatMessage({id:"dashboard.topusers"}),seriesData:t,xAxisData:r,height:360})})},Fe=s.memo(Te),Re="rgba(0,85,255,0.8)",We="rgba(85,167,255,0.8)",Pe=function(e){var t=e.paddingRight,r=(0,f.useIntl)(),n=(0,s.useState)({userData:[],topUserList:[]}),i=a()(n,2),o=i[0],l=i[1],u=(0,s.useState)({requestData:[],tokenData:[],xAxisData:[]}),c=a()(u,2),d=c[0],h=c[1],m=(0,s.useContext)(g).model_usage||{},x=(0,s.useCallback)((function(){var e,t=function(){for(var e=ke()().daysInMonth(),t=ke()().year(),r=ke()().month()+1,n=[],a=1;a<=e;a++)n.push(ke()("".concat(t,"-").concat(r,"-").concat(a)).format("YYYY-MM-DD"));return n}(),r={name:"API requests",areaStyle:{},color:Re,data:[]},n={name:"Completion tokens",color:Re,data:[]},a={name:"Prompt tokens",color:We,data:[]},i={name:"Prompt tokens",color:We,data:[]},o={name:"Completion tokens",color:Re,data:[]};if(C().each(t,(function(e){var t=C().find(m.completion_token_history,(function(t){return ke()(1e3*t.timestamp).format("YYYY-MM-DD")===e}));t?n.data.push({value:t.value,time:ke()(1e3*t.timestamp).format("YYYY-MM-DD")}):n.data.push({titme:e,value:0});var i=C().find(m.prompt_token_history,(function(t){return ke()(1e3*t.timestamp).format("YYYY-MM-DD")===e}));i?a.data.push({value:i.value,time:ke()(1e3*i.timestamp).format("YYYY-MM-DD")}):a.data.push({value:0,time:e});var o=C().find(m.api_request_history,(function(t){return ke()(1e3*t.timestamp).format("YYYY-MM-DD")===e}));o?r.data.push({time:ke()(1e3*o.timestamp).format("YYYY-MM-DD"),value:o.value}):r.data.push({time:e,value:0})})),null!==(e=m.top_users)&&void 0!==e&&e.length){var s=[];C().each(m.top_users,(function(e){s.push(e.username),i.data.push({name:e.username,value:e.prompt_token_count}),o.data.push({name:e.username,value:e.completion_token_count})})),l({userData:[o,i],topUserList:C().uniq(s)})}else l({userData:[],topUserList:[]});h({requestData:[r],tokenData:[n,a],xAxisData:t})}),[m]);return(0,s.useEffect)((function(){x()}),[x]),(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(w.Z,{style:{margin:"26px 0px"},left:(0,M.jsx)("span",{children:r.formatMessage({id:"dashboard.usage"})})}),(0,M.jsxs)(k.Z,{style:{width:"100%"},gutter:[0,20],children:[(0,M.jsx)(D.Z,{xs:24,sm:24,md:24,lg:24,xl:16,style:{paddingRight:t},children:(0,M.jsx)(Ee,{requestData:d.requestData,xAxisData:d.xAxisData,tokenData:d.tokenData})}),(0,M.jsx)(D.Z,{xs:24,sm:24,md:24,lg:24,xl:8,children:(0,M.jsx)(Fe,{userData:o.userData,topUserList:o.topUserList})})]})]})},Ie=(0,s.memo)(Pe),He=function(){var e=(0,ye.Z)().size.width,t=(0,s.useState)("20px"),r=a()(t,2),n=r[0],i=r[1];return(0,s.useEffect)((function(){e<ge.Z.xl?i("0"):i("20px")}),[e]),(0,M.jsx)(Ie,{paddingRight:n})},Ue=function(e){var t=e.setLoading,r=(0,s.useState)({}),n=a()(r,2),i=n[0],o=n[1],l=(0,s.useCallback)(m()(d()().mark((function e(){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t(!0),e.next=4,v();case 4:r=e.sent,o(r),t(!1),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),t(!1),o({});case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),[]);return(0,s.useEffect)((function(){l()}),[]),(0,M.jsxs)(y.Provider,{value:u()(u()({},i),{},{fetchData:l}),children:[(0,M.jsx)(W,{}),(0,M.jsx)(_e,{}),(0,M.jsx)(He,{}),(0,M.jsx)(Z,{})]})},Oe=(0,s.memo)(Ue),qe=function(){var e=(0,s.useState)(!1),t=a()(e,2),r=t[0],n=t[1];return(0,M.jsx)(M.Fragment,{children:(0,M.jsx)(i._z,{ghost:!0,extra:[],children:(0,M.jsx)(o.Z,{spinning:r,children:(0,M.jsx)(Oe,{setLoading:n})})})})},Be=(0,s.memo)(qe)},71239:function(e,t,r){"use strict";r.d(t,{D6:function(){return c},JL:function(){return u},T7:function(){return v},hy:function(){return d},mH:function(){return x},oc:function(){return h},rZ:function(){return f},uf:function(){return m}});r(15558);var n=r(90228),a=r.n(n),i=r(87999),o=r.n(i),s=(r(32699),r(61941)),l=r(28667),u=function(e){return Array.isArray(e)?e.length>0:!!e||0===e||!1===e},c=function(){var e=o()(a()().mark((function e(t,r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return r(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),d=function(e,t){var r=null!=t?t:1;return e?e<1024?"".concat(e.toFixed(r)," B"):e<1048576?"".concat((e/1024).toFixed(r)," KiB"):e<1073741824?"".concat((e/1048576).toFixed(r)," MiB"):e<1099511627776?"".concat((e/1073741824).toFixed(r)," GiB"):"".concat((e/1099511627776).toFixed(r)," TiB"):"0"},h=function(){var e=navigator.userAgent;return{isMac:-1!==e.indexOf("Mac"),isWin:-1!==e.indexOf("Win")}},m=function(e){return e?e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"k":e.toString():"0"};function f(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.readAsText(e,"utf-8")}))}function x(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(e){var n=e.target.result;s.extractRawText({arrayBuffer:n}).then((function(e){t(e.value)})).catch((function(e){return r(e)}))},n.onerror=function(e){return r(e)},n.readAsArrayBuffer(e)}))}function v(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(e){var r=e.target.result,n=l.ZP.read(r,{type:"string"}),a=n.Sheets[n.SheetNames[0]],i=l.ZP.utils.sheet_to_json(a);t(JSON.stringify(i))},n.onerror=function(e){return r(e)},n.readAsArrayBuffer(e)}))}},43351:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=43351,e.exports=t},99168:function(){}}]);