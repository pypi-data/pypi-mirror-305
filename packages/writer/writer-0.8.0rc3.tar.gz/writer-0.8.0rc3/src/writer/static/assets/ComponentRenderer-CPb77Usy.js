import{d as j,i as V,a as h,c as b,o as k,k as Z,$ as fe,b as F,e as p,t as D,a0 as ve,r as B,a1 as P,J as z,a2 as A,L as ee,_ as K,a3 as _e,H as te,w as G,v as J,x as ne,y as he,f as ge,W as ye,F as be,m as Ce,n as oe,p as se,h as ae,a4 as we,l as Se,Y as Ie,a5 as Ee,a6 as Pe,a7 as $e,A as Q}from"./index-DQPnnhr4.js";const Te=10,Me=j({__name:"ChildlessPlaceholder",props:{componentId:{type:String,required:!0}},setup(i){const o=V(h.core),m=i,d=(y,l)=>{const S=y.map(c=>o.getComponentDefinition(c)).map(c=>c==null?void 0:c.name);return`${S.slice(0,-1).join(", ")} ${S.length>1?l:""} ${S.at(-1)}`},s=b(()=>{const y=o.getContainableTypes(m.componentId);let l;return y.length<=Te&&(l=`You can add ${d(y,"and")} components`),l});return(y,l)=>(k(),Z(fe,{class:"ChildlessPlaceholder","component-id":i.componentId,message:s.value},null,8,["component-id","message"]))}}),ke={class:"RenderError"},Ae={class:"title"},De={class:"message"},Be=j({__name:"RenderError",props:{componentType:{},message:{}},setup(i){const o=i;return(m,d)=>(k(),F("div",ke,[p("div",Ae,[p("h2",null,"Error rendering "+D(o.componentType),1)]),p("div",De,D(o.message),1)]))}});function Ve(i){return i.map(o=>`${o.componentId}:${o.instanceNumber}`).join(",")}function ot(i){return i?i.split(",").map(o=>{const[m,d]=o.split(":");return{componentId:m,instanceNumber:Number(d)}}):[]}const xe={props:{componentId:{type:String,required:!0},instancePath:{type:Array,required:!0},instanceData:{type:Array,required:!0}},setup(i){const o=V(h.core),m=V(h.builderManager),d=i.componentId,s=b(()=>o.getComponentById(d)),y=ve(s.value.type),l=i.instancePath,$=i.instanceData,{getEvaluatedFields:S,isComponentVisible:M}=ee(o),c=S(l),E=b(()=>o.getComponents(d,{sortedByPosition:!0})),I=b(()=>!!m&&m.getMode()!="preview"),O=b(()=>{var n;return I.value&&!s.value.isCodeManaged&&s.value.type!=="root"&&s.value.type!=="workflows_root"&&((n=o.getComponentDefinition(s.value.type))==null?void 0:n.toolkit)!=="workflows"}),L=(n,a)=>(n?o.getContainableTypes(n):["root","workflows_root"]).includes(a),x=B(!1),e=()=>{if(!(E.value.length>0))return A(Me,{componentId:s.value.id})},t=(n,a=0,f)=>A(re,{componentId:n,key:`${n}:${a}`,instancePath:[...l,{componentId:n,instanceNumber:a}],instanceData:[...$,B(null)],...f??{}}),r=n=>a=>{if(!L(d,a.type)&&n==="default")return!0;const u=o.getComponentDefinition(a.type).slot??"default";return u==="*"||u===n},v=(n=0,a="default",f=()=>!0,u=!1)=>{const _=g=>!I.value||u?[]:[A("div",{"data-writer-slot-of-id":d,"data-writer-position":g})],C=E.value.filter(r(a)).filter(f),w=C.filter(g=>!g.isCodeManaged).map(g=>t(g.id,n,{contextSlot:a})),R=C.filter(g=>g.isCodeManaged).map(g=>t(g.id,n,{contextSlot:a}));return[..._(0),...w.map((g,N)=>[g,_(N+1)]).flat(),...R]},T=Ve(l);P(h.evaluatedFields,c),P(h.componentId,d),P(h.isBeingEdited,I),P(h.isDisabled,x),P(h.instancePath,l),P(h.instanceData,$),P(h.renderProxiedComponent,t),P(h.getChildrenVNodes,v),P(h.flattenedInstancePath,T);const W={"data-writer-id":d,"data-writer-instance-path":T},q=B(!1);z(()=>(m==null?void 0:m.getSelectedId())==d,n=>{q.value=n}),z(()=>c,()=>{q.value=!1},{deep:!0});const Y=b(()=>E.value.length==0),ie=b(()=>M(d,l)),le=(n,a)=>{if(!n.startsWith("$goToPage_")&&!a)return u=>{let _=!1;o.userFunctions.value.some(C=>C.name==n&&C.args.includes("payload"))&&(_=!0),n.startsWith("$runWorkflow_")&&(_=!0),o.forwardEvent(u,l,_)};if(n.startsWith("$goToPage_")){const u=n.substring(10);return _=>o.setActivePageFromKey(u)}return null},ce=b(()=>{const n={},a=Object.keys(s.value.handlers??{}),f=s.value.binding?[s.value.binding.eventType]:[];return Array.from(new Set([...a,...f])).forEach(_=>{var R;const C=`on${_.charAt(0).toUpperCase()}${_.slice(1)}`,w=_===((R=s.value.binding)==null?void 0:R.eventType);n[C]=g=>{var U,X;w&&o.forwardEvent(g,l,!0);const N=(U=s.value.handlers)==null?void 0:U[_];N&&((X=le(N,w))==null||X(g))}}),n}),de=b(()=>{var f;const n=(f=o.getComponentDefinition(s.value.type))==null?void 0:f.fields;if(!n)return;const a={};return Object.keys(n).forEach(u=>{n[u].applyStyleVariable&&c[u]&&(a[`--${u}`]=c[u].value)}),a}),ue=b(()=>{var C;const n="cssClasses",a=(C=o.getComponentDefinition(s.value.type))==null?void 0:C.fields;if(!a||!a[n]||!c[n])return;const f=c[n].value,u=f==null?void 0:f.split(" ").map(w=>w.trim()),_={};return u.forEach(w=>{_[w]=!0}),_}),pe=function(){return{class:{[`wf-type-${s.value.type}`]:!0,component:!0,childless:Y.value,selected:q.value,disabled:x.value,beingEdited:I.value,...ue.value},style:{...de.value,...ie.value?{}:{display:"none"}},...W,...x.value?[]:ce.value,draggable:O.value}},me=(n,a)=>I.value?A(Be,{...n,componentType:s.value.type,message:a}):A("div");return()=>{const n=I.value?e():void 0,a=({instanceNumber:u=0,slotName:_="default",componentFilter:C=()=>!0,positionlessSlot:w=!1})=>Y.value?w?void 0:n:v(u,_,C,w),f={...pe()};return L(s.value.parentId,s.value.type)?A(y,f,{default:a}):me(f,"Parent is not suitable for this component")}}},re=K(xe,[["__scopeId","data-v-e1b84039"]]),H=i=>(se("data-v-b2157300"),i=i(),ae(),i),Re=H(()=>p("i",{class:"icon material-symbols-outlined"}," notifications ",-1)),Fe={class:"counter"},Le=H(()=>p("div",{class:"balloonFlash"},null,-1)),We={class:"main"},Ne={class:"clearContainer"},je=H(()=>p("i",{class:"material-symbols-outlined"}," clear_all ",-1)),He=H(()=>p("i",{class:"material-symbols-outlined"}," exclamation ",-1)),Oe=[He],qe={class:"content"},ze={class:"title"},Ke={class:"time"},Ye={class:"message"},Ue=100,Xe=j({__name:"RendererNotifications",setup(i){const o=V(h.core),m=B(!1),d=B(null),s=_e([]),y=S=>{const{type:M,title:c,message:E,code:I}=S;s.unshift({type:M,title:c,message:E,code:I,timestampReceived:new Date}),s.splice(Ue),d.value.classList.remove("alert"),d.value.offsetWidth,d.value.classList.add("alert")};te(()=>{o.addMailSubscription("notification",y)});const l=()=>{s.length!=0&&(m.value=!m.value)},$=()=>{s.splice(0),m.value=!1};return(S,M)=>G((k(),F("div",{class:"RendererNotifications colorTransformer",onClick:l},[p("div",{ref_key:"balloon",ref:d,class:"balloon",title:"Toggle notifications"},[Re,p("div",Fe,D(s.length),1)],512),Le,G(p("div",We,[p("div",Ne,[ne(ye,{onClick:$},{default:he(()=>[je,ge(" Clear all ")]),_:1})]),(k(!0),F(be,null,Ce(s,(c,E)=>(k(),F("div",{key:E,class:"notification"},[p("div",{class:oe(["icon",c.type])},Oe,2),p("div",qe,[p("header",null,[p("strong",ze,D(c.title),1),p("span",Ke,D(c.timestampReceived.toLocaleTimeString()),1)]),p("div",Ye,D(c.message),1)])]))),128))],512),[[J,m.value]])],512)),[[J,s.length>0]])}}),Ge=K(Xe,[["__scopeId","data-v-b2157300"]]),Je=i=>(se("data-v-ed6b14fe"),i=i(),ae(),i),Qe=Je(()=>p("div",{class:"loadingBar"},null,-1)),Ze={class:"rootComponentArea"},et=j({__name:"ComponentRenderer",setup(i){const o=V(h.core),m=V(h.builderManager),d=ee(o),s={},y=b(()=>m&&m.getMode()=="workflows"?"workflows_root":"root"),l=d.getEvaluatedFields([{componentId:"root",instanceNumber:0}]),$=b(()=>{var e,t,r,v,T,W;return{"--accentColor":(e=l.accentColor)==null?void 0:e.value,"--emptinessColor":(t=l.emptinessColor)==null?void 0:t.value,"--containerBackgroundColor":(r=l.parentIdBackgroundColor)==null?void 0:r.value,"--primaryTextColor":(v=l.primaryTextColor)==null?void 0:v.value,"--secondaryTextColor":(T=l.secondaryTextColor)==null?void 0:T.value,"--separatorColor":(W=l.separatorColor)==null?void 0:W.value}}),S=b(()=>o.frontendMessageMap.value.size>0);z(()=>{var e;return(e=l.appName)==null?void 0:e.value},e=>{M(e)},{immediate:!0});function M(e){const t=o.mode.value;let r;e&&t=="edit"?r=`${e} | Writer Framework | Builder`:!e&&t=="edit"?r="Writer Framework | Builder":e&&t=="run"?r=`${e}`:!e&&t=="run"&&(r="Writer Framework App"),document.title=r}async function c(e,t){const r=document.querySelector(`[data-writer-stylesheet-key="${e}"]`);r==null||r.remove();const v=document.createElement("link");v.dataset.writerStylesheetKey=e,v.setAttribute("href",t),v.setAttribute("rel","stylesheet"),document.head.appendChild(v)}async function E(e,t){const r=document.querySelector(`[data-writer-script-key="${e}"]`);r==null||r.remove();const v=document.createElement("script");v.dataset.writerScriptKey=e,v.src=t,v.setAttribute("rel","modulepreload"),document.head.appendChild(v)}async function I(e,t){s[e]=t,await Q(()=>import(t),[],import.meta.url)}async function O(e,t,r){const v=s[e],T=await Q(()=>import(v),[],import.meta.url);if(!T){console.warn(`The module with key "${e}" cannot be found. Please check that it has been imported.`);return}T[t](...r)}function L(){o.addMailSubscription("fileDownload",e=>{const t=document.createElement("a");t.href=e.data,t.download=e.fileName,t.click()}),o.addMailSubscription("openUrl",e=>{const t=document.createElement("a");t.href=e,t.target="_blank",t.rel="noopener noreferrer",t.click()}),o.addMailSubscription("pageChange",e=>{Ee(e)}),o.addMailSubscription("routeVarsChange",e=>{Pe(e)}),o.addMailSubscription("importStylesheet",({stylesheetKey:e,path:t})=>{c(e,t)}),o.addMailSubscription("importScript",({scriptKey:e,path:t})=>{E(e,t)}),o.addMailSubscription("importModule",({moduleKey:e,specifier:t})=>{I(e,t)}),o.addMailSubscription("functionCall",({moduleKey:e,functionName:t,args:r})=>{O(e,t,r)})}function x(){const e=$e(),t=new CustomEvent("wf-app-open",{detail:{payload:e}}),r={componentId:"root",instanceNumber:0};o.forwardEvent(t,[r],!0)}return we(()=>{L()}),te(()=>{x()}),(e,t)=>(k(),F("main",{class:oe(["ComponentRenderer",{loadingActive:S.value}]),tabindex:"-1",style:Ie($.value)},[ne(Ge,{class:"notifications"}),Qe,p("div",Ze,[(k(),Z(re,{key:y.value,"component-id":y.value,"instance-path":[{componentId:y.value,instanceNumber:0}],"instance-data":[B(null)]},null,8,["component-id","instance-path","instance-data"])),Se(e.$slots,"default",{},void 0,!0)])],6))}}),tt=K(et,[["__scopeId","data-v-ed6b14fe"]]),st=Object.freeze(Object.defineProperty({__proto__:null,default:tt},Symbol.toStringTag,{value:"Module"}));export{tt as C,st as a,ot as p};
