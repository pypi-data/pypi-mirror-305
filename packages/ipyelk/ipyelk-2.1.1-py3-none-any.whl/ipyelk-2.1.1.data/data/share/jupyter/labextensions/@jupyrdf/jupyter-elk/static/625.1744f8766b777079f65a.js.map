{"version":3,"file":"625.1744f8766b777079f65a.js?v=1744f8766b777079f65a","mappings":"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","sources":["webpack://@jupyrdf/jupyter-elk/./node_modules/sprotty-protocol/src/action-handler.ts","webpack://@jupyrdf/jupyter-elk/./node_modules/sprotty-protocol/src/diagram-server.ts","webpack://@jupyrdf/jupyter-elk/./node_modules/sprotty-protocol/src/index.ts","webpack://@jupyrdf/jupyter-elk/./node_modules/sprotty-protocol/src/model.ts"],"sourcesContent":["/********************************************************************************\n * Copyright (c) 2021 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport { Action } from './actions';\nimport { DiagramServer } from './diagram-server';\nimport { DiagramState } from './diagram-services';\n\nexport type ServerActionHandler<A extends Action = Action> = (action: A, state: DiagramState, server: DiagramServer) => void | Promise<void>;\n\n/**\n * Use this service to register handlers to specific actions. The `DiagramServer` queries this registry\n * when an action is received from the client, and falls back to the built-in behavior if no handlers\n * are found.\n */\nexport class ServerActionHandlerRegistry {\n\n    protected readonly handlers = new Map<string, ServerActionHandler[]>();\n\n    /**\n     * Returns the action handlers for the given action kind, or `undefined` if there are none.\n     */\n    getHandler(kind: string): ServerActionHandler[] | undefined {\n        return this.handlers.get(kind);\n    }\n\n    /**\n     * Add an action handler to be called when an action of the specified kind is received.\n     */\n    onAction<A extends Action>(kind: string, handler: ServerActionHandler<A>) {\n        if (this.handlers.has(kind)) {\n            this.handlers.get(kind)!.push(handler);\n        } else {\n            this.handlers.set(kind, [handler]);\n        }\n    }\n\n    /**\n     * Remove an action handler that was previously added with `onAction`.\n     */\n    removeActionHandler<A extends Action>(kind: string, handler: ServerActionHandler<A>) {\n        const list = this.handlers.get(kind);\n        if (list) {\n            const index = list.indexOf(handler);\n            if (index >= 0) {\n                list.splice(index, 1);\n            }\n        }\n    }\n\n}\n","/********************************************************************************\n * Copyright (c) 2021 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport { ServerActionHandlerRegistry } from './action-handler';\nimport {\n    Action, isResponseAction, ResponseAction, RequestModelAction, ComputedBoundsAction, LayoutAction, RequestBoundsAction,\n    RequestAction, generateRequestId, SetModelAction, UpdateModelAction, RejectAction, isRequestAction\n} from './actions';\nimport { DiagramServices, DiagramState, IDiagramGenerator, IModelLayoutEngine } from './diagram-services';\nimport { SModelRoot } from './model';\nimport { Deferred } from './utils/async';\nimport { applyBounds, cloneModel } from './utils/model-utils';\n\n/**\n * An instance of this class is responsible for handling a single diagram client. It holds the current\n * state of the diagram and manages communication with the client via actions.\n */\nexport class DiagramServer {\n\n    readonly state: DiagramState & {\n        lastSubmittedModelType?: string\n    } = {\n        currentRoot: {\n            type: 'NONE',\n            id: 'ROOT'\n        },\n        revision: 0\n    };\n    readonly dispatch: <A extends Action>(action: A) => Promise<void>;\n\n    protected readonly diagramGenerator: IDiagramGenerator;\n    protected readonly layoutEngine?: IModelLayoutEngine;\n    protected actionHandlerRegistry?: ServerActionHandlerRegistry;\n    protected readonly requests = new Map<string, Deferred<ResponseAction>>();\n\n    constructor(dispatch: <A extends Action>(action: A) => Promise<void>,\n                services: DiagramServices) {\n        this.dispatch = dispatch;\n        this.diagramGenerator = services.DiagramGenerator;\n        this.layoutEngine = services.ModelLayoutEngine;\n        this.actionHandlerRegistry = services.ServerActionHandlerRegistry;\n    }\n\n    /**\n     * Set the model and submit it to the client.\n     */\n    setModel(newRoot: SModelRoot): Promise<void> {\n        newRoot.revision = ++this.state.revision;\n        this.state.currentRoot = newRoot;\n        return this.submitModel(newRoot, false);\n    }\n\n    /**\n     * Update the model to a new state and submit it to the client.\n     */\n    updateModel(newRoot: SModelRoot): Promise<void> {\n        newRoot.revision = ++this.state.revision;\n        this.state.currentRoot = newRoot;\n        return this.submitModel(newRoot, true);\n    }\n\n    /**\n     * Whether the client needs to compute the layout of parts of the model. This affects the behavior\n     * of `submitModel`.\n     *\n     * This setting is determined by the `DiagramOptions` that are received with the `RequestModelAction`\n     * from the client. If the client does not specify whether it needs client layout, the default value\n     * is `true`.\n     */\n    get needsClientLayout(): boolean {\n        if (this.state.options && this.state.options.needsClientLayout !== undefined) {\n            return !!this.state.options.needsClientLayout;\n        }\n        return true;\n    }\n\n    /**\n     * Whether the server needs to compute the layout of parts of the model. This affects the behavior\n     * of `submitModel`.\n     *\n     * This setting is determined by the `DiagramOptions` that are received with the `RequestModelAction`\n     * from the client. If the client does not specify whether it needs server layout, the default value\n     * is `false`.\n     */\n    get needsServerLayout(): boolean {\n        if (this.state.options && this.state.options.needsServerLayout !== undefined) {\n            return !!this.state.options.needsServerLayout;\n        }\n        return false;\n    }\n\n    /**\n     * Called when an action is received from the client.\n     */\n    accept(action: Action): Promise<void> {\n        if (isResponseAction(action)) {\n            const id = action.responseId;\n            const future = this.requests.get(id);\n            if (future) {\n                this.requests.delete(id);\n                if (action.kind === RejectAction.KIND) {\n                    const rejectAction: RejectAction = action as any;\n                    future.reject(new Error(rejectAction.message));\n                    console.warn(`Request with id ${action.responseId} failed: ${rejectAction.message}`, rejectAction.detail);\n                } else {\n                    future.resolve(action);\n                }\n                return Promise.resolve();\n            }\n            console.info('No matching request for response:', action);\n        }\n        return this.handleAction(action);\n    }\n\n    /**\n     * Send a request action to the client. The resulting promise is resolved when a matching\n     * response is received and rejected when a `RejectAction` is received.\n     */\n    request<Res extends ResponseAction>(action: RequestAction<Res>): Promise<Res> {\n        if (!action.requestId) {\n            action.requestId = 'server_' + generateRequestId();\n        }\n        const future = new Deferred<Res>();\n        this.requests.set(action.requestId, future as any);\n        this.dispatch(action).catch(err => {\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            this.requests.delete(action.requestId!);\n            future.reject(err);\n        });\n        return future.promise;\n    }\n\n    /**\n     * Send a `RejectAction` to the client to notify that a request could not be fulfilled.\n     */\n    rejectRemoteRequest(action: Action | undefined, error: Error): void {\n        if (action && isRequestAction(action)) {\n            this.dispatch({\n                kind: RejectAction.KIND,\n                responseId: action.requestId,\n                message: error.message,\n                detail: error.stack\n            });\n        }\n    }\n\n    protected handleAction(action: Action): Promise<void> {\n        // Find a matching action handler in the registry\n        const handlers = this.actionHandlerRegistry?.getHandler(action.kind);\n        if (handlers && handlers.length === 1) {\n            return handlers[0](action, this.state, this) ?? Promise.resolve();\n        } else if (handlers && handlers.length > 1) {\n            return Promise.all(handlers.map(h => h(action, this.state, this) ?? Promise.resolve())) as Promise<any>;\n        }\n        // If no handler is registered, call one of the default handling methods\n        switch (action.kind) {\n            case RequestModelAction.KIND:\n                return this.handleRequestModel(action as RequestModelAction);\n            case ComputedBoundsAction.KIND:\n                return this.handleComputedBounds(action as ComputedBoundsAction);\n            case LayoutAction.KIND:\n                return this.handleLayout(action as LayoutAction);\n        }\n        // We don't know this action kind, sigh\n        console.warn(`Unhandled action from client: ${action.kind}`);\n        return Promise.resolve();\n    }\n\n    protected async handleRequestModel(action: RequestModelAction): Promise<void> {\n        this.state.options = action.options;\n        try {\n            const newRoot = await this.diagramGenerator.generate({\n                options: this.state.options ?? {},\n                state: this.state\n            });\n            newRoot.revision = ++this.state.revision;\n            this.state.currentRoot = newRoot;\n            await this.submitModel(this.state.currentRoot, false, action);\n        } catch (err) {\n            this.rejectRemoteRequest(action, err as Error);\n            console.error('Failed to generate diagram:', err);\n        }\n    }\n\n    /**\n     * Submit a model to the client after it has been updated in the server state.\n     */\n     protected async submitModel(newRoot: SModelRoot, update: boolean, cause?: Action): Promise<void> {\n        if (this.needsClientLayout) {\n            if (!this.needsServerLayout) {\n                // In this case the client won't send us the computed bounds\n                this.dispatch({ kind: RequestBoundsAction.KIND, newRoot });\n            } else {\n                const request = RequestBoundsAction.create(newRoot);\n                const response = await this.request<ComputedBoundsAction>(request);\n                const currentRoot = this.state.currentRoot;\n                if (response.revision === currentRoot.revision) {\n                    applyBounds(currentRoot, response);\n                    await this.doSubmitModel(currentRoot, update, cause);\n                } else {\n                    this.rejectRemoteRequest(cause, new Error(`Model revision does not match: ${response.revision}`));\n                }\n            }\n        } else {\n            await this.doSubmitModel(newRoot, update, cause);\n        }\n    }\n\n    private async doSubmitModel(newRoot: SModelRoot, update: boolean, cause?: Action): Promise<void> {\n        if (newRoot.revision !== this.state.revision) {\n            return;\n        }\n        if (this.needsServerLayout && this.layoutEngine) {\n            newRoot = await this.layoutEngine.layout(newRoot);\n        }\n        const modelType = newRoot.type;\n        if (cause && cause.kind === RequestModelAction.KIND) {\n            const requestId = (cause as RequestModelAction).requestId;\n            const response = SetModelAction.create(newRoot, requestId);\n            await this.dispatch(response);\n        } else if (update && modelType === this.state.lastSubmittedModelType) {\n            await this.dispatch({ kind: UpdateModelAction.KIND, newRoot, cause });\n        } else {\n            await this.dispatch({ kind: SetModelAction.KIND, newRoot });\n        }\n        this.state.lastSubmittedModelType = modelType;\n    }\n\n    protected handleComputedBounds(action: ComputedBoundsAction): Promise<void> {\n        if (action.revision !== this.state.currentRoot.revision) {\n            return Promise.reject();\n        }\n        applyBounds(this.state.currentRoot, action);\n        return Promise.resolve();\n    }\n\n    protected async handleLayout(action: LayoutAction): Promise<void> {\n        if (!this.layoutEngine) {\n            return;\n        }\n        if (!this.needsServerLayout) {\n            let newRoot = cloneModel(this.state.currentRoot);\n            newRoot = await this.layoutEngine.layout(newRoot);\n            newRoot.revision = ++this.state.revision;\n            this.state.currentRoot = newRoot;\n        }\n        await this.doSubmitModel(this.state.currentRoot, true, action);\n    }\n\n}\n","/********************************************************************************\n * Copyright (c) 2021 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nexport * from './action-handler';\nexport * from './actions';\nexport * from './diagram-server';\nexport * from './diagram-services';\nexport * from './model';\nexport * from './utils/async';\nexport * from './utils/geometry';\nexport * from './utils/json';\nexport * from './utils/model-utils';\nexport * from './utils/object';\n","/********************************************************************************\n * Copyright (c) 2021-2023 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport { Bounds, Point, Dimension } from './utils/geometry';\nimport { hasOwnProperty } from './utils/object';\n\n/**\n * Base type for all elements of the diagram model.\n * Each model element must have a unique ID and a type that is used to look up its view.\n */\nexport interface SModelElement {\n    type: string\n    id: string\n    children?: SModelElement[]\n    cssClasses?: string[]\n}\n\n/**\n * Base type for the root element of the diagram model tree.\n */\nexport interface SModelRoot extends SModelElement {\n    canvasBounds?: Bounds\n    revision?: number\n}\n\n/**\n * Usually the root of a model is also a viewport.\n */\nexport interface ViewportRootElement extends SModelRoot, Partial<Viewport>, Partial<BoundsAware> {\n}\n\n/**\n * Root element for graph-like models.\n */\nexport interface SGraph extends ViewportRootElement, Partial<LayoutableChild> {\n    children: SModelElement[]\n\n    /** @deprecated Use `position` and `size` instead. */\n    bounds?: Bounds\n}\n\nexport interface SShapeElement extends SModelElement, Partial<LayoutableChild> {\n}\n\n/**\n * Model element class for nodes, which are the main entities in a graph. A node can be connected to\n * another node via an SEdge. Such a connection can be direct, i.e. the node is the source or target of\n * the edge, or indirect through a port, i.e. it contains an SPort which is the source or target of the edge.\n */\nexport interface SNode extends SShapeElement, Partial<LayoutContainer>, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\n    anchorKind?: string\n}\n\n/**\n * A port is a connection point for edges. It should always be contained in an SNode.\n */\nexport interface SPort extends SShapeElement, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\n    anchorKind?: string\n}\n\n/**\n * Model element class for edges, which are the connectors in a graph. An edge has a source and a target,\n * each of which can be either a node or a port. The source and target elements are referenced via their ids.\n */\nexport interface SEdge extends SModelElement, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\n    sourceId: string\n    targetId: string\n    routerKind?: string\n    routingPoints?: Point[]\n}\n\n/**\n * A label can be attached to a node, edge, or port, and contains some text to be rendered in its view.\n */\nexport interface SLabel extends SShapeElement, Partial<Selectable>, Partial<Alignable> {\n    text: string\n}\n\n/**\n * A compartment is used to group multiple child elements such as labels of a node. Usually a `vbox`\n * or `hbox` layout is used to arrange these children.\n */\nexport interface SCompartment extends SShapeElement, Partial<LayoutContainer> {\n}\n\n/**\n * A viewport has a scroll position and a zoom factor. Usually these properties are\n * applied to the root element to enable navigating through the diagram.\n */\nexport interface Viewport extends Scrollable, Zoomable {\n}\n\n/**\n * A scrollable element has a scroll position, which indicates the top left corner of the\n * visible area.\n */\nexport interface Scrollable {\n    scroll: Point\n}\n\nexport function isScrollable(element: SModelElement | Scrollable): element is Scrollable {\n    return hasOwnProperty(element, 'scroll');\n}\n\n/**\n * A zoomable element can be scaled so it appears smaller or larger than its actual size.\n * The zoom value 1 is the default scale where the content is drawn with its actual size.\n */\nexport interface Zoomable {\n    zoom: number\n}\n\nexport function isZoomable(element: SModelElement | Zoomable): element is Zoomable {\n    return hasOwnProperty(element, 'zoom');\n}\n\n/**\n * An element that can be placed at a specific location using its position property.\n * Feature extension interface for `moveFeature`.\n */\nexport interface Locateable {\n    position: Point\n}\n\n/**\n * Model elements that implement this interface have a position and a size.\n */\nexport interface BoundsAware extends Locateable {\n    size: Dimension\n}\n\n/**\n * Feature extension interface for `layoutableChildFeature`. This is used when the parent\n * element has a `layout` property (meaning it's a `LayoutContainer`).\n*/\nexport interface LayoutableChild extends BoundsAware {\n    layoutOptions?: ModelLayoutOptions\n}\n\n/**\n * Layout options of a `LayoutableChild`.\n */\nexport interface ModelLayoutOptions {\n    hAlign?: HAlignment\n    hGap?: number\n    vAlign?: VAlignment\n    vGap?: number\n    paddingTop?: number\n    paddingRight?: number\n    paddingBottom?: number\n    paddingLeft?: number\n    paddingFactor?: number\n    minWidth?: number\n    minHeight?: number\n    resizeContainer?: boolean\n    [key: string]: string | number | boolean | undefined\n};\n\nexport type HAlignment = 'left' | 'center' | 'right';\nexport type VAlignment = 'top' | 'center' | 'bottom';\n\n/**\n * Used to identify model elements that specify a layout to apply to their children.\n */\nexport interface LayoutContainer extends LayoutableChild {\n    layout: LayoutKind\n}\n\n/**\n * Type for the layout property of a `LayoutContainer`.\n */\nexport type LayoutKind = 'stack' | 'vbox' | 'hbox' | (string & {});\n\n/**\n * Feature extension interface for `alignFeature`.\n * Used to adjust elements whose bounding box is not at the origin, e.g. labels\n * or pre-rendered SVG figures.\n */\nexport interface Alignable {\n    alignment: Point\n}\n\n/**\n * Feature extension interface for `selectFeature`. The selection status is often considered\n * in the frontend views, e.g. by switching CSS classes.\n */\nexport interface Selectable {\n    selected: boolean\n}\n\n/**\n * Feature extension interface for `hoverFeedbackFeature`. The hover feedback status is often\n * considered in the frontend views, e.g. by switching CSS classes.\n */\nexport interface Hoverable {\n    hoverFeedback: boolean\n}\n\n/**\n * Feature extension interface for `fadeFeature`. Fading is mostly used to animate when an element\n * appears or disappears.\n */\nexport interface Fadeable {\n    opacity: number\n}\n\n/**\n * Feature extension interface for `expandFeature`.\n * Model elements that implement this interface can be expanded and collapsed.\n */\nexport interface Expandable {\n    expanded: boolean\n}\n\n/**\n * Model elements implementing this interface can be displayed on a projection bar.\n * _Note:_ If set, the projectedBounds property will be prefered over the model element bounds.\n * Otherwise model elements also have to be `BoundsAware` so their projections can be shown.\n */\nexport interface Projectable {\n    projectionCssClasses: string[],\n    projectedBounds?: Bounds,\n}\n\n/**\n * Feature extension interface for `edgeLayoutFeature`. This is often applied to\n * {@link SLabel} elements to specify their placement along the containing edge.\n */\nexport interface EdgeLayoutable {\n    edgePlacement: EdgePlacement\n}\n\nexport type EdgeSide = 'left' | 'right' | 'top' | 'bottom' | 'on';\n\n/**\n * Each label attached to an edge can be placed on the edge in different ways.\n * With this interface the placement of such a single label is defined.\n */\nexport interface EdgePlacement {\n    /**\n     * true, if the label should be rotated to touch the edge tangentially\n     */\n    rotate: boolean;\n\n    /**\n     * where is the label relative to the line's direction\n     */\n    side: EdgeSide;\n\n    /**\n     * between 0 (source anchor) and 1 (target anchor)\n     */\n    position: number;\n\n    /**\n     * space between label and edge/connected nodes\n     */\n    offset: number;\n\n    /**\n     * where should the label be moved when move feature is enabled.\n     * 'edge' means the label is moved along the edge, 'free' means the label is moved freely, 'none' means the label can not be moved.\n     * Default is 'edge'.\n     */\n    moveMode?: 'edge' | 'free' | 'none';\n}\n\n/**\n * Buttons are elements that can react to clicks. A button handler can be registered in the frontend.\n */\nexport interface SButton extends SShapeElement {\n    pressed: boolean\n    enabled: boolean\n}\n\n/**\n * An issue marker is used to display a symbol about an error or a warning attached to another model element.\n */\nexport interface SIssueMarker extends SShapeElement {\n    issues: SIssue[]\n}\n\nexport type SIssueSeverity = 'error' | 'warning' | 'info';\n\nexport interface SIssue {\n    message: string\n    severity: SIssueSeverity\n}\n\n/**\n * Root model element class for HTML content. Usually this is rendered with a `div` DOM element.\n */\nexport interface HtmlRoot extends SModelRoot {\n    classes?: string[]\n}\n\n/**\n * Pre-rendered elements contain HTML or SVG code to be transferred to the DOM. This can be useful to\n * render complex figures or to compute the view on the server instead of the client code.\n */\nexport interface PreRenderedElement extends SModelElement {\n    code: string\n}\n\n/**\n * Same as PreRenderedElement, but with a position and a size.\n */\nexport interface ShapedPreRenderedElement extends PreRenderedElement {\n    position?: Point\n    size?: Dimension\n}\n\n/**\n * A `foreignObject` element to be transferred to the DOM within the SVG.\n *\n * This can be useful to to benefit from e.g. HTML rendering features, such as line wrapping, inside of\n * the SVG diagram.  Note that `foreignObject` is not supported by all browsers and SVG viewers may not\n * support rendering the `foreignObject` content.\n *\n * If no dimensions are specified in the schema element, this element will obtain the dimension of\n * its parent to fill the entire available room. Thus, this element requires specified bounds itself\n * or bounds to be available for its parent.\n */\nexport interface ForeignObjectElement extends ShapedPreRenderedElement {\n    /** The namespace to be assigned to the elements inside of the `foreignObject`. */\n    namespace: string\n}\n"],"names":["handlers","Map","getHandler","kind","this","get","onAction","handler","has","push","set","removeActionHandler","list","index","indexOf","splice","constructor","dispatch","services","state","currentRoot","type","id","revision","requests","diagramGenerator","DiagramGenerator","layoutEngine","ModelLayoutEngine","actionHandlerRegistry","ServerActionHandlerRegistry","setModel","newRoot","submitModel","updateModel","needsClientLayout","options","undefined","needsServerLayout","accept","action","isResponseAction","responseId","future","delete","RejectAction","KIND","rejectAction","reject","Error","message","console","warn","detail","resolve","Promise","info","handleAction","request","requestId","generateRequestId","Deferred","catch","err","promise","rejectRemoteRequest","error","isRequestAction","stack","length","all","map","h","RequestModelAction","handleRequestModel","ComputedBoundsAction","handleComputedBounds","LayoutAction","handleLayout","generate","update","cause","RequestBoundsAction","create","response","applyBounds","doSubmitModel","layout","modelType","SetModelAction","lastSubmittedModelType","UpdateModelAction","cloneModel","element","hasOwnProperty"],"sourceRoot":""}