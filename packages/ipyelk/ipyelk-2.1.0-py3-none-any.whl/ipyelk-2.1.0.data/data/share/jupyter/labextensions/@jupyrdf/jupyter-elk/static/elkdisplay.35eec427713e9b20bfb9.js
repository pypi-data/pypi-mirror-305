"use strict";(self.webpackChunk_jupyrdf_jupyter_elk=self.webpackChunk_jupyrdf_jupyter_elk||[]).push([[79],{8033:(e,t,s)=>{s.r(t),s.d(t,{ELKControlModel:()=>ze,ELKViewerModel:()=>Fe,ELKViewerView:()=>Te});var o=s(843),i=s.n(o),n=s(9177),r=s(5852),l=s(7262),a=s(4602),d=s(1513),c=s(6037),u=s(3286);const h={IFeedbackActionDispatcher:Symbol.for("IFeedbackActionDispatcher"),IToolFactory:Symbol.for("Factory<Tool>"),IEditConfigProvider:Symbol.for("IEditConfigProvider"),RequestResponseSupport:Symbol.for("RequestResponseSupport"),SelectionService:Symbol.for("SelectionService"),SelectionListener:Symbol.for("SelectionListener"),SModelRootListener:Symbol.for("SModelRootListener"),MouseTool:Symbol.for("MouseTool"),ViewerOptions:Symbol.for("ViewerOptions")};class p extends u.Command{constructor(){super(...arguments),this.priority=0}undo(e){return e.root}redo(e){return e.root}}var g;!function(e){e.DEFAULT="default-mode",e.OVERLAP_FORBIDDEN="overlap-forbidden-mode",e.NODE_CREATION="node-creation-mode",e.EDGE_CREATION_SOURCE="edge-creation-select-source-mode",e.EDGE_CREATION_TARGET="edge-creation-select-target-mode",e.EDGE_RECONNECT="edge-reconnect-select-target-mode",e.OPERATION_NOT_ALLOWED="edge-modification-not-allowed-mode",e.ELEMENT_DELETION="element-deletion-mode",e.MOUSEOVER="mouseover",e.SELECTED="selected"}(g||(g={}));let m=class extends p{constructor(e){super(),this.action=e}execute(e){return function(e,t){if(null!=e.cssClasses&&0!==e.cssClasses.length)for(const s of t)-1!==e.cssClasses.indexOf(s)&&e.cssClasses.splice(e.cssClasses.indexOf(s),1)}(this.action.target,Object.values(g)),this.action.cssClass&&function(e,t){null==e.cssClasses&&(e.cssClasses=[]);for(const s of t)e.cssClasses.indexOf(s)<0&&e.cssClasses.push(s)}(this.action.target,[this.action.cssClass]),e.root}};var f,v;m.KIND="applyCursorCssFeedback",m=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)(),(f=0,v=(0,c.inject)(u.TYPES.Action),function(e,t){v(e,t,f)}),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[class{constructor(e,t){this.target=e,this.cssClass=t,this.kind=m.KIND}}])],m);var y=function(e,t){return function(s,o){t(s,o,e)}};let b=class{constructor(e,t){this.actionDispatcher=e,this.logger=t,this.feedbackEmitters=new Map}registerFeedback(e,t){this.feedbackEmitters.set(e,t),this.dispatch(t,e)}deregisterFeedback(e,t){this.feedbackEmitters.delete(e),this.dispatch(t,e)}dispatch(e,t){this.actionDispatcher().then((t=>t.dispatchAll(e))).then((()=>this.logger.info(this,`Dispatched feedback actions for ${t}`))).catch((e=>this.logger.error(this,"Failed to dispatch feedback actions",e)))}getRegisteredFeedback(){const e=[];return this.feedbackEmitters.forEach(((t,s)=>e.push(...t))),e}getRegisteredFeedbackEmitters(e){const t=[];return this.feedbackEmitters.forEach(((s,o)=>{s.find((t=>t===e))&&t.push(o)})),t}};b=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)(),y(0,(0,c.inject)(u.TYPES.IActionDispatcherProvider)),y(1,(0,c.inject)(u.TYPES.ILogger)),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[Function,Object])],b);const w=new c.ContainerModule(((e,t,s)=>{e(h.IFeedbackActionDispatcher).to(b).inSingletonScope(),(0,u.configureCommand)({bind:e,isBound:s},m),(0,u.configureCommand)({bind:e,isBound:s},u.MoveCommand),(0,u.configureCommand)({bind:e,isBound:s},u.SelectCommand),(0,u.configureCommand)({bind:e,isBound:s},u.SelectAllCommand),(0,u.configureCommand)({bind:e,isBound:s},u.GetSelectionCommand),e(u.TYPES.IVNodePostprocessor).to(u.LocationPostprocessor),e(u.TYPES.HiddenVNodePostprocessor).to(u.LocationPostprocessor)}));var x=s(8720);function S(e,t=""){return null==e||0==e.length?t:e}function E(e){var t;let s=((null===(t=e.properties)||void 0===t?void 0:t.cssClasses)||"").trim();return s?s.split(" "):[]}class M{constructor(){this.nodeIds=new Set,this.edgeIds=new Set,this.portIds=new Set,this.labelIds=new Set,this.sectionIds=new Set,this.symbolsIds=new Map,this.connectors=new Map}transform(e,t,s){let o=[],i=[];return e.children&&(o=e.children.map(this.transformElkNode,this)),e.edges&&(i=e.edges.map(this.transformElkEdge,this)),{type:"graph",id:e.id||"root",children:[...o,...i],cssClasses:E(e),symbols:this.transformSymbols(t,s)}}transformSymbols(e,t){let s=[];for(const o in e.library)s.push(this.transformSymbol(o,e.library[o],t));return{children:s}}transformSymbol(e,t,s){let o=null==t?void 0:t.element,i=[];return o&&(i=[this.transformSymbolElement(o)]),this.symbolsIds[e]=`${s}_${e}`,(t.hasOwnProperty("symbol_offset")||t.hasOwnProperty("path_offset"))&&(this.connectors[e]=t),{type:"symbol",id:e,children:i,position:this.pos(t),size:this.size(t),properties:t.properties}}transformSymbolElement(e){var t,s;e.properties.isSymbol=!0;let o={id:e.id,position:this.pos(e),size:this.size(e),cssClasses:E(e),children:[],properties:e.properties,type:S(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node")};const i=e.children.map(this.transformSymbolElement,this);return o.children.push(...i),o}transformElkNode(e){var t,s;this.checkAndRememberId(e,this.nodeIds);const o={type:S(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"node"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.children){const t=e.children.map(this.transformElkNode,this);o.children.push(...t)}if(e.ports){const t=e.ports.map(this.transformElkPort,this);o.children.push(...t)}if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}if(e.edges){const t=e.edges.map(this.transformElkEdge,this);o.children.push(...t)}return o}transformElkPort(e){var t,s;this.checkAndRememberId(e,this.portIds);const o={type:S(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"port"),id:e.id,position:this.pos(e),size:this.size(e),children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}return o}transformElkLabel(e){var t,s;this.checkAndRememberId(e,this.labelIds);let o={type:S(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"label"),id:e.id,text:e.text,position:this.pos(e),size:this.size(e),cssClasses:E(e),labels:[],properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};if(e.labels){const t=e.labels.map(this.transformElkLabel,this);o.labels.push(...t)}return o}transformElkEdge(e){var t,s;this.checkAndRememberId(e,this.edgeIds);const o={type:S(null===(s=null===(t=e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.type,"edge"),id:e.id,sourceId:"",targetId:"",routingPoints:[],children:[],cssClasses:E(e),properties:null==e?void 0:e.properties,layoutOptions:null==e?void 0:e.layoutOptions};var i;if(null!=(i=e).source&&null!=i.target?(o.sourceId=e.source,o.targetId=e.target,e.sourcePoint&&o.routingPoints.push(e.sourcePoint),e.bendPoints&&o.routingPoints.push(...e.bendPoints),e.targetPoint&&o.routingPoints.push(e.targetPoint)):function(e){return null!=e.sources&&null!=e.targets}(e)&&(o.sourceId=e.sources[0],o.targetId=e.targets[0],e.sections&&e.sections.forEach((e=>{this.checkAndRememberId(e,this.sectionIds),o.routingPoints.push(e.startPoint),e.bendPoints&&o.routingPoints.push(...e.bendPoints),o.routingPoints.push(e.endPoint)}))),e.junctionPoints&&e.junctionPoints.forEach(((t,s)=>{const i={type:"junction",id:e.id+"_j"+s,position:t};o.children.push(i)})),e.labels){const t=e.labels.map(this.transformElkLabel,this);o.children.push(...t)}return o}pos(e){return{x:e.x||0,y:e.y||0}}size(e){return{width:e.width||0,height:e.height||0}}checkAndRememberId(e,t){if(null==e.id)throw Error("An element is missing an id.");if(t.has(e.id))throw Error("Duplicate id: "+e.id+".");t.add(e.id)}}let k=class extends r.LocalModelSource{async updateLayout(e,t,s){this.elkToSprotty=new M;let o=this.elkToSprotty.transform(e,t,s);await this.updateModel(o)}get root(){return this.factory.root}getById(e){return this.factory.root.index.getById(e)}async doSubmitModel(e,t,s,o){x.XR&&console.log("doSubmitModel"),super.doSubmitModel(e,t,s,o),o||(o=new n.SModelIndex).add(this.currentRoot),this.index=o}element(){return document.getElementById(this.viewerOptions.baseDiv)}center(e=[],t=!0,s=!1){let o=n.CenterAction.create(e,{animate:t,retainZoom:s});this.actionDispatcher.dispatch(o)}fit(e=[],t,s,o){let i=n.FitToScreenAction.create(e,{padding:t,maxZoom:s,animate:o});this.actionDispatcher.dispatch(i)}resize(e){let t=r.InitializeCanvasBoundsAction.create(e);this.actionDispatcher.dispatch(t)}async getViewport(){const e=await this.actionDispatcher.request(n.GetViewportAction.create());return{scroll:e.viewport.scroll,zoom:e.viewport.zoom,canvasBounds:e.canvasBounds}}};k=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)()],k);var I=s(5256);class O extends r.RectangularNode{hasFeature(e){return e!==r.moveFeature&&super.hasFeature(e)}}class C extends r.RectangularPort{hasFeature(e){return e!==r.moveFeature&&super.hasFeature(e)}}class j extends r.SEdgeImpl{hasFeature(e){return e!==r.editFeature&&super.hasFeature(e)}}class _ extends r.SNodeImpl{hasFeature(e){return e!==r.moveFeature&&e!==r.selectFeature&&e!==r.hoverFeedbackFeature&&super.hasFeature(e)}}class P extends r.SLabelImpl{constructor(){super(...arguments),this.selected=!1,this.hoverFeedback=!1}hasFeature(e){var t;return e!==r.selectFeature&&e!==r.hoverFeedbackFeature?super.hasFeature(e):!0===(null===(t=this.properties)||void 0===t?void 0:t.selectable)||void 0}}P.DEFAULT_FEATURES=[r.selectFeature,r.hoverFeedbackFeature,r.boundsFeature,r.alignFeature,r.layoutableChildFeature,r.edgeLayoutFeature,r.fadeFeature];class R extends r.SNodeImpl{hasFeature(e){return e!==r.moveFeature&&super.hasFeature(e)}}class D extends r.ModelRenderer{constructor(e,t,s,o,i={}){super(e,t,s,i),this.viewRegistry=e,this.targetKind=t,this.args=i,this.source=o,this.widgets=new Map}getSelected(){var e;let t=[];if(null===(e=this.source.selectedNodes)||void 0===e?void 0:e.length)for(let e of this.source.selectedNodes){let s=this.source.getById(e.id);t.push(s)}return t}renderJLOverlayControl(e){x.XR&&console.log("render control overlay");let t=[];if(this.source.control_overlay){let s=this.getSelected();if(0==s.length||!s[0])return t;let o=this.source.control_overlay,i=new O,r=function(e){let[t,s,o,i]=F(e[0]);return e.splice(1,e.length).forEach((e=>{let[n,r,l,a]=F(e);n<t&&(t=n),r>s&&(s=r),l>o&&(o=l),a<i&&(i=a)})),{x:t,y:i,height:s-i,width:o-t}}(s),l={width:0,height:0};i.id=s[0].id+"_entropy",i.type="node:widget",i.position=n.Bounds.combine(r,{x:r.width,y:0}),i.size=l,i.properties={shape:{use:o.model_id}};let a={vnode:void 0,node:i,widget:o.model_id,visible:!0,html:void 0},d=this.widgetContainer(a,e,!1);null!=d&&t.push(d)}return t}renderJLNodeWidgets(e){let t=[];for(let s in this.widgets){let o=this.widgets[s],i=this.widgetContainer(o,e);null!=i&&(this.decorate(i,o.node),t.push(i))}return t}widgetContainer(e,t,s=!0){if(!e.visible)return;let o=function(e){var t,s;let o=0,i=0;for(;null!=e;)o+=(null===(t=e.bounds)||void 0===t?void 0:t.x)||0,i+=(null===(s=e.bounds)||void 0===s?void 0:s.y)||0,e=null==e?void 0:e.parent;return{x:o,y:i}}(e.node),i={transform:`translate(${o.x}px, ${o.y}px)`};if(s){let t=e.node.bounds;t||(t=(0,r.getAbsoluteBounds)(e.node)),i.width=`${t.width}px`,i.height=`${t.height}px`}let n={};return e.html&&(n={innerHTML:e.html}),(0,r.html)("div",{key:e.node.id,class:{elkcontainer:!0},style:i,props:n,hook:{insert:t=>this.renderContent(t,e)}})}async renderContent(e,t,s){var o;if("widget"==(0,n.getSubType)(t.node)){let s,i=t.widget;s="string"==typeof i||i instanceof String?await this.source.widget_manager.get_model(i):i;let n=await this.source.widget_manager.create_view(s,{}),r=(null===(o=t.node.properties.shape)||void 0===o?void 0:o.delay)||0;if(r){let e=this.source.root.zoom||1,t=n.luminoWidget.node;t.style.transform=`scale(${1/e})`,t.style.transformOrigin="top left",setTimeout((()=>{t.style.transform=""}),r)}I.Widget.attach(n.luminoWidget,e.elm)}}async registerJLWidgetNode(e,t,s){this.widgets[t.id]=await this.wrapJLWidget(e,t,s)}async wrapJLWidget(e,t,s){var o,i;let r,l,a=null===(i=null===(o=t.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.use;return"widget"==(0,n.getSubType)(t)?a&&(r=await this.source.widget_manager.get_model(a),l=void 0):(r=void 0,l=a),{vnode:e,node:t,widget:r,visible:s,html:l}}getConnector(e){var t;return null===(t=this.source.elkToSprotty)||void 0===t?void 0:t.connectors[e]}hrefID(e){if(e)return this.source.elkToSprotty.symbolsIds[e]}renderChildren(e,t){const s=t?new D(this.viewRegistry,this.targetKind,this.postprocessors,this.source,Object.assign(Object.assign({},t),{parentArgs:this.args})):this;return e.children.map((e=>s.renderElement(e))).filter((e=>null!=e))}}class z extends r.SModelFactory{initializeRoot(e,t){return(null==(e=super.initializeRoot(e,t))?void 0:e.symbols)&&(e.symbols.children=t.symbols.children.map((t=>this.createElement(t,e)))),this.root=e,e}}function F(e){let t=(0,r.getAbsoluteBounds)(e),s=t.x,o=t.y,i=t.x+t.width;return[s,t.y+t.height,i,o]}let T=class extends r.UpdateModelCommand{computeAnimation(e,t,s){const o={fades:[]};(0,r.forEachMatch)(t,((t,i)=>{if(null!=i.left&&null!=i.right)this.updateElement(i.left,i.right,o);else if(null!=i.right){const e=i.right;(0,r.isFadeable)(e)&&(e.opacity=0,o.fades.push({element:e,type:"in"}))}else if(i.left instanceof r.SChildElementImpl){const t=i.left;if((0,r.isFadeable)(t)&&null!=i.leftParentId&&!function(e,t){const s=t=>t.some((t=>(t=>null!=e.index.getById(t.id))(t)||s(t.children)));return s([t])}(e,t)){const n=e.index.getById(i.leftParentId);if(n instanceof r.SParentElementImpl){const e=s.modelFactory.createElement(t);n.add(e),o.fades.push({element:e,type:"out"})}}}}));const i=this.createAnimations(o,e,s);return i.length>=2?new r.CompoundAnimation(e,s,i):1===i.length?i[0]:e}};T=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)()],T);const L=new c.ContainerModule(((e,t,s)=>{(0,r.configureCommand)({bind:e,isBound:s},T)}));var A=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},N=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},B=function(e,t){return function(s,o){t(s,o,e)}};let $=class extends r.ScrollMouseListener{constructor(e){super(),this.model_source=e}mouseDown(e,t){if(null==(0,r.findParentByFeature)(e,r.isMoveable)&&!(e instanceof r.SRoutingHandleImpl))if("node:widget"==e.type)this.lastScrollPosition=void 0;else{const s=(0,r.findParentByFeature)(e,r.isViewport);this.lastScrollPosition=s?{x:t.pageX,y:t.pageY}:void 0}return[]}mouseMove(e,t){if(0===t.buttons)this.mouseUp(e,t);else if(this.lastScrollPosition){const s=(0,r.findParentByFeature)(e,r.isViewport);if(s){const e=(t.pageX-this.lastScrollPosition.x)/s.zoom,o=(t.pageY-this.lastScrollPosition.y)/s.zoom,i={scroll:{x:s.scroll.x-e,y:s.scroll.y-o},zoom:s.zoom};return this.lastScrollPosition={x:t.pageX,y:t.pageY},[n.SetViewportAction.create(s.id,i,{animate:!1})]}}return[]}};$=A([B(0,(0,c.inject)(r.TYPES.ModelSource)),N("design:paramtypes",[k])],$);let V=class extends r.ZoomMouseListener{constructor(e){super(),this.model_source=e}getViewportOffset(e,t){const s=this.model_source.element().getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}};V=A([B(0,(0,c.inject)(r.TYPES.ModelSource)),N("design:paramtypes",[k])],V);let K=class extends r.BoundsAwareViewportCommand{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!n.Dimension.isValid(t.canvasBounds))return;let s=1;this.action.retainZoom&&(0,r.isViewport)(t)?s=t.zoom:this.action.zoomScale&&(s=this.action.zoomScale);const o=n.Bounds.center(e);return{scroll:{x:o.x-.5*t.canvasBounds.width/s||0,y:o.y-.5*t.canvasBounds.height/s||0},zoom:s}}};K.KIND=n.CenterAction.KIND,K=A([B(0,(0,c.inject)(r.TYPES.Action)),N("design:paramtypes",[Object])],K);let Y=class extends r.BoundsAwareViewportCommand{constructor(e){super(e.animate),this.action=e}getElementIds(){return this.action.elementIds}getNewViewport(e,t){if(!n.Dimension.isValid(t.canvasBounds))return;const s=n.Bounds.center(e),o=null==this.action.padding?0:2*this.action.padding;let i=Math.min(t.canvasBounds.width/(e.width+o),t.canvasBounds.height/(e.height+o));null!=this.action.maxZoom&&(i=Math.min(i,this.action.maxZoom)),i===1/0&&(i=1);return{scroll:{x:s.x-.5*t.canvasBounds.width/i||0,y:s.y-.5*t.canvasBounds.height/i||0},zoom:i}}};Y.KIND=n.FitToScreenAction.KIND,Y=A([B(0,(0,c.inject)(r.TYPES.Action)),N("design:paramtypes",[Object])],Y);const U=new c.ContainerModule(((e,t,s)=>{(0,r.configureCommand)({bind:e,isBound:s},K),(0,r.configureCommand)({bind:e,isBound:s},Y),(0,r.configureCommand)({bind:e,isBound:s},r.SetViewportCommand),(0,r.configureCommand)({bind:e,isBound:s},r.GetViewportCommand),e(r.TYPES.KeyListener).to(r.CenterKeyboardListener),e(r.TYPES.MouseListener).to($),e(r.TYPES.MouseListener).to(V)}));let W=class{render(e,t){const s=e.scroll.x?e.scroll.x:0,o=e.scroll.y?e.scroll.y:0,i=`scale(${e.zoom}) translate(${-s},${-o})`;let n=(0,r.svg)("svg",{class:{"sprotty-graph":!0}},(0,r.svg)("g",{transform:i},...t.renderChildren(e)),(0,r.svg)("g",{class:{elksymbols:!0}},...t.renderChildren(e.symbols)));const l={transform:`scale(${e.zoom}) translateZ(0) translate(${-e.scroll.x}px,${-e.scroll.y}px)`};let a=(0,r.html)("div",{"class-sprotty-overlay":!0,style:l},t.renderJLNodeWidgets());return(0,r.html)("div",{"class-sprotty-root":!0},(0,r.html)("div",{"class-sprotty-overlay":!0},t.renderJLOverlayControl()),n,a)}};W=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)()],W);var H=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};function J(e){return 0==e.width&&0==e.height}let G=class{isVisible(e,t){if("hidden"===t.targetKind)return!0;if(!n.Dimension.isValid(e.bounds))return!0;const s=e.root.canvasBounds;if(!J(s))return!0;const o=(0,r.getAbsoluteBounds)(e);return o.x<=s.width&&o.x+o.width>=0&&o.y<=s.height&&o.y+o.height>=0}};G=H([(0,c.injectable)()],G);let Z=class extends G{render(e,t,s){if(!this.isVisible(e,t))return;const o=this.getRadius(e);return(0,r.svg)("g",null,(0,r.svg)("circle",{"class-sprotty-node":e instanceof r.SNodeImpl,"class-sprotty-port":e instanceof r.SPortImpl,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,r:o,cx:o,cy:o}),t.renderChildren(e))}getRadius(e){const t=Math.min(e.size.width,e.size.height);return t>0?t/2:0}};Z=H([(0,c.injectable)()],Z);let X=class extends G{render(e,t,s){if(this.isVisible(e,t))return(0,r.svg)("g",null,(0,r.svg)("rect",{"class-sprotty-node":e instanceof r.SNodeImpl,"class-sprotty-port":e instanceof r.SPortImpl,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:Math.max(e.size.width,0),height:Math.max(e.size.height,0)}),t.renderChildren(e))}};X=H([(0,c.injectable)()],X);var q=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};function Q(e){return`${e.x},${e.y}`}let ee=class extends X{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,r.setClass)(s,"elknode",!0),(0,r.setClass)(s,"mouseover",e.hoverFeedback),(0,r.setClass)(s,"selected",e.selected)),(0,r.setClass)(s,e.type.replace(":","-"),!0),(0,r.svg)("g",null,s,(0,r.svg)("g",{"class-elkchildren":!0},this.renderChildren(e,t)))}renderMark(e,t){return(0,r.svg)("rect",{x:"0",y:"0",width:e.size.width,height:e.size.height})}renderChildren(e,t){return t.renderChildren(e)}isSymbol(e){var t;return 1==(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.isSymbol)}};ee=q([(0,c.injectable)()],ee);let te=class extends ee{renderMark(e,t){let s=e.size.width,o=e.size.height;const i={x:s,y:o/2},n={x:0,y:o/2},l={x:s/2,y:o},a=`${Q({x:s/2,y:0})} ${Q(i)} ${Q(l)} ${Q(n)}`;return(0,r.svg)("polygon",{points:a})}};te=q([(0,c.injectable)()],te);let se=class extends ee{renderMark(e,t){var s,o,i,n;let l=e.size.width/2,a=e.size.height/2,d=null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.x;null==d&&(d=l);let c=null===(n=null===(i=e.properties)||void 0===i?void 0:i.shape)||void 0===n?void 0:n.y;return null==c&&(c=a),(0,r.svg)("ellipse",{rx:l,ry:a,cx:d,cy:c})}};se=q([(0,c.injectable)()],se);let oe=class extends ee{renderMark(e,t){var s,o;let i=e.size.width,n=e.size.height;return(0,r.svg)("image",{width:i,height:n,href:null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use})}};oe=q([(0,c.injectable)()],oe);let ie=class extends ee{renderMark(e,t){var s,o;let i=Number(null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use)||15,n=e.size.width,l=e.size.height;const a=[{x:0,y:0},{x:n-i,y:0},{x:n,y:i},{x:n,y:l},{x:0,y:l}].map(Q).join(" ");return(0,r.svg)("polygon",{points:a})}};ie=q([(0,c.injectable)()],ie);let ne=class extends ee{renderMark(e,t){var s,o;let i=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use;return(0,r.svg)("path",{d:i})}};ne=q([(0,c.injectable)()],ne);let re=class extends ee{renderMark(e,t){var s,o;let i=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,n=t.hrefID(i),l=(0,r.svg)("use",{href:"#"+n,width:e.size.width,height:e.size.height});return(0,r.setClass)(l,i,!0),l}};re=q([(0,c.injectable)()],re);let le=class extends ee{renderMark(e,t){var s,o,i,n,l,a;let d=(null===(o=null===(s=e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.x)||0,c=(null===(n=null===(i=e.properties)||void 0===i?void 0:i.shape)||void 0===n?void 0:n.y)||0;return(0,r.svg)("g",{props:{innerHTML:null===(a=null===(l=null==e?void 0:e.properties)||void 0===l?void 0:l.shape)||void 0===a?void 0:a.use},transform:`translate(${d} ${c})`})}};le=q([(0,c.injectable)()],le);let ae=class extends ee{renderMark(e,t){if(e.parent.type==e.type){const t=e.parent.size;return(0,r.svg)("rect",{x:"0",y:"0",width:t.width,height:e.size.height})}return super.renderMark(e,t)}};ae=q([(0,c.injectable)()],ae);let de=class extends ee{renderMark(e,t){var s,o;let i=(0,r.html)("div",{props:{innerHTML:null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use}});return(0,r.svg)("foreignObject",{requiredFeatures:"http://www.w3.org/TR/SVG11/feature#Extensibility",height:e.size.height,width:e.size.width,x:0,y:0},i)}};de=q([(0,c.injectable)()],de);let ce=class extends ee{render(e,t){if(!this.isSymbol(e)&&!this.isVisible(e,t))return;let s=this.renderMark(e,t);return this.isSymbol(e)||((0,r.setClass)(s,"elknode",!0),(0,r.setClass)(s,"mouseover",e.hoverFeedback),(0,r.setClass)(s,"selected",e.selected)),(0,r.setClass)(s,e.type,!0),(0,r.svg)("g",{hook:{insert:s=>t.registerJLWidgetNode(s,e,!0),destroy:s=>t.registerJLWidgetNode(s,e,!1),update:(s,o)=>t.registerJLWidgetNode(o,e,this.isVisible(e,t))}},s,(0,r.svg)("g",{"class-elkchildren":!0},this.renderChildren(e,t)))}};ce=q([(0,c.injectable)()],ce);let ue=class extends X{render(e,t){var s,o;let i,n=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,l=t.hrefID(n);return l?(i=(0,r.svg)("use",{"class-elkport":!0,width:e.size.width,height:e.size.height,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+l}),(0,r.setClass)(i,n,!0)):i=(0,r.svg)("rect",{"class-elkport":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,x:"0",y:"0",width:e.size.width,height:e.size.height}),(0,r.svg)("g",null,i,t.renderChildren(e))}};ue=q([(0,c.injectable)()],ue);let he=class extends G{render(e,t){var s,o,i,n,l;if(!this.isVisible(e,t))return;let a,d=null===(o=null===(s=null==e?void 0:e.properties)||void 0===s?void 0:s.shape)||void 0===o?void 0:o.use,c=t.hrefID(d);if(c?(a=(0,r.svg)("use",{"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+c,width:e.size.width,height:e.size.height}),(0,r.setClass)(a,d,!0)):a=(0,r.svg)("text",{"class-elklabel":!0,"class-selected":e.selected,"class-mouseover":e.hoverFeedback},e.text),null===(i=e.labels)||void 0===i?void 0:i.length){let s=e.labels[0],o=null===(l=null===(n=null==s?void 0:s.properties)||void 0===n?void 0:n.shape)||void 0===l?void 0:l.use,i=t.hrefID(o),d=e.size.height,c=this.dimension(s),u=this.dimension(e),h={x:0+s.position.x,y:(d-c.height)/2+s.position.x},p=(null==s?void 0:s.layoutOptions)||{},g=Number(p["org.eclipse.elk.spacing.labelLabel"])||0,m={x:c.width+g,y:(d-u.height)/2};a=(0,r.svg)("g",null,(0,r.svg)("use",{transform:`translate(${h.x} ${h.y})`,"class-elklabel":!0,"class-mouseover":e.hoverFeedback,"class-selected":e.selected,href:"#"+i,width:s.size.width,height:s.size.height}),(0,r.svg)("g",{transform:`translate(${m.x} ${m.y})`},a))}return a}dimension(e){var t,s,o,i;return{width:(null===(s=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.shape)||void 0===s?void 0:s.width)||e.size.width,height:(null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.height)||e.size.height}}isVisible(e,t){if(!super.isVisible(e,t))return!1;let s,o=e.root.zoom;return s=!e.size.height||o*e.size.height>3,s}};he=q([(0,c.injectable)()],he);var pe=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r};let ge=class extends Z{render(e,t){const s=this.getRadius(e);return(0,r.svg)("g",null,(0,r.svg)("circle",{"class-elkjunction":!0,r:s}))}getRadius(e){return 2}};ge=pe([(0,c.injectable)()],ge);let me=class extends r.PolylineEdgeView{isVisible(e,t,s){if("hidden"===s.targetKind)return!0;if(0===t.length)return!0;const o=e.root.canvasBounds;if(!J(o))return!0;const i=(0,r.getAbsoluteRouteBounds)(e,t);return i.x<=o.width&&i.x+i.width>=0&&i.y<=o.height&&i.y+i.height>=0}render(e,t){const s=this.edgeRouterRegistry.get(e.routerKind).route(e);if(0===s.length)return this.renderDanglingEdge("Cannot compute route",e,t);if(!this.isVisible(e,s,t)){if(0===e.children.length)return;return(0,r.svg)("g",null,t.renderChildren(e,{route:s}))}return(0,r.svg)("g",{"class-elkedge":!0,"class-mouseover":e.hoverFeedback},this.renderLine(e,s,t),this.renderAdditionals(e,s,t),t.renderChildren(e,{route:s}))}renderLine(e,t,s){var o,i,l,a;const d=t[1],c=t[0];let u=(0,n.angleOfPoint)({x:d.x-c.x,y:d.y-c.y});const h=t[t.length-2],p=t[t.length-1];let g=(0,n.angleOfPoint)({x:h.x-p.x,y:h.y-p.y}),m=this.getPathOffset(null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.start,s,u),f=this.getPathOffset(null===(a=null===(l=null==e?void 0:e.properties)||void 0===l?void 0:l.shape)||void 0===a?void 0:a.end,s,g);const v=t[0];let y=`M ${v.x-m.x},${v.y-m.y}`;for(let e=1;e<t.length-1;e++){const s=t[e];y+=` L ${s.x},${s.y}`}const b=t[t.length-1];return y+=` L ${b.x-f.x}, ${b.y-f.y}`,(0,r.svg)("path",{d:y})}getAnchorOffset(e,t,s){let o=t.getConnector(e);if(null==o?void 0:o.symbol_offset){const e=o.symbol_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}getPathOffset(e,t,s){let o=t.getConnector(e);if(null==o?void 0:o.path_offset){const e=o.path_offset;return{x:e.x*Math.cos(s)-e.y*Math.sin(s),y:e.x*Math.sin(s)+e.y*Math.cos(s)}}return{x:0,y:0}}renderAdditionals(e,t,s){var o,i,l,a;let d,c,u,h=[],p=null===(i=null===(o=null==e?void 0:e.properties)||void 0===o?void 0:o.shape)||void 0===i?void 0:i.start,g=null===(a=null===(l=null==e?void 0:e.properties)||void 0===l?void 0:l.shape)||void 0===a?void 0:a.end;if(p){const e=t[1],o=t[0];let i=(0,n.angleOfPoint)({x:e.x-o.x,y:e.y-o.y});c=this.getAnchorOffset(p,s,i);let l=o.x-c.x,a=o.y-c.y;d=s.hrefID(p),u=(0,r.svg)("use",{href:"#"+d,"class-elkedge-start":!0,"class-elkarrow":!0,transform:`rotate(${(0,n.toDegrees)(i)} ${l} ${a}) translate(${l} ${a})`}),(0,r.setClass)(u,p,!0),h.push(u)}if(g){const e=t[t.length-2],o=t[t.length-1];let i=(0,n.angleOfPoint)({x:e.x-o.x,y:e.y-o.y});c=this.getAnchorOffset(g,s,i);let l=o.x-c.x,a=o.y-c.y;d=s.hrefID(g),u=(0,r.svg)("use",{href:"#"+d,"class-elkedge-end":!0,"class-elkarrow":!0,transform:`rotate(${(0,n.toDegrees)(i)} ${l} ${a}) translate(${l} ${a})`}),(0,r.setClass)(u,g,!0),h.push(u)}return h}};me=pe([(0,c.injectable)()],me);let fe=class{render(e,t){var s,o;let i=(null===(s=e.position)||void 0===s?void 0:s.x)||0,n=(null===(o=e.position)||void 0===o?void 0:o.y)||0,l=e.size.width||0,a=e.size.height||0,d={class:{[e.id]:!0,elksymbol:!0}};return l&&a&&(d.viewBox=`${i} ${n} ${l} ${a}`),(0,r.svg)("symbol",d,...t.renderChildren(e))}};fe=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)()],fe);class ve extends r.SvgExporter{isExported(e){return null!=e.href&&(e.href.endsWith("diagram.css")||e.href.endsWith("sprotty.css"))}}var ye=s(6568);class be extends r.MouseListener{constructor(){super(...arguments),this.isMouseDown=!1,this.isMouseDrag=!1}mouseDown(e,t){return this.isMouseDown=!0,[]}mouseMove(e,t){return this.isMouseDown&&(this.isMouseDrag=!0),[]}mouseUp(e,t){return this.isMouseDown=!1,this.isMouseDrag?(this.isMouseDrag=!1,this.draggingMouseUp(e,t)):this.nonDraggingMouseUp(e,t)}nonDraggingMouseUp(e,t){return[]}draggingMouseUp(e,t){return[]}}class we extends be{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}mouseOver(e,t){return[n.HoverFeedbackAction.create({mouseoverElement:e.id,mouseIsOver:!0})]}mouseOut(e,t){return[n.HoverFeedbackAction.create({mouseoverElement:e.id,mouseIsOver:!1})]}}let xe=class extends r.MouseTool{constructor(){super(...arguments),this.elementTypeId="unknown",this.operationKind="generic"}get id(){return`tool_${this.operationKind}_${this.elementTypeId}`}enable(){}disable(){}dispatchFeedback(e){}};function Se(e){return e.id}xe=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r}([(0,c.injectable)()],xe);var Ee=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},Me=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},ke=function(e,t){return function(s,o){t(s,o,e)}};let Ie=class extends xe{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=n.SelectAction.KIND}enable(){this.selectionToolMouseListener=new Oe(this.elementTypeId,this),this.mouseTool.register(this.selectionToolMouseListener)}disable(){this.mouseTool.deregister(this.selectionToolMouseListener)}};Ie=Ee([(0,c.injectable)(),ke(0,(0,c.inject)(r.MouseTool)),ke(1,(0,c.inject)(h.IFeedbackActionDispatcher)),Me("design:paramtypes",[Object,Object])],Ie);let Oe=class extends we{constructor(e,t){super(e,t),this.elementTypeId=e,this.tool=t}nonDraggingMouseUp(e,t){let s=[],o=[];if(0===t.button&&!function(e){var t;return null===(t=null==e?void 0:e.classList)||void 0===t?void 0:t.contains("jupyter-widgets")}(t.target)){const i=(0,r.findParentByFeature)(e,r.isSelectable);null!=i&&((0,r.isCtrlOrCmd)(t)||(o=(0,ye.toArray)(e.root.index.all().filter((e=>(0,r.isSelectable)(e)&&e.selected&&!(i instanceof r.SRoutingHandleImpl&&e===i.parent))))),null!=i&&(i.selected?(0,r.isCtrlOrCmd)(t)&&(o=[i]):s=[i]))}return[n.SelectAction.create({selectedElementsIDs:s.map(Se),deselectedElementsIDs:o.map(Se)})]}decorate(e,t){const s=(0,r.findParentByFeature)(t,r.isSelectable);return null!=s&&(0,r.setClass)(e,"selected",s.selected),e}};Oe=Ee([(0,c.injectable)(),Me("design:paramtypes",[String,Ie])],Oe);var Ce=function(e,t,s,o){var i,n=arguments.length,r=n<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,s):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,s,o);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(r=(n<3?i(r):n>3?i(t,s,r):i(t,s))||r);return n>3&&r&&Object.defineProperty(t,s,r),r},je=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_e=function(e,t){return function(s,o){t(s,o,e)}};class Pe{constructor(e=[],t=[]){this.expandElementsIDs=e,this.contractElementsIDs=t,this.kind=n.SelectAction.KIND}}Pe.KIND="elementExpand";let Re=class extends xe{constructor(e,t){super(),this.mouseTool=e,this.feedbackDispatcher=t,this.elementTypeId="unknown",this.operationKind=Pe.KIND}enable(){this.expansionToolMouseListener=new De(this.elementTypeId,this),this.mouseTool.register(this.expansionToolMouseListener)}disable(){this.mouseTool.deregister(this.expansionToolMouseListener)}dispatchFeedback(e){this.feedbackDispatcher.registerFeedback(this,e)}};Re=Ce([(0,c.injectable)(),_e(0,(0,c.inject)(r.MouseTool)),_e(1,(0,c.inject)(h.IFeedbackActionDispatcher)),je("design:paramtypes",[Object,Object])],Re);let De=class extends be{constructor(e,t){super(),this.elementTypeId=e,this.tool=t}wheel(e,t){return[]}decorate(e,t){const s=(0,r.findParentByFeature)(t,r.isSelectable);return null!=s&&(0,r.setClass)(e,"selected",s.selected),e}};De=Ce([(0,c.injectable)(),je("design:paramtypes",[String,Re])],De);class ze extends d.DOMWidgetModel{defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:ze.model_name,_model_module_version:x.xv,overlay:null})}}ze.model_name="ELKControlModel",ze.serializers=Object.assign(Object.assign({},d.DOMWidgetModel.serializers),{overlay:{deserialize:d.unpack_models}});class Fe extends d.DOMWidgetModel{constructor(){super(...arguments),this.layoutUpdated=new a.Signal(this),this.diagramUpdated=new a.Signal(this)}defaults(){return Object.assign(Object.assign({},super.defaults()),{_model_name:Fe.model_name,_model_module_version:x.xv,_view_module:x.o_,_view_name:Te.view_name,_view_module_version:x.xv,symbols:{},source:null,control_overlay:null})}initialize(e,t){super.initialize(e,t)}}Fe.model_name="ELKViewerModel",Fe.serializers=Object.assign(Object.assign({},d.DOMWidgetModel.serializers),{source:{deserialize:d.unpack_models},selection:{deserialize:d.unpack_models},hover:{deserialize:d.unpack_models},painter:{deserialize:d.unpack_models},zoom:{deserialize:d.unpack_models},pan:{deserialize:d.unpack_models},control_overlay:{deserialize:d.unpack_models}});class Te extends d.DOMWidgetView{constructor(){super(...arguments),this.was_shown=new l.PromiseDelegate,this.wait_for_visible=(e=!1)=>{this.luminoWidget.isVisible?setTimeout(this.wait_for_visible,e?0:300):this.was_shown.resolve()},this.resize=(e=-1,t=-1)=>{if(-1===e||-1===t){const s=this.el.getBoundingClientRect();e=s.width,t=s.height}this.source.resize({width:e,height:t,x:0,y:0})}}initialize(e){super.initialize(e),this.luminoWidget.addClass(x.Pr.widget_class),this.on("change:source",this.on_source_changed,this),this.on_source_changed()}async on_source_changed(){let e=this.model.get("source");e&&(e.on("change:value",this.diagramLayout,this),this.diagramLayout())}async render(){const e=this.el,t=document.createElement("div");this.div_id=t.id=Le.next_id(),e.appendChild(t),this.initSprotty().catch(console.warn),this.wait_for_visible(!0)}async initSprotty(){await this.was_shown.promise;const e=(e=>{const t=new c.ContainerModule(((t,s,o,i)=>{t(r.TYPES.ModelSource).to(k).inSingletonScope(),i(r.TYPES.ILogger).to(r.ConsoleLogger).inSingletonScope(),i(r.TYPES.LogLevel).toConstantValue(r.LogLevel.warn),i(r.TYPES.SvgExporter).to(ve).inSingletonScope();const n={bind:t,unbind:s,isBound:o,rebind:i};(0,r.configureModelElement)(n,"graph",r.SGraphImpl,W),(0,r.configureModelElement)(n,"node",O,ee),(0,r.configureModelElement)(n,"node:use",O,re),(0,r.configureModelElement)(n,"node:diamond",O,te),(0,r.configureModelElement)(n,"node:round",O,se),(0,r.configureModelElement)(n,"node:image",O,oe),(0,r.configureModelElement)(n,"node:comment",O,ie),(0,r.configureModelElement)(n,"node:path",O,ne),(0,r.configureModelElement)(n,"node:svg",O,le),(0,r.configureModelElement)(n,"node:html",O,ce),(0,r.configureModelElement)(n,"node:widget",O,ce),(0,r.configureModelElement)(n,"node:compartment",O,ae),(0,r.configureModelElement)(n,"node:foreignobject",O,de),(0,r.configureModelElement)(n,"port",C,ue),(0,r.configureModelElement)(n,"edge",j,me),(0,r.configureModelElement)(n,"label",P,he),(0,r.configureModelElement)(n,"label:icon",P,he),(0,r.configureModelElement)(n,"junction",_,ge),(0,r.configureViewerOptions)(n,{needsClientLayout:!1,baseDiv:e}),(0,r.configureCommand)(n,r.HoverFeedbackCommand),(0,r.configureModelElement)(n,"symbol",R,fe),i(r.TYPES.ModelRendererFactory).toFactory((e=>(t,s,o)=>{const i=e.container.get(r.TYPES.ViewRegistry),n=e.container.get(r.TYPES.ModelSource);return new D(i,t,s,n,o)})),i(r.TYPES.IModelFactory).to(z).inSingletonScope()})),s=new c.Container;return s.load(r.defaultModule,r.boundsModule,r.moveModule,r.fadeModule,L,r.undoRedoModule,U,r.routingModule,r.exportModule,r.modelSourceModule,r.edgeEditModule,r.labelEditModule,w,r.edgeLayoutModule,t),s})(this.div_id);this.container=e,this.source=e.get(r.TYPES.ModelSource),this.source.diagramWidget=this,this.source.widget_manager=this.model.widget_manager,this.source.factory=e.get(r.TYPES.IModelFactory),this.registry=e.get(r.ActionHandlerRegistry),this.actionDispatcher=e.get(r.TYPES.IActionDispatcher),this.feedbackDispatcher=e.get(h.IFeedbackActionDispatcher),this.model.on("change:selection",this.updateSelectedTool,this),this.model.on("change:hover",this.updateHoverTool,this),this.model.on("change:interaction",this.interaction_mode_changed,this),this.model.on("msg:custom",this.handleMessage,this),this.model.on("change:symbols",this.diagramLayout,this),this.model.on("change:control_overlay",this.updateControlOverlay,this),this.updateSelectedTool(),this.updateHoverTool(),this.updateControlOverlay(),this.touch(),this.registry.register(n.SelectAction.KIND,this),this.registry.register(n.SelectionResult.KIND,this),this.registry.register(n.HoverFeedbackAction.KIND,this),this.registry.register(n.SetModelAction.KIND,this),this.registry.register(n.UpdateModelAction.KIND,this),e.resolve(Ie).enable(),e.resolve(Re).enable(),this.diagramLayout().catch((e=>console.warn("ELK Failed initial view render",e))),setTimeout((()=>{this.resize()}),3e3)}updateControlOverlay(){let e=this.model.get("control_overlay");this.source.control_overlay=e}processPhosphorMessage(e){this.processLuminoMessage(e)}processLuminoMessage(e){switch(super.processLuminoMessage(e),e.type){case"resize":const t=e;let{width:s,height:o}=t;this.resize(s,o);break;case"after-show":this.resize()}}handle(e){switch(e.kind){case n.SelectAction.KIND:this.source.getSelection().then((e=>{let t=[],s=[];e.forEach(((e,o)=>{t.push(e.id),s.push(e)}));let o=this.model.get("selection");null!=o&&(o.set("ids",t),o.save_changes(),this.setSelectedNodes(t),this.model.diagramUpdated.emit(void 0))}));break;case n.SelectionResult.KIND:break;case n.HoverFeedbackAction.KIND:let t=e;if(t.mouseIsOver){let e=this.model.get("hover");null!=e&&(e.set("ids",t.mouseoverElement),e.save_changes(),this.model.diagramUpdated.emit(void 0))}break;case n.SetModelAction.KIND:let s=e;const{newRoot:o}=s;o&&(this.currentRoot=o);case n.UpdateModelAction.KIND:}}updateSelectedTool(){let e=this.model.get("selection");null!=e&&e.on("change:ids",this.updateSelected,this)}async updateSelected(){let e=this.model.get("selection");if(null!=e){let t=e.get("ids"),s=e.previous("ids"),o=i()(s,t),r=i()(t,s);await this.actionDispatcher.dispatch(n.SelectAction.create({selectedElementsIDs:r,deselectedElementsIDs:o})),this.setSelectedNodes(t),this.model.diagramUpdated.emit(void 0)}}async setSelectedNodes(e){this.source.selectedNodes=e.map((e=>this.source.index.getById(e)))}updateHoverTool(){let e=this.model.get("hover");null!=e&&e.on("change:ids",this.updateHover,this)}async updateHover(){let e=this.model.get("hover");if(null!=e){let t=e.get("ids"),s=e.previous("ids");await this.actionDispatcher.dispatchAll([n.HoverFeedbackAction.create({mouseoverElement:t,mouseIsOver:!0}),n.HoverFeedbackAction.create({mouseoverElement:s,mouseIsOver:!1})]),this.model.diagramUpdated.emit(void 0)}}async interaction_mode_changed(){}async diagramLayout(){var e;let t=null===(e=this.model.get("source"))||void 0===e?void 0:e.get("value"),s=this.model.get("symbols");if(null==t||null==s||null==this.source)return null;await this.source.updateLayout(t,s,this.div_id),this.model.layoutUpdated.emit(),this.model.diagramUpdated.emit()}normalizeElementIds(e){let t=[];return null!=e&&(t=Array.isArray(e)?e:[e]),t}handleMessage(e){switch(e.action){case"center":this.resize(),this.source.center(this.normalizeElementIds(e.model_id),e.animate,e.retain_zoom);break;case"fit":this.resize(),this.source.fit(this.normalizeElementIds(e.model_id),null==e.padding?0:e.padding,null==e.max_zoom?1/0:e.max_zoom,null==e.animate||e.animate);break;default:console.warn("ELK unhandled message",e)}}}var Le;Te.view_name="ELKViewerView",function(e){let t=0;e.next_id=function(){return"sprotty_"+t++}}(Le||(Le={}))}}]);
//# sourceMappingURL=elkdisplay.35eec427713e9b20bfb9.js.map?v=35eec427713e9b20bfb9