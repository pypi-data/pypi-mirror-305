"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[16204],{77226:function(e,t,i){i.d(t,{A:function(){return a}});i(71499),i(28552),i(36016),i(55228),i(43037);var r=function(e){var t=parseFloat(e);if(isNaN(t))throw new Error("".concat(e," is not a number"));return t};function a(e){if(!e)return null;try{if(e.endsWith("%"))return{w:100,h:r(e.substr(0,e.length-1))};var t=e.replace(":","x").split("x");return 0===t.length?null:1===t.length?{w:r(t[0]),h:1}:{w:r(t[0]),h:r(t[1])}}catch(i){}return null}},8437:function(e,t,i){var r,a,n,o,s,d,l,c=i(33994),h=i(22858),u=i(64599),v=i(35806),k=i(71008),f=i(62193),m=i(2816),p=i(27927),y=i(35890),_=(i(81027),i(15112)),g=i(29818),b=i(33922),w=i(19244),A=i(42496),E=i(88800),I=(i(62745),i(39790),i(66457),i(253),i(54846),i(66555),i(10977)),C=i(34897);i(13292),(0,p.A)([(0,g.EM)("ha-web-rtc-player")],(function(e,t){var i,o=function(t){function i(){var t;(0,k.A)(this,i);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t=(0,f.A)(this,i,[].concat(a)),e(t),t}return(0,m.A)(i,t),(0,v.A)(i)}(t);return{F:o,d:[{kind:"field",decorators:[(0,g.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,g.MZ)()],key:"entityid",value:void 0},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({attribute:"poster-url"})],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,g.wk)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,g.P)("#remote-stream",!0)],key:"_videoEl",value:void 0},{kind:"field",key:"_peerConnection",value:void 0},{kind:"field",key:"_remoteStream",value:void 0},{kind:"method",key:"render",value:function(){return this._error?(0,_.qy)(r||(r=(0,u.A)(['<ha-alert alert-type="error">',"</ha-alert>"])),this._error):(0,_.qy)(a||(a=(0,u.A)([' <video id="remote-stream" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" poster="','" @loadeddata="','"></video> '])),this.autoPlay,this.muted,this.playsInline,this.controls,(0,I.J)(this.posterUrl),this._loadedData)}},{kind:"method",key:"connectedCallback",value:function(){(0,y.A)(o,"connectedCallback",this,3)([]),this.hasUpdated&&this._startWebRtc()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,y.A)(o,"disconnectedCallback",this,3)([]),this._cleanUp()}},{kind:"method",key:"updated",value:function(e){e.has("entityid")&&this._startWebRtc()}},{kind:"method",key:"_startWebRtc",value:(i=(0,h.A)((0,c.A)().mark((function e(){var t,i,r,a,n,o,s,d,l,h,u=this;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.time("WebRTC"),this._error=void 0,console.timeLog("WebRTC","start clientConfig"),e.next=5,(0,E.bT)(this.hass,this.entityid);case 5:return t=e.sent,console.timeLog("WebRTC","end clientConfig",t),i=new RTCPeerConnection(t.configuration),t.dataChannel&&i.createDataChannel(t.dataChannel),i.addTransceiver("audio",{direction:"recvonly"}),i.addTransceiver("video",{direction:"recvonly"}),r={offerToReceiveAudio:!0,offerToReceiveVideo:!0},console.timeLog("WebRTC","start createOffer",r),e.next=15,i.createOffer(r);case 15:return a=e.sent,console.timeLog("WebRTC","end createOffer",a),console.timeLog("WebRTC","start setLocalDescription"),e.next=20,i.setLocalDescription(a);case 20:return console.timeLog("WebRTC","end setLocalDescription"),console.timeLog("WebRTC","start iceResolver"),n="",o=new Promise((function(e){i.addEventListener("icecandidate",(function(t){var i;null!==(i=t.candidate)&&void 0!==i&&i.candidate?(console.timeLog("WebRTC","iceResolver candidate",t.candidate),n+="a=".concat(t.candidate.candidate,"\r\n")):e()}))})),e.next=26,o;case 26:return console.timeLog("WebRTC","end iceResolver",n),s=a.sdp+n,e.prev=28,console.timeLog("WebRTC","start WebRTCOffer",s),e.next=32,(0,E.ey)(this.hass,this.entityid,s);case 32:d=e.sent,console.timeLog("WebRTC","end webRtcOffer",d),e.next=41;break;case 36:return e.prev=36,e.t0=e.catch(28),this._error="Failed to start WebRTC stream: "+e.t0.message,i.close(),e.abrupt("return");case 41:return l=new MediaStream,i.addEventListener("track",(function(e){console.timeLog("WebRTC","track",e),l.addTrack(e.track),u._videoEl.srcObject=l})),this._remoteStream=l,h=new RTCSessionDescription({type:"answer",sdp:d.answer}),e.prev=45,console.timeLog("WebRTC","start setRemoteDescription",h),e.next=49,i.setRemoteDescription(h);case 49:console.timeLog("WebRTC","end setRemoteDescription"),e.next=57;break;case 52:return e.prev=52,e.t1=e.catch(45),this._error="Failed to connect WebRTC stream: "+e.t1.message,i.close(),e.abrupt("return");case 57:this._peerConnection=i;case 58:case"end":return e.stop()}}),e,this,[[28,36],[45,52]])}))),function(){return i.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){this._remoteStream&&(this._remoteStream.getTracks().forEach((function(e){e.stop()})),this._remoteStream=void 0),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load()),this._peerConnection&&(this._peerConnection.close(),this._peerConnection=void 0)}},{kind:"method",key:"_loadedData",value:function(){console.timeLog("WebRTC","loadedData"),console.timeEnd("WebRTC"),(0,C.r)(this,"load")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,_.AH)(n||(n=(0,u.A)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}"])))}}]}}),_.WF),(0,p.A)([(0,g.EM)("ha-camera-stream")],(function(e,t){var i,r,a=function(t){function i(){var t;(0,k.A)(this,i);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t=(0,f.A)(this,i,[].concat(a)),e(t),t}return(0,m.A)(i,t),(0,v.A)(i)}(t);return{F:a,d:[{kind:"field",decorators:[(0,g.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,g.MZ)({attribute:!1})],key:"stateObj",value:void 0},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,g.MZ)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,g.wk)()],key:"_posterUrl",value:void 0},{kind:"field",decorators:[(0,g.wk)()],key:"_forceMJPEG",value:void 0},{kind:"field",decorators:[(0,g.wk)()],key:"_url",value:void 0},{kind:"field",decorators:[(0,g.wk)()],key:"_connected",value:function(){return!1}},{kind:"method",key:"willUpdate",value:function(e){var t;e.has("stateObj")&&!this._shouldRenderMJPEG&&this.stateObj&&(null===(t=e.get("stateObj"))||void 0===t?void 0:t.entity_id)!==this.stateObj.entity_id&&(this._getPosterUrl(),this.stateObj.attributes.frontend_stream_type===E.Ub&&(this._forceMJPEG=void 0,this._url=void 0,this._getStreamUrl()))}},{kind:"method",key:"connectedCallback",value:function(){(0,y.A)(a,"connectedCallback",this,3)([]),this._connected=!0}},{kind:"method",key:"disconnectedCallback",value:function(){(0,y.A)(a,"disconnectedCallback",this,3)([]),this._connected=!1}},{kind:"method",key:"render",value:function(){return this.stateObj?this._shouldRenderMJPEG?(0,_.qy)(o||(o=(0,u.A)(['<img .src="','" .alt="','">'])),this._connected?(0,E.CK)(this.stateObj):"","Preview of the ".concat((0,w.u)(this.stateObj)," camera.")):this.stateObj.attributes.frontend_stream_type===E.Ub?this._url?(0,_.qy)(s||(s=(0,u.A)(['<ha-hls-player autoplay playsinline .allowExoPlayer="','" .muted="','" .controls="','" .hass="','" .url="','" .posterUrl="','"></ha-hls-player>'])),this.allowExoPlayer,this.muted,this.controls,this.hass,this._url,this._posterUrl):_.s6:this.stateObj.attributes.frontend_stream_type===E.zS?(0,_.qy)(d||(d=(0,u.A)(['<ha-web-rtc-player autoplay playsinline .muted="','" .controls="','" .hass="','" .entityid="','" .posterUrl="','"></ha-web-rtc-player>'])),this.muted,this.controls,this.hass,this.stateObj.entity_id,this._posterUrl):_.s6:_.s6}},{kind:"get",key:"_shouldRenderMJPEG",value:function(){return this._forceMJPEG===this.stateObj.entity_id||(!(0,A.$)(this.stateObj,E.JT)||(this.stateObj.attributes.frontend_stream_type===E.zS?"undefined"==typeof RTCPeerConnection:!(0,b.x)(this.hass,"stream")))}},{kind:"method",key:"_getPosterUrl",value:(r=(0,h.A)((0,c.A)().mark((function e(){return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,E.C4)(this.hass,this.stateObj.entity_id,this.clientWidth,this.clientHeight);case 3:this._posterUrl=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),this._posterUrl=void 0;case 9:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return r.apply(this,arguments)})},{kind:"method",key:"_getStreamUrl",value:(i=(0,h.A)((0,c.A)().mark((function e(){var t,i;return(0,c.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,E.wv)(this.hass,this.stateObj.entity_id);case 3:t=e.sent,i=t.url,this._url=i,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0),this._forceMJPEG=this.stateObj.entity_id;case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return i.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,_.AH)(l||(l=(0,u.A)([":host,img{display:block}img{width:100%}"])))}}]}}),_.WF)},62745:function(e,t,i){var r,a,n,o,s=i(33994),d=i(22858),l=i(64599),c=i(35806),h=i(71008),u=i(62193),v=i(2816),k=i(27927),f=i(35890),m=(i(88871),i(81027),i(95737),i(39790),i(66457),i(36016),i(7760),i(99019),i(96858),i(84341),i(49365),i(38389),i(74860),i(71011),i(71174),i(15112)),p=i(29818),y=i(34897),_=i(61441);i(13292),(0,k.A)([(0,p.EM)("ha-hls-player")],(function(e,t){var k,g,b,w,A=function(t){function i(){var t;(0,h.A)(this,i);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t=(0,u.A)(this,i,[].concat(a)),e(t),t}return(0,v.A)(i,t),(0,c.A)(i)}(t);return{F:A,d:[{kind:"field",decorators:[(0,p.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"url",value:void 0},{kind:"field",decorators:[(0,p.MZ)()],key:"posterUrl",value:void 0},{kind:"field",decorators:[(0,p.MZ)({type:Boolean,attribute:"controls"})],key:"controls",value:function(){return!1}},{kind:"field",decorators:[(0,p.MZ)({type:Boolean,attribute:"muted"})],key:"muted",value:function(){return!1}},{kind:"field",decorators:[(0,p.MZ)({type:Boolean,attribute:"autoplay"})],key:"autoPlay",value:function(){return!1}},{kind:"field",decorators:[(0,p.MZ)({type:Boolean,attribute:"playsinline"})],key:"playsInline",value:function(){return!1}},{kind:"field",decorators:[(0,p.MZ)({type:Boolean,attribute:"allow-exoplayer"})],key:"allowExoPlayer",value:function(){return!1}},{kind:"field",decorators:[(0,p.P)("video")],key:"_videoEl",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_error",value:void 0},{kind:"field",decorators:[(0,p.wk)()],key:"_errorIsFatal",value:function(){return!1}},{kind:"field",key:"_hlsPolyfillInstance",value:void 0},{kind:"field",key:"_exoPlayer",value:function(){return!1}},{kind:"field",static:!0,key:"streamCount",value:function(){return 0}},{kind:"method",key:"connectedCallback",value:function(){(0,f.A)(A,"connectedCallback",this,3)([]),A.streamCount+=1,this.hasUpdated&&(this._resetError(),this._startHls())}},{kind:"method",key:"disconnectedCallback",value:function(){(0,f.A)(A,"disconnectedCallback",this,3)([]),A.streamCount-=1,this._cleanUp()}},{kind:"method",key:"render",value:function(){return(0,m.qy)(r||(r=(0,l.A)([" "," "," "])),this._error?(0,m.qy)(a||(a=(0,l.A)(['<ha-alert alert-type="error" class="','"> '," </ha-alert>"])),this._errorIsFatal?"fatal":"retry",this._error):"",this._errorIsFatal?"":(0,m.qy)(n||(n=(0,l.A)(['<video .poster="','" ?autoplay="','" .muted="','" ?playsinline="','" ?controls="','" @loadeddata="','"></video>'])),this.posterUrl,this.autoPlay,this.muted,this.playsInline,this.controls,this._loadedData))}},{kind:"method",key:"updated",value:function(e){(0,f.A)(A,"updated",this,3)([e]),e.has("url")&&(this._cleanUp(),this._resetError(),this._startHls())}},{kind:"method",key:"_startHls",value:(w=(0,d.A)((0,s.A)().mark((function e(){var t,r,a,n,o,d,l,c,h,u;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=fetch(this.url),e.next=3,Promise.all([i.e(72915),i.e(96860)]).then(i.bind(i,96860));case 3:if(a=e.sent.default,this.isConnected){e.next=6;break}return e.abrupt("return");case 6:if((n=a.isSupported())||(n=""!==this._videoEl.canPlayType("application/vnd.apple.mpegurl")),n){e.next=11;break}return this._setFatalError(this.hass.localize("ui.components.media-browser.video_not_supported")),e.abrupt("return");case 11:return o=this.allowExoPlayer&&(null===(t=this.hass.auth.external)||void 0===t?void 0:t.config.hasExoPlayer),e.next=14,r;case 14:return e.next=16,e.sent.text();case 16:if(d=e.sent,this.isConnected){e.next=19;break}return e.abrupt("return");case 19:c=(l=/#EXT-X-STREAM-INF:.*?(?:CODECS=".*?(hev1|hvc1)?\..*?".*?)?(?:\n|\r\n)(.+)/g).exec(d),h=l.exec(d),u=null!==c&&null===h?new URL(c[2],this.url).href:this.url,o&&null!==c&&void 0!==c[1]?this._renderHLSExoPlayer(u):a.isSupported()?this._renderHLSPolyfill(this._videoEl,a,u):this._renderHLSNative(this._videoEl,u);case 24:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{kind:"method",key:"_renderHLSExoPlayer",value:(b=(0,d.A)((0,s.A)().mark((function e(t){return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._exoPlayer=!0,window.addEventListener("resize",this._resizeExoPlayer),this.updateComplete.then((function(){return(0,_.E)()})).then(this._resizeExoPlayer),this._videoEl.style.visibility="hidden",e.next=6,this.hass.auth.external.fireMessage({type:"exoplayer/play_hls",payload:{url:new URL(t,window.location.href).toString(),muted:this.muted}});case 6:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{kind:"field",key:"_resizeExoPlayer",value:function(){var e=this;return function(){if(e._videoEl){var t=e._videoEl.getBoundingClientRect();e.hass.auth.external.fireMessage({type:"exoplayer/resize",payload:{left:t.left,top:t.top,right:t.right,bottom:t.bottom}})}}}},{kind:"method",key:"_isLLHLSSupported",value:function(){if(A.streamCount<=2)return!0;if(!("performance"in window)||0===performance.getEntriesByType("resource").length)return!1;var e=performance.getEntriesByType("resource")[0];return"nextHopProtocol"in e&&"h2"===e.nextHopProtocol}},{kind:"method",key:"_renderHLSPolyfill",value:(g=(0,d.A)((0,s.A)().mark((function e(t,i,r){var a,n=this;return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=new i({backBufferLength:60,fragLoadingTimeOut:3e4,manifestLoadingTimeOut:3e4,levelLoadingTimeOut:3e4,maxLiveSyncPlaybackRate:2,lowLatencyMode:this._isLLHLSSupported()}),this._hlsPolyfillInstance=a,a.attachMedia(t),a.on(i.Events.MEDIA_ATTACHED,(function(){n._resetError(),a.loadSource(r)})),a.on(i.Events.FRAG_LOADED,(function(e,t){n._resetError()})),a.on(i.Events.ERROR,(function(e,t){if(t.fatal)if(t.type===i.ErrorTypes.NETWORK_ERROR){switch(t.details){case i.ErrorDetails.MANIFEST_LOAD_ERROR:var r="Error starting stream, see logs for details";void 0!==t.response&&void 0!==t.response.code&&(t.response.code>=500?r+=" (Server failure)":t.response.code>=400?r+=" (Stream never started)":r+=" ("+t.response.code+")"),n._setRetryableError(r);break;case i.ErrorDetails.MANIFEST_LOAD_TIMEOUT:n._setRetryableError("Timeout while starting stream");break;default:n._setRetryableError("Stream network error")}a.startLoad()}else t.type===i.ErrorTypes.MEDIA_ERROR?(n._setRetryableError("Error with media stream contents"),a.recoverMediaError()):n._setFatalError("Error playing stream")}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return g.apply(this,arguments)})},{kind:"method",key:"_renderHLSNative",value:(k=(0,d.A)((0,s.A)().mark((function e(t,i){return(0,s.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.src=i,t.addEventListener("loadedmetadata",(function(){t.play()}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return k.apply(this,arguments)})},{kind:"method",key:"_cleanUp",value:function(){this._hlsPolyfillInstance&&(this._hlsPolyfillInstance.destroy(),this._hlsPolyfillInstance=void 0),this._exoPlayer&&(window.removeEventListener("resize",this._resizeExoPlayer),this.hass.auth.external.fireMessage({type:"exoplayer/stop"}),this._exoPlayer=!1),this._videoEl&&(this._videoEl.removeAttribute("src"),this._videoEl.load())}},{kind:"method",key:"_resetError",value:function(){this._error=void 0,this._errorIsFatal=!1}},{kind:"method",key:"_setFatalError",value:function(e){this._error=e,this._errorIsFatal=!0}},{kind:"method",key:"_setRetryableError",value:function(e){this._error=e,this._errorIsFatal=!1}},{kind:"method",key:"_loadedData",value:function(){(0,y.r)(this,"load")}},{kind:"get",static:!0,key:"styles",value:function(){return(0,m.AH)(o||(o=(0,l.A)([":host,video{display:block}video{width:100%;max-height:var(--video-max-height,calc(100vh - 97px))}.fatal{display:block;padding:100px 16px}.retry{display:block}"])))}}]}}),m.WF)},9755:function(e,t,i){i.d(t,{e:function(){return r}});i(81027);var r=function(e){return"/api/image_proxy/".concat(e.entity_id,"?token=").concat(e.attributes.access_token,"&state=").concat(e.state)}},16204:function(e,t,i){var r,a,n,o,s,d,l=i(33994),c=i(22858),h=i(64599),u=i(35806),v=i(71008),k=i(62193),f=i(2816),m=i(27927),p=i(35890),y=(i(81027),i(13025),i(82386),i(82115),i(39790),i(36604),i(253),i(2075),i(15112)),_=i(29818),g=i(85323),b=i(63073),w=i(94872),A=i(213),E=i(77226),I=(i(8437),i(37629),i(88800)),C=i(9883),x=i(9755),M=function(e){return e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Error=3]="Error",e}(M||{});(0,m.A)([(0,_.EM)("hui-image")],(function(e,t){var i,m,R,L,S=function(t){function i(){var t;(0,v.A)(this,i);for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return t=(0,k.A)(this,i,[].concat(a)),e(t),t}return(0,f.A)(i,t),(0,u.A)(i)}(t);return{F:S,d:[{kind:"field",decorators:[(0,_.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"entity",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"image",value:void 0},{kind:"field",decorators:[(0,_.MZ)({attribute:!1})],key:"stateImage",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"cameraImage",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"cameraView",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"aspectRatio",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"filter",value:void 0},{kind:"field",decorators:[(0,_.MZ)({attribute:!1})],key:"stateFilter",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"darkModeImage",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"darkModeFilter",value:void 0},{kind:"field",decorators:[(0,_.MZ)()],key:"fitMode",value:void 0},{kind:"field",decorators:[(0,_.wk)()],key:"_imageVisible",value:function(){return!1}},{kind:"field",decorators:[(0,_.wk)()],key:"_loadState",value:void 0},{kind:"field",decorators:[(0,_.wk)()],key:"_cameraImageSrc",value:void 0},{kind:"field",decorators:[(0,_.wk)()],key:"_loadedImageSrc",value:void 0},{kind:"field",decorators:[(0,_.wk)()],key:"_lastImageHeight",value:void 0},{kind:"field",key:"_intersectionObserver",value:void 0},{kind:"field",key:"_cameraUpdater",value:void 0},{kind:"field",key:"_ratio",value:function(){return null}},{kind:"method",key:"connectedCallback",value:function(){(0,p.A)(S,"connectedCallback",this,3)([]),void 0===this._loadState&&(this._loadState=M.Loading),this.cameraImage&&"live"!==this.cameraView&&this._startIntersectionObserverOrUpdates()}},{kind:"method",key:"disconnectedCallback",value:function(){(0,p.A)(S,"disconnectedCallback",this,3)([]),this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._imageVisible=void 0}},{kind:"method",key:"handleIntersectionCallback",value:function(e){this._imageVisible=e[0].isIntersecting}},{kind:"method",key:"willUpdate",value:function(e){if(e.has("hass")){var t=e.get("hass");this._shouldStartCameraUpdates(t)?this._startIntersectionObserverOrUpdates():this.hass.connected||(this._stopUpdateCameraInterval(),this._stopIntersectionObserver(),this._loadState=M.Loading,this._cameraImageSrc=void 0,this._loadedImageSrc=void 0)}e.has("_imageVisible")&&(this._imageVisible?this._shouldStartCameraUpdates()&&this._startUpdateCameraInterval():this._stopUpdateCameraInterval()),e.has("aspectRatio")&&(this._ratio=this.aspectRatio?(0,E.A)(this.aspectRatio):null),this._loadState!==M.Loading||this.cameraImage||(this._loadState=M.Loaded)}},{kind:"method",key:"render",value:function(){if(!this.hass)return y.s6;var e,t,i=Boolean(this._ratio&&this._ratio.w>0&&this._ratio.h>0),d=this.entity?this.hass.states[this.entity]:void 0,l=d?d.state:C.Hh,c=!this.stateImage;if(this.cameraImage)"live"===this.cameraView?t=this.hass.states[this.cameraImage]:e=this._cameraImageSrc;else if(this.stateImage){var u=this.stateImage[l];u?e=u:(e=this.image,c=!0)}else e=this.darkModeImage&&this.hass.themes.darkMode?this.darkModeImage:d&&"image"===(0,A.m)(d.entity_id)?(0,x.e)(d):this.image;e&&(e=this.hass.hassUrl(e));var v=this.filter||"";(this.hass.themes.darkMode&&this.darkModeFilter&&(v+=this.darkModeFilter),this.stateFilter&&this.stateFilter[l]&&(v+=this.stateFilter[l]),!v&&this.entity)&&(v=(!d||w.jj.includes(l))&&c?"grayscale(100%)":"");return(0,y.qy)(r||(r=(0,h.A)([' <div style="','" class="container ','"> '," "," </div> "])),(0,b.W)({paddingBottom:i?"".concat((100*this._ratio.h/this._ratio.w).toFixed(2),"%"):void 0===this._lastImageHeight?"56.25%":void 0,backgroundImage:i&&this._loadedImageSrc?'url("'.concat(this._loadedImageSrc,'")'):void 0,filter:this._loadState===M.Loaded||"live"===this.cameraView?v:void 0}),(0,g.H)({ratio:i||void 0===this._lastImageHeight,contain:"contain"===this.fitMode,fill:"fill"===this.fitMode}),this.cameraImage&&"live"===this.cameraView?(0,y.qy)(a||(a=(0,h.A)([' <ha-camera-stream muted .hass="','" .stateObj="','" @load="','"></ha-camera-stream> '])),this.hass,t,this._onVideoLoad):void 0===e?y.s6:(0,y.qy)(n||(n=(0,h.A)([' <img id="image" src="','" @error="','" @load="','" style="','"> '])),e,this._onImageError,this._onImageLoad,(0,b.W)({display:i||this._loadState===M.Loaded?"block":"none"})),this._loadState===M.Error?(0,y.qy)(o||(o=(0,h.A)(['<div id="brokenImage" style="','"></div>'])),(0,b.W)({height:i?void 0:"".concat(this._lastImageHeight,"px")||0})):"live"===this.cameraView||void 0!==e&&this._loadState!==M.Loading?"":(0,y.qy)(s||(s=(0,h.A)(['<div class="progress-container" style="','"> <ha-circular-progress class="render-spinner" indeterminate size="small"></ha-circular-progress> </div>'])),(0,b.W)({height:i?void 0:"".concat(this._lastImageHeight,"px")||0})))}},{kind:"method",key:"_shouldStartCameraUpdates",value:function(e){return!(e&&e.connected===this.hass.connected||!this.hass.connected||"live"===this.cameraView)}},{kind:"method",key:"_startIntersectionObserverOrUpdates",value:function(){"IntersectionObserver"in window?(this._intersectionObserver||(this._intersectionObserver=new IntersectionObserver(this.handleIntersectionCallback.bind(this))),this._intersectionObserver.observe(this)):(this._imageVisible=!0,this._startUpdateCameraInterval())}},{kind:"method",key:"_stopIntersectionObserver",value:function(){this._intersectionObserver&&this._intersectionObserver.disconnect()}},{kind:"method",key:"_startUpdateCameraInterval",value:function(){var e=this;this._stopUpdateCameraInterval(),this._updateCameraImageSrc(),this.cameraImage&&this.isConnected&&(this._cameraUpdater=window.setInterval((function(){return e._updateCameraImageSrcAtInterval()}),1e4))}},{kind:"method",key:"_stopUpdateCameraInterval",value:function(){this._cameraUpdater&&(clearInterval(this._cameraUpdater),this._cameraUpdater=void 0)}},{kind:"method",key:"_onImageError",value:function(){this._loadState=M.Error}},{kind:"method",key:"_onImageLoad",value:(L=(0,c.A)((0,l.A)().mark((function e(t){var i;return(0,l.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=M.Loaded,i=t.target,this._ratio&&this._ratio.w>0&&this._ratio.h>0&&(this._loadedImageSrc=i.src),e.next=5,this.updateComplete;case 5:this._lastImageHeight=i.offsetHeight;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{kind:"method",key:"_onVideoLoad",value:(R=(0,c.A)((0,l.A)().mark((function e(t){var i;return(0,l.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState=M.Loaded,i=t.currentTarget,e.next=4,this.updateComplete;case 4:this._lastImageHeight=i.offsetHeight;case 5:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrcAtInterval",value:(m=(0,c.A)((0,l.A)().mark((function e(){return(0,l.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._loadState===M.Loading&&this._onImageError(),e.abrupt("return",this._updateCameraImageSrc());case 2:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{kind:"method",key:"_updateCameraImageSrc",value:(i=(0,c.A)((0,l.A)().mark((function e(){var t,i,r;return(0,l.A)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hass&&this.cameraImage){e.next=2;break}return e.abrupt("return");case 2:if(this.hass.states[this.cameraImage]){e.next=6;break}return this._onImageError(),e.abrupt("return");case 6:return t=this.clientWidth||640,i=Math.ceil(t*devicePixelRatio),this._lastImageHeight?r=Math.ceil(this._lastImageHeight*devicePixelRatio):this._ratio&&this._ratio.w>0&&this._ratio.h>0?r=Math.ceil(i*(this._ratio.h/this._ratio.w)):(i*=2,r=Math.ceil(.5625*i)),e.next=11,(0,I.C4)(this.hass,this.cameraImage,i,r);case 11:this._cameraImageSrc=e.sent,void 0===this._cameraImageSrc&&this._onImageError();case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{kind:"get",static:!0,key:"styles",value:function(){return(0,y.AH)(d||(d=(0,h.A)([':host{display:block}.container{transition:filter .2s linear;height:100%}img{display:block;height:100%;width:100%;object-fit:cover}.progress-container{display:flex;justify-content:center;align-items:center}.ratio{position:relative;width:100%;height:0;background-position:center;background-size:cover}.ratio.fill{background-size:100% 100%}.ratio.contain{background-size:contain;background-repeat:no-repeat}.fill img{object-fit:fill}.contain img{object-fit:contain}.ratio div,.ratio img{position:absolute;top:0;left:0;width:100%;height:100%}.ratio img{visibility:hidden}#brokenImage{background:grey url("/static/images/image-broken.svg") center/36px no-repeat}'])))}}]}}),y.WF)}}]);
//# sourceMappingURL=16204.12_c5_YXOj8.js.map