"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[5393],{5393:(O,C,P)=>{P.r(C),P.d(C,{TRatioPlotPainter:()=>m});var T=P(467),c=P(6998),x=P(6224),F=P(9025),L=P(2695);class m extends x.JW{setGridsRange(t,i,n,e,s){const a=this.getObject();if(t===i){const r=this.getPadPainter()?.findPainterFor(a.fLowerPad,"lower_pad",c.clTPad)?.getFramePainter()?.x_handle;if(!r)return;0===t?(t=r.full_min,i=r.full_max):(t=r.scale_min,i=r.scale_max)}a.fGridlines.forEach(r=>{r.fX1=t,r.fX2=i});const o=Math.min(a.fGridlines.length,a.fGridlinePositions.length);for(let r=0;r<o;++r){const _=a.fGridlinePositions[r],f=a.fGridlines[r];"ignorey"!==n&&(f.$do_not_draw=n!==e&&(_<n||_>e),f.fY1=f.fY2=_),s?.findPainterFor(f)?.redraw()}}configureInteractive(){const t=this.getObject(),i=this.getPadPainter(),n=i.findPainterFor(t.fUpperPad,"upper_pad",c.clTPad),e=n?.getFramePainter(),s=i.findPainterFor(t.fLowerPad,"lower_pad",c.clTPad),a=s?.getFramePainter();!n||!s||(s.forEachPainterInPad(o=>{(0,c.isFunc)(o?.testEditable)&&o.testEditable(!1)}),this.setGridsRange(a.scale_xmin,a.scale_xmax,a.scale_ymin,a.scale_ymax,s),(!n._ratio_interactive||!s._ratio_interactive)&&(n._ratio_interactive=!0,s._ratio_interactive=!0,e.o_zoom=e.zoom,e._ratio_low_fp=a,e._ratio_painter=this,e.zoom=function(o,r,_,f,p,d){return this.o_zoom(o,r,_,f,p,d).then(h=>(this._ratio_painter.setGridsRange(e.scale_xmin,e.scale_xmax,"ignory"),this._ratio_low_fp.o_zoom(e.scale_xmin,e.scale_xmax).then(()=>h)))},e.o_sizeChanged=e.sizeChanged,e.sizeChanged=function(){this.o_sizeChanged(),this._ratio_low_fp.fX1NDC=this.fX1NDC,this._ratio_low_fp.fX2NDC=this.fX2NDC,this._ratio_low_fp.o_sizeChanged()},a.o_zoom=a.zoom,a._ratio_up_fp=e,a._ratio_painter=this,a.zoom=function(o,r,_,f,p,d){return o===r?(o=e.xmin,r=e.xmax):(o<e.xmin&&(o=e.xmin),r>e.xmax&&(r=e.xmax)),this._ratio_painter.setGridsRange(o,r,_,f),this._ratio_up_fp.o_zoom(o,r).then(()=>this.o_zoom(o,r,_,f,p,d))},a.o_sizeChanged=a.sizeChanged,a.sizeChanged=function(){this.o_sizeChanged(),this._ratio_up_fp.fX1NDC=this.fX1NDC,this._ratio_up_fp.fX2NDC=this.fX2NDC,this._ratio_up_fp.o_sizeChanged()}))}redrawOld(){var t=this;return(0,T.A)(function*(){const i=t.getObject(),n=t.getPadPainter(),e=n.findPainterFor(i.fTopPad,"top_pad",c.clTPad),s=n.getRootPad(),a=0===s.fFrameFillStyle?1:0,o=s.fTickx||a,r=s.fTicky||a;e?.disablePadDrawing();const _=n.findPainterFor(i.fUpperPad,"upper_pad",c.clTPad),f=_?.getMainPainter(),p=_?.getFramePainter(),d=n.findPainterFor(i.fLowerPad,"lower_pad",c.clTPad),h=d?.getMainPainter(),w=d?.getFramePainter();let z=Promise.resolve(!0);if(_&&f&&p&&w&&!_._ratio_configured){_._ratio_configured=!0,f.options.Axis=0;const u=f.getHisto();u.fYaxis.$use_top_pad=!0,u.fXaxis.fLabelSize=0,u.fXaxis.fTitle="",_.getRootPad().fTickx=o,_.getRootPad().fTicky=r,z=_.redrawPad()}return z.then(()=>{if(!d||!h||!w||!p||d._ratio_configured)return t;d._ratio_configured=!0,h.options.Axis=0;const u=h.getHisto();u.fXaxis.fTitle="x",u.fXaxis.$use_top_pad=!0,u.fYaxis.$use_top_pad=!0,d.getRootPad().fTickx=o,d.getRootPad().fTicky=r;const E=[];let g;return i.fGridlinePositions.length>0&&i.fGridlines.length<i.fGridlinePositions.length&&i.fGridlinePositions.forEach(D=>{let v=!1;if(i.fGridlines.forEach(l=>{l.fY1===l.fY2&&Math.abs(l.fY1-D)<1e-6&&(v=!0)}),!v){const l=(0,c.create)(c.clTLine);l.fX1=p.scale_xmin,l.fX2=p.scale_xmax,l.fY1=l.fY2=D,l.fLineStyle=2,i.fGridlines.push(l),void 0===g&&(g=t.selectCurrentPad(i.fLowerPad.fName)),E.push(L.TLinePainter.draw(t.getDom(),l))}}),Promise.all(E).then(()=>(void 0!==g&&t.selectCurrentPad(g),w.zoom(p.scale_xmin,p.scale_xmax)))})})()}redraw(){var t=this;return(0,T.A)(function*(){const i=t.getObject(),n=t.getPadPainter();if(void 0===t.$oldratio&&(t.$oldratio=!!n.findPainterFor(i.fTopPad,"top_pad",c.clTPad)),n.$userInteractive=()=>t.configureInteractive(),t.$oldratio)return t.redrawOld();const e=n.getRootPad(),s=0===e.fFrameFillStyle?1:0,a=e.fTickx||s,o=e.fTicky||s;return i.fTopPad.$disable_drawing=!0,i.fUpperPad.$ratio_pad="up",i.fUpperPad.fTickx=a,i.fUpperPad.fTicky=o,i.fLowerPad.$ratio_pad="low",i.fLowerPad.fTickx=a,i.fLowerPad.fTicky=o,t})()}static draw(t,i,n){return(0,T.A)(function*(){const e=new m(t,i,n);return(0,F.ensureTCanvas)(e,!1).then(()=>e.redraw())})()}}}}]);