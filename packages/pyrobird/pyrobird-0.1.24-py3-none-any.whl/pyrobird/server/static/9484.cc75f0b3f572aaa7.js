"use strict";(self.webpackChunkfirebird=self.webpackChunkfirebird||[]).push([[9484],{9484:(G,H,_)=>{_.r(H),_.d(H,{RH2Painter:()=>Y});var S=_(467),v=_(6998),I=_(5680),F=_(9041),k=_(6563),O=_(7933),Z=_(4571);class X extends k.G{constructor(t,i){super(t,i),this.wheel_zoomy=!0}cleanup(){delete this.tt_handle,super.cleanup()}getDimension(){return 2}toggleProjection(t,i){("Projections"===t||"Off"===t)&&(t="");let e=i,n=i;if((0,v.isStr)(t)&&0===t.indexOf("XY")){const a=t.length>2?t.slice(2):"";t="XY",e=n=parseInt(a)}else if((0,v.isStr)(t)&&t.length>1){const a=t.indexOf("_");a>0&&"X"===t[0]&&"Y"===t[a+1]?(e=parseInt(t.slice(1,a))||1,n=parseInt(t.slice(a+2))||1,t="XY"):a>0&&"Y"===t[0]&&"X"===t[a+1]?(n=parseInt(t.slice(1,a))||1,e=parseInt(t.slice(a+2))||1,t="XY"):(e=n=parseInt(t.slice(1))||1,t=t[0])}if(!e&&!n&&(e=n=1),t&&this.is_projection===t){if(this.projection_widthX!==e||this.projection_widthY!==n)return this.projection_widthX=e,void(this.projection_widthY=n);t=""}delete this.proj_hist;const r=this.is_projection===t?"":t;this.projection_widthX=e,this.projection_widthY=n,this.is_projection="",this.provideSpecialDrawArea(r).then(()=>(this.is_projection=r,this.redrawProjection()))}redrawProjection(){}executeMenuCommand(t,i){return!!super.executeMenuCommand(t,i)||("SetShowProjectionX"===t.fName||"SetShowProjectionY"===t.fName)&&(this.toggleProjection(t.fName[17],i&&parseInt(i)?parseInt(i):1),!0)}fillHistContextMenu(t){if(this.getPadPainter()?.iscan){let e=this.is_projection||"";e&&(e+=this.projection_widthX),this.projection_widthX!==this.projection_widthY&&"XY"===this.is_projection&&(e=`X${this.projection_widthX}_Y${this.projection_widthY}`);const n=["X1","X2","X3","X5","X10","Y1","Y2","Y3","Y5","Y10","XY1","XY2","XY3","XY5","XY10"];e&&n.unshift("Off"),t.add("sub:Projections",()=>t.input("Input projection kind X1 or XY2 or X3_Y4",e,"string").then(r=>this.toggleProjection(r)));for(let r=0;r<n.length;++r)t.addchk(e===n[r],n[r],n[r],a=>this.toggleProjection(a));t.add("endsub:")}t.add("Auto zoom-in",()=>this.autoZoom());const i=this.getSupportedDrawOptions();t.addDrawMenu("Draw with",i,e=>{if(0===e.indexOf(v.kInspect))return this.showInspector(e);this.decodeOptions(e),this.interactiveRedraw("pad","drawopt")}),this.options.Color&&this.fillPaletteMenu(t)}clickButton(t){const i=super.clickButton(t);if(i)return i;switch(t){case"ToggleColor":return this.toggleColor();case"Toggle3D":return this.toggleMode3D()}return!1}fillToolbar(){super.fillToolbar(!0);const t=this.getPadPainter();t&&(t.addPadButton("th2color","Toggle color","ToggleColor"),t.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),t.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),t.showPadButtons())}toggleColor(){return this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color,this.redraw()}autoZoom(){const t=this.getSelectIndex("x","left",-1),i=this.getSelectIndex("x","right",1),e=this.getSelectIndex("y","left",-1),n=this.getSelectIndex("y","right",1),r=this.getHisto(),a=this.getAxis("x"),m=this.getAxis("y");if(t===i||e===n)return;let p=r.getBinContent(t+1,e+1);for(let x=t;x<i;++x)for(let u=e;u<n;++u)p=Math.min(p,r.getBinContent(x+1,u+1));if(p>0)return;let h=i,o=t,d=n,s=e;for(let x=t;x<i;++x)for(let u=e;u<n;++u)r.getBinContent(x+1,u+1)>p&&(x<h&&(h=x),x>=o&&(o=x+1),u<d&&(d=u),u>=s&&(s=u+1));let c,y,f,l,g=!1;return h===o-1&&h>t+1&&o<i-1&&(h--,o++),d===s-1&&d>e+1&&s<n-1&&(d--,s++),(h>t||o<i)&&h<o-1&&(c=a.GetBinCoord(h),y=a.GetBinCoord(o),g=!0),(d>e||s<n)&&d<s-1&&(f=m.GetBinCoord(d),l=m.GetBinCoord(s),g=!0),g?this.getFramePainter().zoom(c,y,f,l):void 0}scanContent(t){if(t&&this.nbinsx&&this.nbinsy)return;const i=this.getHisto();if(this.extractAxesProperties(2),this.isDisplayItem())this.gminbin=i.fContMin,this.gminposbin=i.fContMinPos>0?i.fContMinPos:null,this.gmaxbin=i.fContMax;else{this.gminbin=this.gmaxbin=i.getBinContent(1,1),this.gminposbin=null;for(let e=0;e<this.nbinsx;++e)for(let n=0;n<this.nbinsy;++n){const r=i.getBinContent(e+1,n+1);r<this.gminbin?this.gminbin=r:r>this.gmaxbin&&(this.gmaxbin=r),r>0&&(null===this.gminposbin||this.gminposbin>r)&&(this.gminposbin=r)}}this.zmin=this.gminbin,this.zmax=this.gmaxbin,null===this.gminposbin&&this.gmaxbin>0&&(this.gminposbin=1e-4*this.gmaxbin),this.draw_content=!(this.options.Axis>0||0===this.gmaxbin&&0===this.gminbin)}countStat(t){const i=this.getHisto(),e={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},n=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),a=this.getSelectIndex("y","left"),m=this.getSelectIndex("y","right"),p=this.getAxis("x"),h=this.getAxis("y");let f,l,g,x,u,b,w,o=0,d=0,s=0,c=0,y=0;for(b=1;b<=this.nbinsx;++b)for(f=b<=n+1?0:b>r+1?2:1,g=p.GetBinCoord(b-.5),w=1;w<=this.nbinsy;++w)l=w<=a+1?0:w>m+1?2:1,x=h.GetBinCoord(w-.5),u=i.getBinContent(b,w),e.entries+=u,e.matrix[3*l+f]+=u,1===f&&1===l&&(t&&!t(g,x)||((null===e.wmax||u>e.wmax)&&(e.wmax=u,e.xmax=g,e.ymax=x),o+=u,d+=g*u,s+=x*u,c+=g**2*u,y+=x**2*u));return Math.abs(o)>1e-300&&(e.meanx=d/o,e.meany=s/o,e.rmsx=Math.sqrt(Math.abs(c/o-e.meanx**2)),e.rmsy=Math.sqrt(Math.abs(y/o-e.meany**2))),null===e.wmax&&(e.wmax=0),e.integral=o,e}fillStatistic(t,i){const e=this.countStat(),n=Math.floor(i%10),r=Math.floor(i/10)%10,a=Math.floor(i/100)%10,m=Math.floor(i/1e3)%10,p=Math.floor(i/1e4)%10,h=Math.floor(i/1e5)%10,o=Math.floor(i/1e6)%10,d=Math.floor(i/1e7)%10,s=Math.floor(i/1e8)%10;if(t.clearStat(),n>0&&t.addText(e.name),r>0&&t.addText("Entries = "+t.format(e.entries,"entries")),a>0&&(t.addText("Mean x = "+t.format(e.meanx)),t.addText("Mean y = "+t.format(e.meany))),m>0&&(t.addText("Std Dev x = "+t.format(e.rmsx)),t.addText("Std Dev y = "+t.format(e.rmsy))),o>0&&t.addText("Integral = "+t.format(e.matrix[4],"entries")),d>0&&(t.addText("Skewness x = <undef>"),t.addText("Skewness y = <undef>")),s>0&&t.addText("Kurt = <undef>"),p>0||h>0){const c=e.matrix;t.addText(c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),t.addText(c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),t.addText(c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0))}return!0}drawBinsColor(){const t=this.getHisto(),i=this.prepareDraw(),e=i.stepi,n=i.stepj,r=[];let m,p,h,o,d,s,c,y,f,l;const g=()=>{l.path+=`h${c}v${l.y2-l.y}h${-c}z`,l.dy=0,l=null};for(o=i.i1;o<i.i2;o+=e){for(c=i.grx[o+e]-i.grx[o]||1,d=i.j1;d<i.j2;d+=n)if(s=t.getBinContent(o+1,d+1),m=i.palette.getContourIndex(s),0===s&&(this.options.Zero?null===m&&this._show_empty_bins&&(m=0):m=null),null!==m){if(p=`M${i.grx[o]},${i.gry[d]}`,y=i.gry[d+n]-i.gry[d]||-1,f=r[m],void 0===f)f=r[m]={path:p};else{if(f===l){f.y2=i.gry[d]+y;continue}h=`m${i.grx[o]-f.x},${i.gry[d]-f.y}`,f.path+=h.length<p.length?h:p}l&&g(),f.x=i.grx[o],f.y=i.gry[d],f.y2=i.gry[d]+y,l=f}else l&&g();l&&g()}return r.forEach((x,u)=>{x&&this.draw_g.append("svg:path").style("fill",i.palette.getColor(u)).attr("d",x.path)}),this.updatePaletteDraw(),i}drawBinsContour(t,i,e){const n=this.prepareDraw({rounding:!1,extra:100}),r=this.getFramePainter(),a=r.getHistPalette(),m=a.getContour(),p=r.getProjectionFunc();return 14===this.options.Contour&&this.draw_g.append("svg:path").attr("d",`M0,0h${i}v${e}h${-i}z`).style("fill",a.getColor(0)),(0,Z.Hn)(this.getHisto(),n,m,a,(o,d,s,c,y)=>{const f=a.getColor(o);let g,l=f;switch(this.options.Contour){case 1:case 14:break;case 11:l="none",g=this.createAttLine({color:f,std:!1});break;case 12:l="none",g=this.createAttLine({color:1,style:o%5+1,width:1,std:!1});break;case 13:l="none",g=this.lineatt}const x=((o,d,s,c,y)=>{let l,g,x,u,f="";for(let b=s;b<=c;++b){if(p?(g=p(o[b],d[b]),g.x=Math.round(t.grx(g.x)),g.y=Math.round(t.gry(g.y))):g={x:Math.round(o[b]),y:Math.round(d[b])},f)if(b===c&&x&&g.x===x.x&&g.y===x.y){if(!u)return"";f+="z",y=!1}else g.x!==l.x&&g.y!==l.y?(f+=`l${g.x-l.x},${g.y-l.y}`,u=!0):g.x!==l.x?(f+="h"+(g.x-l.x),u=!0):g.y!==l.y&&(f+="v"+(g.y-l.y),u=!0);else f=`M${g.x},${g.y}`,x=g;l=g}return y&&(f+="z"),f})(d,s,c,y,"none"!==l);if(!x)return;const u=this.draw_g.append("svg:path").attr("d",x).style("fill",l);g&&u.call(g.func)}),n.hide_only_zeros=!0,n}createPolyBin(){return""}drawBinsText(t){null===t&&(t=this.prepareDraw({rounding:!1}));const i=this.getHisto(),e=this.v7EvalFont("text",{size:20,color:"black",align:22}),n=this.options.BarOffset||0,r=this.draw_g.append("svg:g").attr("class","th2_text"),a=t.stepi,m=t.stepj;let h,o,d,s,c,y,f,l,g,x;for(this.startTextDrawing(e,"font",r),h=t.i1;h<t.i2;h+=a)for(o=t.j1;o<t.j2;o+=m)d=i.getBinContent(h+1,o+1),(0!==d||this._show_empty_bins)&&(s=t.grx[h+a]-t.grx[h],c=t.gry[o]-t.gry[o+m],y=d===Math.round(d)?d.toString():(0,F.lg)(d,v.gStyle.fPaintTextFormat),e.angle?(f=Math.round(t.grx[h]+.5*s),l=Math.round(t.gry[o+m]+c*(.5+n)),g=x=0):(f=Math.round(t.grx[h]+.1*s),l=Math.round(t.gry[o+m]+c*(.1+n)),g=Math.round(.8*s),x=Math.round(.8*c)),this.drawText({align:22,x:f,y:l,width:g,height:x,text:y,latex:0,draw_g:r}));return this.finishTextDrawing(r,!0).then(()=>(t.hide_only_zeros=!0,t))}drawBinsArrow(){const t=this.getHisto(),i=this.prepareDraw({rounding:!1}),e=(i.grx[i.i2]-i.grx[i.i1])/(i.i2-i.i1+1-.03)/2,n=(i.gry[i.j2]-i.gry[i.j1])/(i.j2-i.j1+1-.03)/2,r=i.stepi,a=i.stepj,m=(C,M)=>C?M?`l${C},${M}`:`h${C}`:M?`v${M}`:"";let h,o,s,c,y,f,l,g,x,u,b,w,j,B,$,p="",d=1e-30;for(let C=0;C<2;++C)for(h=i.i1;h<i.i2;h+=r)for(o=i.j1;o<i.j2;o+=a)s=h===i.i1?t.getBinContent(h+1+r,o+1)-t.getBinContent(h+1,o+1):h>=i.i2-r?t.getBinContent(h+1,o+1)-t.getBinContent(h+1-r,o+1):.5*(t.getBinContent(h+1+r,o+1)-t.getBinContent(h+1-r,o+1)),c=o===i.j1?t.getBinContent(h+1,o+1+a)-t.getBinContent(h+1,o+1):o>=i.j2-a?t.getBinContent(h+1,o+1)-t.getBinContent(h+1,o+1-a):.5*(t.getBinContent(h+1,o+1+a)-t.getBinContent(h+1,o+1-a)),0===C?d=Math.max(d,Math.abs(s),Math.abs(c)):(y=(i.grx[h]+i.grx[h+r])/2,f=(i.gry[o]+i.gry[o+a])/2,l=e*s/d,g=n*c/d,x=y-l,u=y+l,b=f-g,w=f+g,s=Math.round(u-x),c=Math.round(w-b),(0!==s||0!==c)&&(p+="M"+Math.round(x)+","+Math.round(b)+m(s,c),(Math.abs(s)>5||Math.abs(c)>5)&&(j=Math.sqrt(2/(s**2+c**2)),B=Math.round(j*(s+c)),$=Math.round(j*(s-c)),(B||$)&&(p+=`m${-B},${$}`+m(B,-$)+m(-$,-B)))));return this.draw_g.append("svg:path").attr("d",p).style("fill","none").call(this.lineatt.func),i}drawBinsBox(){const t=this.getHisto(),i=this.prepareDraw({rounding:!1}),e=this.getFramePainter();e.maxbin===e.minbin&&(e.maxbin=this.gmaxbin,e.minbin=this.gminbin,e.minposbin=this.gminposbin),e.maxbin===e.minbin&&(e.minbin=Math.min(0,e.maxbin-1));const n=Math.max(Math.abs(e.maxbin),Math.abs(e.minbin)),r=Math.max(0,e.minbin),a=i.stepi,m=i.stepj;let p,h,o,d,l,g,x,u,b,w,j,B,s="",c="",y="",f="",$=!1,C=0;if(e.logz&&n>0){$=!0;const M=Math.log(n);C=r>0?Math.log(r):e.minposbin>=1&&e.minposbin<100?Math.log(.7):e.minposbin>0?Math.log(.7*e.minposbin):M-10,C>=M&&(C=M-10),B=1/(M-C)}else B=1/(n-r);for(p=i.i1;p<i.i2;p+=a)for(h=i.j1;h<i.j2;h+=m)if(o=t.getBinContent(p+1,h+1),d=Math.abs(o),!(0===d||d<r)&&(l=$?d>0?Math.log(d)-C:0:d-r,l=.5*(l<0?1:1-Math.sqrt(l*B)),l<0&&(l=0),w=i.grx[p+a]-i.grx[p],j=i.gry[h]-i.gry[h+m],g=l*w,x=l*j,u=Math.round(i.grx[p]+g),b=Math.round(i.gry[h+m]+x),w=Math.max(Math.round(w-2*g),1),j=Math.max(Math.round(j-2*x),1),s+=`M${u},${b}v${j}h${w}v${-j}z`,o<0&&10===this.options.BoxStyle&&(c+=`M${u},${b}l${w},${j}M${u+w},${b}l${-w},${j}`),11===this.options.BoxStyle&&w>5&&j>5)){const M=Math.round(.1*w),D=Math.round(.1*j),z=`M${u},${b}h${w}l${-M},${D}h${2*M-w}v${j-2*D}l${-M},${D}z`,T=`M${u+w},${b+j}v${-j}l${-M},${D}v${j-2*D}h${2*M-w}l${-M},${D}z`;f+=o<0?z:T,y+=o<0?T:z}if(s){const M=this.draw_g.append("svg:path").attr("d",s).call(this.fillatt.func);11!==this.options.BoxStyle&&this.fillatt.empty()&&M.call(this.lineatt.func)}if(y&&this.fillatt.hasColor()&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func).style("fill",(0,I.Qh)(this.fillatt.color).brighter(.5).formatHex()),f&&this.draw_g.append("svg:path").attr("d",f).call(this.fillatt.func).style("fill",this.fillatt.hasColor()?(0,I.Qh)(this.fillatt.color).darker(.5).formatHex():"red"),c){const M=this.draw_g.append("svg:path").attr("d",c).style("fill","none");this.lineatt.empty()||M.call(this.lineatt.func)}return i}drawBinsScatter(){const t=this.getHisto(),i=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),e=[],n=[],r=[],a=[],m=[],p=this.options.ScatCoef*(this.gmaxbin>2e3?2e3/this.gmaxbin:1),h=i.stepi,o=i.stepj,d=new F.YF(i.sumz);let s,c,y,f,l,g,x,u,b=1;if(p*i.sumz<1e5){this.createv7AttMarker(),this.markeratt.resetPos();let C,M,$="";for(f=i.i1;f<i.i2;f+=h)for(x=i.grx[f+h]-i.grx[f],l=i.j1;l<i.j2;l+=o)if(u=i.gry[l]-i.gry[l+o],g=t.getBinContent(f+1,l+1),M=Math.round(p*g),!(M<=0))for(C=0;C<M;++C)$+=this.markeratt.create(Math.round(i.grx[f]+x*d.random()),Math.round(i.gry[l+1]+u*d.random()));return this.draw_g.append("svg:path").attr("d",$).call(this.markeratt.func),i}for(this.maxbin>.7&&(b=.7/this.maxbin),f=i.i1;f<i.i2;f+=h)for(l=i.j1;l<i.j2;l+=o)g=t.getBinContent(f+1,l+1),!(g<=0||g<this.minbin)&&(x=i.grx[f+h]-i.grx[f],u=i.gry[l]-i.gry[l+o],!(x*u<=0)&&(s=i.palette.getContourIndex(g/x/u),!(s<0)&&(c=`M${i.grx[f]},${i.gry[l+o]}`,void 0===e[s]?(e[s]=c,a[s]=x,m[s]=u):(y=`m${i.grx[f]-n[s]},${i.gry[l+o]-r[s]}`,e[s]+=y.length<c.length?y:c,a[s]=Math.max(a[s],x),m[s]=Math.max(m[s],u)),n[s]=i.grx[f],r[s]=i.gry[l+o],e[s]+=`v${u}h${x}v${-u}z`)));const w=this.getFrameSvg().selectChild(".main_layer");let j=w.selectChild("def");j.empty()&&e.length>0&&(j=w.insert("svg:defs",":first-child")),this.createv7AttMarker();const B=i.palette.getContour();for(s=0;s<e.length;++s)if(void 0!==e[s]&&s<B.length){const $=(this.pad_name||"canv")+`_scatter_${s}`;let C=j.selectChild(`#${$}`);C.empty()?C=j.append("svg:pattern").attr("id",$).attr("patternUnits","userSpaceOnUse"):C.selectAll("*").remove();let M=Math.round(b*B[s]*a[s]*m[s]);M<1&&(M=1);const D=new Float32Array(M),z=new Float32Array(M);if(1===M)D[0]=z[0]=.5;else for(let P=0;P<M;++P)D[P]=d.random(),z[P]=d.random();this.markeratt.resetPos();let T="";for(let P=0;P<M;++P)T+=this.markeratt.create(D[P]*a[s],z[P]*m[s]);C.attr("width",a[s]).attr("height",m[s]).append("svg:path").attr("d",T).call(this.markeratt.func),this.draw_g.append("svg:path").attr("scatter-index",s).style("fill",`url(#${$})`).attr("d",e[s])}return i}draw2DBins(){var t=this;return(0,S.A)(function*(){if(!t.draw_content)return t.removeG(),!1;t.createHistDrawAttributes(),t.createG(!0);const i=t.getFramePainter(),e=i.getFrameRect(),n=i.getGrFuncs(t.options.second_x,t.options.second_y);let r=null,a=null;return t.options.Scat?r=t.drawBinsScatter():t.options.Color?r=t.drawBinsColor():t.options.Box?r=t.drawBinsBox():t.options.Arrow?r=t.drawBinsArrow():t.options.Contour>0&&(r=t.drawBinsContour(n,e.width,e.height)),t.options.Text&&(a=t.drawBinsText(r)),!r&&!a&&(r=t.drawBinsColor()),a||(a=Promise.resolve(r)),a.then(m=>(t.tt_handle=m,t))})()}getBinTooltips(t,i){const e=[],n=this.getHisto();let r=n.getBinContent(t+1,i+1),a=1,m=1;this.isDisplayItem()&&(a=n.stepx||1,m=n.stepy||1),e.push(this.getObjectHint()||"histo<2>","x = "+this.getAxisBinTip("x",t,a),"y = "+this.getAxisBinTip("y",i,m),`bin = ${t+1}, ${i+1}`),n.$baseh&&(r-=n.$baseh.getBinContent(t+1,i+1));const p="entries = "+(a>1||m>1?"~":"");return r===Math.round(r)?e.push(p+r):e.push(p+(0,F.lg)(r,v.gStyle.fStatFormat)),e}getPolyBinTooltips(){return[]}processTooltipEvent(t){const i=this.getHisto(),e=this.tt_handle;let n=this.draw_g?.selectChild(".tooltip_bin");if(!t||!this.draw_content||!this.draw_g||!e||this.options.Proj)return n?.remove(),null;if(e.poly)return null;let r,a,m=0,p=null;for(r=e.i1;r<e.i2&&!(t.x>=e.grx[r]&&t.x<=e.grx[r+1]);++r);for(a=e.j1;a<e.j2&&!(t.y>=e.gry[a+1]&&t.y<=e.gry[a]);++a);if(r<e.i2&&a<e.j2&&(m=i.getBinContent(r+1,a+1),this.is_projection?p=0:e.hide_only_zeros?p=0!==m||this._show_empty_bins?0:null:(p=e.palette.getContourIndex(m),null===p&&0===m&&this._show_empty_bins&&(p=0))),null===p)return n.remove(),null;const h={name:"histo",title:i.fTitle||"title",x:t.x,y:t.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getBinTooltips(r,a),exact:!0,menu:!0};if(this.options.Color&&(h.color2=e.palette.getColor(p)),t.disabled&&!this.is_projection)n.remove(),h.changed=!0;else{n.empty()&&(n=this.draw_g.append("svg:path").attr("class","tooltip_bin").style("pointer-events","none").call(F.Ru));const o=this.getFramePainter();let b,d=r,s=r+1,c=a,y=a+1,f=e.grx[d],l=e.grx[s],g=e.gry[y],x=e.gry[c],u=1e4*r+a;if(this.is_projection){const w=this.projection_widthX||1,j=(w-1)/2;this.is_projection.indexOf("X")>=0&&w>1&&(y+j>=e.j2?(y=Math.min(Math.round(y+j),e.j2),c=Math.max(y-w,e.j1)):(c=Math.max(Math.round(c-j),e.j1),y=Math.min(c+w,e.j2)));const B=this.projection_widthY||1,$=(B-1)/2;this.is_projection.indexOf("Y")>=0&&B>1&&(s+$>=e.i2?(s=Math.min(Math.round(s+$),e.i2),d=Math.max(s-B,e.i1)):(d=Math.max(Math.round(d-$),e.i1),s=Math.min(d+B,e.i2)))}"X"===this.is_projection?(f=0,l=o.getFrameWidth(),g=e.gry[y],x=e.gry[c],u=777*c+333*y):"Y"===this.is_projection?(g=0,x=o.getFrameHeight(),f=e.grx[d],l=e.grx[s],u=777*d+333*s):"XY"===this.is_projection&&(g=e.gry[y],x=e.gry[c],f=e.grx[d],l=e.grx[s],u=789*d+653*s+12345*c+654321*y,b=`M${f},0H${l}V${g}H${o.getFrameWidth()}V${x}H${l}V${o.getFrameHeight()}H${f}V${x}H0V${g}H${f}Z`),h.changed=n.property("current_bin")!==u,h.changed&&n.attr("d",b||`M${f},${g}H${l}V${x}H${f}Z`).style("opacity","0.7").property("current_bin",u),this.is_projection&&h.changed&&this.redrawProjection(d,s,c,y)}return h.changed&&(h.user_info={obj:i,name:"histo",bin:i.getBin(r+1,a+1),cont:m,binx:r+1,biny:a+1,grx:t.x,gry:t.y}),h}canZoomInside(t,i,e){if("z"===t)return!0;const n=this.getAxis(t);return n.FindBin(e,.5)-n.FindBin(i,0)>1}draw2D(t){var i=this;return(0,S.A)(function*(){return i.clear3DScene(),i.drawFrameAxes().then(e=>!!e&&i.drawingBins(t)).then(e=>{if(e)return i.draw2DBins().then(()=>i.addInteractivity())}).then(()=>i)})()}draw3D(t){var i=this;return(0,S.A)(function*(){return console.log("3D drawing is disabled, load ./hist/RH1Painter.mjs"),i.draw2D(t)})()}callDrawFunc(t){var i=this;return(0,S.A)(function*(){const e=i.getFramePainter();return e&&e.mode3d!==i.options.Mode3D&&!i.isMainPainter()&&(i.options.Mode3D=e.mode3d),i.options.Mode3D?i.draw3D(t):i.draw2D(t)})()}redraw(t){var i=this;return(0,S.A)(function*(){return i.callDrawFunc(t)})()}static _draw(t){return(0,S.A)(function*(){return(0,O.ensureRCanvas)(t).then(()=>{t.setAsMainPainter(),t.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,Color:!1,Scat:!1,ScatCoef:1,Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:v.kNoZoom,maximum:v.kNoZoom,FrontBox:!1,BackBox:!1};const i=t.v7EvalAttr("kind",""),e=t.v7EvalAttr("sub",0),n=t.options;switch(n.Text=t.v7EvalAttr("drawtext",!1),i){case"lego":n.Lego=e>0?10+e:12,n.Mode3D=!0;break;case"surf":n.Surf=e>0?10+e:1,n.Mode3D=!0;break;case"box":n.Box=!0,n.BoxStyle=10+e;break;case"err":n.Error=!0,n.Mode3D=!0;break;case"cont":n.Contour=e>0?10+e:1;break;case"arr":n.Arrow=!0;break;case"scat":n.Scat=!0;break;case"col":n.Color=!0;break;default:n.Text||(n.Color=!0)}return t._show_empty_bins=!1,t.scanContent(),t.callDrawFunc()})})()}static draw(t,i,e){return(0,S.A)(function*(){return X._draw(new X(t,i),e)})()}}var E=_(9274),A=_(9407);class Y extends X{draw3DBins(){if(this.draw_content){if(this.options.Surf)return(0,A.u$)(this,!0);if(this.options.Error)return(0,A.s6)(this,!0);if(this.options.Contour)return(0,A.SF)(this,!0,!0);(0,A.CS)(this,!0),this.updatePaletteDraw()}}draw3D(t){this.mode3d=!0;const i=this.getFramePainter(),e=this.isMainPainter();let n=Promise.resolve(this);if("resize"===t)return e&&i.resize3D()&&i.render3D(),n;let r=1+2*v.gStyle.fHistTopMargin;return this.zmin=i.logz?.3*this.gminposbin:this.gminbin,this.zmax=this.gmaxbin,this.options.minimum!==v.kNoZoom&&(this.zmin=this.options.minimum),this.options.maximum!==v.kNoZoom&&(this.zmax=this.options.maximum,r=1),i.logz&&this.zmin<=0&&(this.zmin=1e-5*this.zmax),this.deleteAttr(),e&&((0,A.wx)(i),n=i.create3DScene(this.options.Render3D).then(()=>{i.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,null,this.zmin,this.zmax),i.set3DOptions(this.options),i.drawXYZ(i.toplevel,E.R,{zmult:r,zoom:v.settings.Zooming,ndim:2,draw:!0,v7:!0})})),i.mode3d?n.then(()=>this.drawingBins(t)).then(()=>{const a=this.getFramePainter();return this.draw3DBins(),a.render3D(),a.addKeysHandler(),this}):n}static draw(t,i,e){return(0,S.A)(function*(){return Y._draw(new Y(t,i),e)})()}}}}]);